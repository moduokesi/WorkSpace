{"version":3,"file":"82.bundle.567b6c3e992103f9c33a.js","mappings":"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","sources":["webpack:///../../../extensions/default/src/DicomWebDataSource/qido.js","webpack:///../../../extensions/default/src/DicomWebDataSource/utils/getImageId.js","webpack:///../../../extensions/default/src/DicomWebDataSource/utils/getWADORSImageId.js","webpack:///../../../extensions/default/src/DicomWebDataSource/wado/retrieveMetadataLoader.js","webpack:///../../../extensions/default/src/DicomWebDataSource/wado/retrieveMetadataLoaderSync.js","webpack:///../../../extensions/default/src/DicomWebDataSource/wado/retrieveMetadataLoaderAsync.js","webpack:///../../../extensions/default/src/DicomWebDataSource/wado/retrieveMetadata.js","webpack:///../../../extensions/default/src/DicomWebDataSource/retrieveStudyMetadata.js","webpack:///../../../extensions/default/src/DicomWebDataSource/utils/StaticWadoClient.ts","webpack:///../../../extensions/default/src/utils/getDirectURL.js","webpack:///../../../extensions/default/src/DicomWebDataSource/utils/fixBulkDataURI.ts","webpack:///../../../extensions/default/src/DicomWebDataSource/index.js","webpack:///../../../extensions/default/src/DicomWebDataSource/dcm4cheeReject.js","webpack:///../../../extensions/default/src/DicomJSONDataSource/index.js","webpack:///../../../extensions/default/src/DicomLocalDataSource/index.js","webpack:///../../../extensions/default/src/DicomWebProxyDataSource/index.js","webpack:///../../../extensions/default/src/getDataSourcesModule.js","webpack:///../../../extensions/default/src/Toolbar/Toolbar.tsx","webpack:///../../../extensions/default/src/ViewerLayout/index.tsx","webpack:///../../../extensions/default/src/Panels/PanelStudyBrowser.tsx","webpack:///../../../extensions/default/src/Panels/getImageSrcFromImageId.js","webpack:///../../../extensions/default/src/Panels/getStudiesForPatientByMRN.js","webpack:///../../../extensions/default/src/Panels/requestDisplaySetCreationForStudy.js","webpack:///../../../extensions/default/src/Panels/WrappedPanelStudyBrowser.tsx","webpack:///../../../extensions/default/src/Panels/ActionButtons.tsx","webpack:///../../../extensions/default/src/Panels/createReportDialogPrompt.tsx","webpack:///../../../extensions/default/src/Actions/createReportAsync.tsx","webpack:///../../../extensions/default/src/utils/getNextSRSeriesNumber.js","webpack:///../../../extensions/default/src/utils/findSRWithSameSeriesDescription.ts","webpack:///../../../extensions/default/src/Panels/PanelMeasurementTable.tsx","webpack:///../../../extensions/default/src/getPanelModule.tsx","webpack:///../../../extensions/default/src/id.js","webpack:///../../../extensions/default/src/getSopClassHandlerModule.js","webpack:///../../../extensions/default/src/Toolbar/ToolbarDivider.tsx","webpack:///../../../extensions/default/src/Toolbar/ToolbarLayoutSelector.tsx","webpack:///../../../extensions/default/src/Toolbar/ToolbarSplitButton.tsx","webpack:///../../../extensions/default/src/CustomizableContextMenu/ContextMenuItemsBuilder.ts","webpack:///../../../extensions/default/src/CustomizableContextMenu/ContextMenuController.tsx","webpack:///../../../extensions/default/src/CustomizableContextMenu/defaultContextMenu.ts","webpack:///../../../extensions/default/src/DicomTagBrowser/DicomTagTable.tsx","webpack:///../../../extensions/default/src/DicomTagBrowser/DicomTagBrowser.tsx","webpack:///../../../extensions/default/src/utils/reuseCachedLayouts.ts","webpack:///../../../extensions/default/src/findViewportsByPosition.ts","webpack:///../../../extensions/default/src/commandsModule.ts","webpack:///../../../extensions/default/src/hpMNGrid.ts","webpack:///../../../extensions/default/src/getHangingProtocolModule.js","webpack:///../../../extensions/default/src/Panels/DataSourceSelector.tsx","webpack:///../../../extensions/default/src/getPTImageIdInstanceMetadata.ts","webpack:///../../../extensions/default/src/init.ts","webpack:///../../../extensions/default/src/index.ts","webpack:///../../../extensions/default/src/getLayoutTemplateModule.js","webpack:///../../../extensions/default/src/getToolbarModule.tsx","webpack:///../../../extensions/default/src/getCustomizationModule.tsx"],"sourcesContent":["/**\n * QIDO - Query based on ID for DICOM Objects\n * search for studies, series and instances by patient ID, and receive their\n * unique identifiers for further usage.\n *\n * Quick: https://www.dicomstandard.org/dicomweb/query-qido-rs/\n * Standard: http://dicom.nema.org/medical/dicom/current/output/html/part18.html#sect_10.6\n *\n * Routes:\n * ==========\n * /studies?\n * /studies/{studyInstanceUid}/series?\n * /studies/{studyInstanceUid}/series/{seriesInstanceUid}/instances?\n *\n * Query Parameters:\n * ================\n * | KEY              | VALUE              |\n * |------------------|--------------------|\n * | {attributeId}    | {value}            |\n * | includeField     | {attribute} or all |\n * | fuzzymatching    | true OR false      |\n * | limit            | {number}           |\n * | offset           | {number}           |\n */\nimport { DICOMWeb, utils } from '@ohif/core';\nimport { sortStudySeries } from '@ohif/core/src/utils/sortStudy';\n\nconst { getString, getName, getModalities } = DICOMWeb;\n\n/**\n * Parses resulting data from a QIDO call into a set of Study MetaData\n *\n * @param {Array} qidoStudies - An array of study objects. Each object contains a keys for DICOM tags.\n * @param {object} qidoStudies[0].qidoStudy - An object where each key is the DICOM Tag group+element\n * @param {object} qidoStudies[0].qidoStudy[dicomTag] - Optional object that represents DICOM Tag\n * @param {string} qidoStudies[0].qidoStudy[dicomTag].vr - Value Representation\n * @param {string[]} qidoStudies[0].qidoStudy[dicomTag].Value - Optional string array representation of the DICOM Tag's value\n * @returns {Array} An array of Study MetaData objects\n */\nfunction processResults(qidoStudies) {\n  if (!qidoStudies || !qidoStudies.length) {\n    return [];\n  }\n\n  const studies = [];\n\n  qidoStudies.forEach(qidoStudy =>\n    studies.push({\n      studyInstanceUid: getString(qidoStudy['0020000D']),\n      date: getString(qidoStudy['00080020']), // YYYYMMDD\n      time: getString(qidoStudy['00080030']), // HHmmss.SSS (24-hour, minutes, seconds, fractional seconds)\n      accession: getString(qidoStudy['00080050']) || '', // short string, probably a number?\n      mrn: getString(qidoStudy['00100020']) || '', // medicalRecordNumber\n      patientName: utils.formatPN(getName(qidoStudy['00100010'])) || '',\n      instances: Number(getString(qidoStudy['00201208'])) || 0, // number\n      description: getString(qidoStudy['00081030']) || '',\n      modalities:\n        getString(\n          getModalities(qidoStudy['00080060'], qidoStudy['00080061'])\n        ) || '',\n    })\n  );\n\n  return studies;\n}\n\n/**\n * Parses resulting data from a QIDO call into a set of Study MetaData\n *\n * @param {Array} qidoSeries - An array of study objects. Each object contains a keys for DICOM tags.\n * @param {object} qidoSeries[0].qidoSeries - An object where each key is the DICOM Tag group+element\n * @param {object} qidoSeries[0].qidoSeries[dicomTag] - Optional object that represents DICOM Tag\n * @param {string} qidoSeries[0].qidoSeries[dicomTag].vr - Value Representation\n * @param {string[]} qidoSeries[0].qidoSeries[dicomTag].Value - Optional string array representation of the DICOM Tag's value\n * @returns {Array} An array of Study MetaData objects\n */\nexport function processSeriesResults(qidoSeries) {\n  const series = [];\n\n  if (qidoSeries && qidoSeries.length) {\n    qidoSeries.forEach(qidoSeries =>\n      series.push({\n        studyInstanceUid: getString(qidoSeries['0020000D']),\n        seriesInstanceUid: getString(qidoSeries['0020000E']),\n        modality: getString(qidoSeries['00080060']),\n        seriesNumber: getString(qidoSeries['00200011']),\n        seriesDate: utils.formatDate(getString(qidoSeries['00080021'])),\n        numSeriesInstances: Number(getString(qidoSeries['00201209'])),\n        description: getString(qidoSeries['0008103E']),\n      })\n    );\n  }\n\n  sortStudySeries(series);\n\n  return series;\n}\n\n/**\n *\n * @param {object} dicomWebClient - Client similar to what's provided by `dicomweb-client` library\n * @param {function} dicomWebClient.searchForStudies -\n * @param {string} [studyInstanceUid]\n * @param {string} [seriesInstanceUid]\n * @param {string} [queryParamaters]\n * @returns {Promise<results>} - Promise that resolves results\n */\nasync function search(\n  dicomWebClient,\n  studyInstanceUid,\n  seriesInstanceUid,\n  queryParameters\n) {\n  let searchResult = await dicomWebClient.searchForStudies({\n    studyInstanceUid: undefined,\n    queryParams: queryParameters,\n  });\n\n  return searchResult;\n}\n\n/**\n *\n * @param {string} studyInstanceUID - ID of study to return a list of series for\n * @returns {Promise} - Resolves SeriesMetadata[] in study\n */\nexport function seriesInStudy(dicomWebClient, studyInstanceUID) {\n  // Series Description\n  // Already included?\n  const commaSeparatedFields = ['0008103E', '00080021'].join(',');\n  const queryParams = {\n    includefield: commaSeparatedFields,\n  };\n\n  return dicomWebClient.searchForSeries({ studyInstanceUID, queryParams });\n}\n\nexport default function searchStudies(server, filter) {\n  const queryParams = getQIDOQueryParams(\n    filter,\n    server.qidoSupportsIncludeField\n  );\n  const options = {\n    queryParams,\n  };\n\n  return dicomWeb.searchForStudies(options).then(resultDataToStudies);\n}\n\n/**\n * Produces a QIDO URL given server details and a set of specified search filter\n * items\n *\n * @param filter\n * @param serverSupportsQIDOIncludeField\n * @returns {string} The URL with encoded filter query data\n */\nfunction mapParams(params, options = {}) {\n  if (!params) {\n    return;\n  }\n  const commaSeparatedFields = [\n    '00081030', // Study Description\n    '00080060', // Modality\n    // Add more fields here if you want them in the result\n  ].join(',');\n\n  const { supportsWildcard } = options;\n  const withWildcard = value => {\n    return supportsWildcard && value ? `*${value}*` : value;\n  };\n\n  const parameters = {\n    // Named\n    PatientName: withWildcard(params.patientName),\n    //PatientID: withWildcard(params.patientId),\n    '00100020': withWildcard(params.patientId), // Temporarily to make the tests pass with dicomweb-server.. Apparently it's broken?\n    AccessionNumber: withWildcard(params.accessionNumber),\n    StudyDescription: withWildcard(params.studyDescription),\n    ModalitiesInStudy: params.modalitiesInStudy,\n    // Other\n    limit: params.limit || 101,\n    offset: params.offset || 0,\n    fuzzymatching: options.supportsFuzzyMatching === true,\n    includefield: commaSeparatedFields, // serverSupportsQIDOIncludeField ? commaSeparatedFields : 'all',\n  };\n\n  // build the StudyDate range parameter\n  if (params.startDate && params.endDate) {\n    parameters.StudyDate = `${params.startDate}-${params.endDate}`;\n  } else if (params.startDate) {\n    const today = new Date();\n    const DD = String(today.getDate()).padStart(2, '0');\n    const MM = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!\n    const YYYY = today.getFullYear();\n    const todayStr = `${YYYY}${MM}${DD}`;\n\n    parameters.StudyDate = `${params.startDate}-${todayStr}`;\n  } else if (params.endDate) {\n    const oldDateStr = `19700102`;\n\n    parameters.StudyDate = `${oldDateStr}-${params.endDate}`;\n  }\n\n  // Build the StudyInstanceUID parameter\n  if (params.studyInstanceUid) {\n    let studyUids = params.studyInstanceUid;\n    studyUids = Array.isArray(studyUids) ? studyUids.join() : studyUids;\n    studyUids = studyUids.replace(/[^0-9.]+/g, '\\\\');\n    parameters.StudyInstanceUID = studyUids;\n  }\n\n  // Clean query params of undefined values.\n  const final = {};\n  Object.keys(parameters).forEach(key => {\n    if (parameters[key] !== undefined && parameters[key] !== '') {\n      final[key] = parameters[key];\n    }\n  });\n\n  return final;\n}\n\nexport { mapParams, search, processResults };\n","import getWADORSImageId from './getWADORSImageId';\n\nfunction buildInstanceWadoUrl(config, instance) {\n  const { StudyInstanceUID, SeriesInstanceUID, SOPInstanceUID } = instance;\n  const params = [];\n\n  params.push('requestType=WADO');\n  params.push(`studyUID=${StudyInstanceUID}`);\n  params.push(`seriesUID=${SeriesInstanceUID}`);\n  params.push(`objectUID=${SOPInstanceUID}`);\n  params.push('contentType=application/dicom');\n  params.push('transferSyntax=*');\n\n  const paramString = params.join('&');\n\n  return `${config.wadoUriRoot}?${paramString}`;\n}\n\n/**\n * Obtain an imageId for Cornerstone from an image instance\n *\n * @param instance\n * @param frame\n * @param thumbnail\n * @returns {string} The imageId to be used by Cornerstone\n */\nexport default function getImageId({\n  instance,\n  frame,\n  config,\n  thumbnail = false,\n}) {\n  if (!instance) {\n    return;\n  }\n\n  if (instance.url) {\n    return instance.url;\n  }\n\n  const renderingAttr = thumbnail ? 'thumbnailRendering' : 'imageRendering';\n\n  if (!config[renderingAttr] || config[renderingAttr] === 'wadouri') {\n    const wadouri = buildInstanceWadoUrl(config, instance);\n\n    let imageId = 'dicomweb:' + wadouri;\n    if (frame !== undefined) {\n      imageId += '&frame=' + frame;\n    }\n\n    return imageId;\n  } else {\n    return getWADORSImageId(instance, config, frame); // WADO-RS Retrieve Frame\n  }\n}\n","function buildInstanceWadoRsUri(instance, config) {\n  const { StudyInstanceUID, SeriesInstanceUID, SOPInstanceUID } = instance;\n  return `${config.wadoRoot}/studies/${StudyInstanceUID}/series/${SeriesInstanceUID}/instances/${SOPInstanceUID}`;\n}\n\nfunction buildInstanceFrameWadoRsUri(instance, config, frame) {\n  const baseWadoRsUri = buildInstanceWadoRsUri(instance, config);\n\n  frame = frame || 1;\n\n  return `${baseWadoRsUri}/frames/${frame}`;\n}\n\n// function getWADORSImageUrl(instance, frame) {\n//   const wadorsuri = buildInstanceFrameWadoRsUri(instance, config, frame);\n\n//   if (!wadorsuri) {\n//     return;\n//   }\n\n//   // Use null to obtain an imageId which represents the instance\n//   if (frame === null) {\n//     wadorsuri = wadorsuri.replace(/frames\\/(\\d+)/, '');\n//   } else {\n//     // We need to sum 1 because WADO-RS frame number is 1-based\n//     frame = frame ? parseInt(frame) + 1 : 1;\n\n//     // Replaces /frame/1 by /frame/{frame}\n//     wadorsuri = wadorsuri.replace(/frames\\/(\\d+)/, `frames/${frame}`);\n//   }\n\n//   return wadorsuri;\n// }\n\n/**\n * Obtain an imageId for Cornerstone based on the WADO-RS scheme\n *\n * @param {object} instanceMetada metadata object (InstanceMetadata)\n * @param {(string\\|number)} [frame] the frame number\n * @returns {string} The imageId to be used by Cornerstone\n */\nexport default function getWADORSImageId(instance, config, frame) {\n  //const uri = getWADORSImageUrl(instance, frame);\n  const uri = buildInstanceFrameWadoRsUri(instance, config, frame);\n\n  if (!uri) {\n    return;\n  }\n\n  return `wadors:${uri}`;\n}\n","/**\n * Class to define inheritance of load retrieve strategy.\n * The process can be async load (lazy) or sync load\n *\n * There are methods that must be implemented at consumer level\n * To retrieve study call execLoad\n */\nexport default class RetrieveMetadataLoader {\n  /**\n   * @constructor\n   * @param {Object} client The dicomweb-client.\n   * @param {Array} studyInstanceUID Study instance ui to be retrieved\n   * @param {Object} [filters] - Object containing filters to be applied on retrieve metadata process\n   * @param {string} [filter.seriesInstanceUID] - series instance uid to filter results against\n   * @param {Function} [sortSeries] - Custom sort function for series\n   */\n  constructor(\n    client,\n    studyInstanceUID,\n    filters = {},\n    sortCriteria,\n    sortFunction\n  ) {\n    this.client = client;\n    this.studyInstanceUID = studyInstanceUID;\n    this.filters = filters;\n    this.sortCriteria = sortCriteria;\n    this.sortFunction = sortFunction;\n  }\n\n  async execLoad() {\n    const preLoadData = await this.preLoad();\n    const loadData = await this.load(preLoadData);\n    const postLoadData = await this.posLoad(loadData);\n\n    return postLoadData;\n  }\n\n  /**\n   * It iterates over given loaders running each one. Loaders parameters must be bind when getting it.\n   * @param {Array} loaders - array of loader to retrieve data.\n   */\n  async runLoaders(loaders) {\n    let result;\n    for (const loader of loaders) {\n      try {\n        result = await loader();\n        if (result && result.length) {\n          break; // closes iterator in case data is retrieved successfully\n        }\n      } catch (e) {\n        throw e;\n      }\n    }\n\n    if (loaders.next().done && !result) {\n      throw new Error('RetrieveMetadataLoader failed');\n    }\n\n    return result;\n  }\n\n  // Methods to be overwrite\n  async configLoad() {}\n  async preLoad() {}\n  async load(preLoadData) {}\n  async posLoad(loadData) {}\n}\n","// import { api } from 'dicomweb-client';\n// import DICOMWeb from '../../../DICOMWeb/';\nimport { createStudyFromSOPInstanceList } from './studyInstanceHelpers';\nimport RetrieveMetadataLoader from './retrieveMetadataLoader';\n\n/**\n * Class for sync load of study metadata.\n * It inherits from RetrieveMetadataLoader\n *\n * A list of loaders (getLoaders) can be created so, it will be applied a fallback load strategy.\n * I.e Retrieve metadata using all loaders possibilities.\n */\nexport default class RetrieveMetadataLoaderSync extends RetrieveMetadataLoader {\n  getOptions() {\n    const { studyInstanceUID, filters } = this;\n\n    const options = {\n      studyInstanceUID,\n    };\n\n    const { seriesInstanceUID } = filters;\n    if (seriesInstanceUID) {\n      options['seriesInstanceUID'] = seriesInstanceUID;\n    }\n\n    return options;\n  }\n\n  /**\n   * @returns {Array} Array of loaders. To be consumed as queue\n   */\n  *getLoaders() {\n    const loaders = [];\n    const {\n      studyInstanceUID,\n      filters: { seriesInstanceUID } = {},\n      client,\n    } = this;\n\n    if (seriesInstanceUID) {\n      loaders.push(\n        client.retrieveSeriesMetadata.bind(client, {\n          studyInstanceUID,\n          seriesInstanceUID,\n        })\n      );\n    }\n\n    loaders.push(\n      client.retrieveStudyMetadata.bind(client, { studyInstanceUID })\n    );\n\n    yield* loaders;\n  }\n\n  async load(preLoadData) {\n    const loaders = this.getLoaders();\n    const result = this.runLoaders(loaders);\n    return result;\n  }\n\n  async posLoad(loadData) {\n    return loadData;\n  }\n}\n","import dcmjs from 'dcmjs';\nimport {\n  sortStudySeries,\n  sortingCriteria,\n} from '@ohif/core/src/utils/sortStudy';\nimport RetrieveMetadataLoader from './retrieveMetadataLoader';\n\n/**\n * Creates an immutable series loader object which loads each series sequentially using the iterator interface\n * @param {DICOMWebClient} dicomWebClient The DICOMWebClient instance to be used for series load\n * @param {string} studyInstanceUID The Study Instance UID from which series will be loaded\n * @param {Array} seriesInstanceUIDList A list of Series Instance UIDs\n * @returns {Object} Returns an object which supports loading of instances from each of given Series Instance UID\n */\nfunction makeSeriesAsyncLoader(\n  client,\n  studyInstanceUID,\n  seriesInstanceUIDList\n) {\n  return Object.freeze({\n    hasNext() {\n      return seriesInstanceUIDList.length > 0;\n    },\n    async next() {\n      const seriesInstanceUID = seriesInstanceUIDList.shift();\n      return client.retrieveSeriesMetadata({\n        studyInstanceUID,\n        seriesInstanceUID,\n      });\n    },\n  });\n}\n\n/**\n * Class for async load of study metadata.\n * It inherits from RetrieveMetadataLoader\n *\n * It loads the one series and then append to seriesLoader the others to be consumed/loaded\n */\nexport default class RetrieveMetadataLoaderAsync extends RetrieveMetadataLoader {\n  /**\n   * @returns {Array} Array of preLoaders. To be consumed as queue\n   */\n  *getPreLoaders() {\n    const preLoaders = [];\n    const {\n      studyInstanceUID,\n      filters: { seriesInstanceUID } = {},\n      client,\n    } = this;\n\n    if (seriesInstanceUID) {\n      const options = {\n        studyInstanceUID,\n        queryParams: { SeriesInstanceUID: seriesInstanceUID },\n      };\n      preLoaders.push(client.searchForSeries.bind(client, options));\n    }\n    // Fallback preloader\n    preLoaders.push(client.searchForSeries.bind(client, { studyInstanceUID }));\n\n    yield* preLoaders;\n  }\n\n  async preLoad() {\n    const preLoaders = this.getPreLoaders();\n    const result = await this.runLoaders(preLoaders);\n    const sortCriteria = this.sortCriteria;\n    const sortFunction = this.sortFunction;\n\n    const { naturalizeDataset } = dcmjs.data.DicomMetaDictionary;\n    const naturalized = result.map(naturalizeDataset);\n\n    return sortStudySeries(\n      naturalized,\n      sortCriteria ||\n        sortingCriteria.seriesSortCriteria.seriesInfoSortingCriteria,\n      sortFunction\n    );\n  }\n\n  async load(preLoadData) {\n    const { client, studyInstanceUID } = this;\n\n    const seriesInstanceUIDs = preLoadData.map(s => s.SeriesInstanceUID);\n\n    const seriesAsyncLoader = makeSeriesAsyncLoader(\n      client,\n      studyInstanceUID,\n      seriesInstanceUIDs\n    );\n\n    const promises = [];\n\n    while (seriesAsyncLoader.hasNext()) {\n      promises.push(seriesAsyncLoader.next());\n    }\n\n    return {\n      preLoadData,\n      promises,\n    };\n  }\n\n  async posLoad({ preLoadData, promises }) {\n    return {\n      preLoadData,\n      promises,\n    };\n  }\n}\n","import RetrieveMetadataLoaderSync from './retrieveMetadataLoaderSync';\nimport RetrieveMetadataLoaderAsync from './retrieveMetadataLoaderAsync';\n\n/**\n * Retrieve Study metadata from a DICOM server. If the server is configured to use lazy load, only the first series\n * will be loaded and the property \"studyLoader\" will be set to let consumer load remaining series as needed.\n *\n * @param {Object} dicomWebClient The dicomweb-client.\n * @param {string} studyInstanceUid The Study Instance UID of the study which needs to be loaded\n * @param {Object} [filters] - Object containing filters to be applied on retrieve metadata process\n * @param {string} [filter.seriesInstanceUID] - series instance uid to filter results against\n * @returns {Object} A study descriptor object\n */\nasync function RetrieveMetadata(\n  dicomWebClient,\n  studyInstanceUid,\n  enableStudyLazyLoad,\n  filters = {},\n  sortCriteria,\n  sortFunction\n) {\n  const RetrieveMetadataLoader =\n    enableStudyLazyLoad !== false\n      ? RetrieveMetadataLoaderAsync\n      : RetrieveMetadataLoaderSync;\n\n  const retrieveMetadataLoader = new RetrieveMetadataLoader(\n    dicomWebClient,\n    studyInstanceUid,\n    filters,\n    sortCriteria,\n    sortFunction\n  );\n  const data = await retrieveMetadataLoader.execLoad();\n\n  return data;\n}\n\nexport default RetrieveMetadata;\n","import RetrieveMetadata from './wado/retrieveMetadata.js';\n\nconst moduleName = 'RetrieveStudyMetadata';\n// Cache for promises. Prevents unnecessary subsequent calls to the server\nconst StudyMetaDataPromises = new Map();\n\n/**\n * Retrieves study metadata\n *\n * @param {Object} server Object with server configuration parameters\n * @param {string} StudyInstanceUID The UID of the Study to be retrieved\n * @param {boolean} enabledStudyLazyLoad Whether the study metadata should be loaded asynchronusly.\n * @param {function} storeInstancesCallback A callback used to store the retrieved instance metadata.\n * @param {Object} [filters] - Object containing filters to be applied on retrieve metadata process\n * @param {string} [filter.seriesInstanceUID] - series instance uid to filter results against\n * @returns {Promise} that will be resolved with the metadata or rejected with the error\n */\nexport function retrieveStudyMetadata(\n  dicomWebClient,\n  StudyInstanceUID,\n  enableStudyLazyLoad,\n  filters,\n  sortCriteria,\n  sortFunction\n) {\n  // @TODO: Whenever a study metadata request has failed, its related promise will be rejected once and for all\n  // and further requests for that metadata will always fail. On failure, we probably need to remove the\n  // corresponding promise from the \"StudyMetaDataPromises\" map...\n\n  if (!dicomWebClient) {\n    throw new Error(\n      `${moduleName}: Required 'dicomWebClient' parameter not provided.`\n    );\n  }\n  if (!StudyInstanceUID) {\n    throw new Error(\n      `${moduleName}: Required 'StudyInstanceUID' parameter not provided.`\n    );\n  }\n\n  // Already waiting on result? Return cached promise\n  if (StudyMetaDataPromises.has(StudyInstanceUID)) {\n    return StudyMetaDataPromises.get(StudyInstanceUID);\n  }\n\n  // Create a promise to handle the data retrieval\n  const promise = new Promise((resolve, reject) => {\n    RetrieveMetadata(\n      dicomWebClient,\n      StudyInstanceUID,\n      enableStudyLazyLoad,\n      filters,\n      sortCriteria,\n      sortFunction\n    ).then(function(data) {\n      resolve(data);\n    }, reject);\n  });\n\n  // Store the promise in cache\n  StudyMetaDataPromises.set(StudyInstanceUID, promise);\n\n  return promise;\n}\n\n/**\n * Delete the cached study metadata retrieval promise to ensure that the browser will\n * re-retrieve the study metadata when it is next requested\n *\n * @param {String} StudyInstanceUID The UID of the Study to be removed from cache\n *\n */\nexport function deleteStudyMetadataPromise(StudyInstanceUID) {\n  if (StudyMetaDataPromises.has(StudyInstanceUID)) {\n    StudyMetaDataPromises.delete(StudyInstanceUID);\n  }\n}\n","import { api } from 'dicomweb-client';\n\n/**\n * An implementation of the static wado client, that fetches data from\n * a static response rather than actually doing real queries.  This allows\n * fast encoding of test data, but because it is static, anything actually\n * performing searches doesn't work.  This version fixes the query issue\n * by manually implementing a query option.\n */\nexport default class StaticWadoClient extends api.DICOMwebClient {\n  static studyFilterKeys = {\n    studyinstanceuid: '0020000D',\n    patientname: '00100010',\n    '00100020': 'mrn',\n    studydescription: '00081030',\n    studydate: '00080020',\n    modalitiesinstudy: '00080061',\n    accessionnumber: '00080050',\n  };\n\n  static seriesFilterKeys = {\n    seriesinstanceuid: '0020000E',\n    seriesnumber: '00200011',\n    modality: '00080060',\n  };\n\n  constructor(qidoConfig) {\n    super(qidoConfig);\n    this.staticWado = qidoConfig.staticWado;\n  }\n\n  /**\n   * Replace the search for studies remote query with a local version which\n   * retrieves a complete query list and then sub-selects from it locally.\n   * @param {*} options\n   * @returns\n   */\n  async searchForStudies(options) {\n    if (!this.staticWado) return super.searchForStudies(options);\n\n    const searchResult = await super.searchForStudies(options);\n    const { queryParams } = options;\n\n    if (!queryParams) return searchResult;\n\n    const lowerParams = this.toLowerParams(queryParams);\n    const filtered = searchResult.filter(study => {\n      for (const key of Object.keys(StaticWadoClient.studyFilterKeys)) {\n        if (\n          !this.filterItem(\n            key,\n            lowerParams,\n            study,\n            StaticWadoClient.studyFilterKeys\n          )\n        ) {\n          return false;\n        }\n      }\n      return true;\n    });\n    return filtered;\n  }\n\n  async searchForSeries(options) {\n    if (!this.staticWado) return super.searchForSeries(options);\n\n    const searchResult = await super.searchForSeries(options);\n    const { queryParams } = options;\n    if (!queryParams) return searchResult;\n    const lowerParams = this.toLowerParams(queryParams);\n\n    const filtered = searchResult.filter(series => {\n      for (const key of Object.keys(StaticWadoClient.seriesFilterKeys)) {\n        if (\n          !this.filterItem(\n            key,\n            lowerParams,\n            series,\n            StaticWadoClient.seriesFilterKeys\n          )\n        ) {\n          return false;\n        }\n      }\n      return true;\n    });\n\n    return filtered;\n  }\n\n  /**\n   * Compares values, matching any instance of desired to any instance of\n   * actual by recursively go through the paired set of values.  That is,\n   * this is O(m*n) where m is how many items in desired and n is the length of actual\n   * Then, at the individual item node, compares the Alphabetic name if present,\n   * and does a sub-string matching on string values, and otherwise does an\n   * exact match comparison.\n   *\n   * @param {*} desired\n   * @param {*} actual\n   * @returns true if the values match\n   */\n  compareValues(desired, actual) {\n    if (Array.isArray(desired)) {\n      return desired.find(item => this.compareValues(item, actual));\n    }\n    if (Array.isArray(actual)) {\n      return actual.find(actualItem => this.compareValues(desired, actualItem));\n    }\n    if (actual?.Alphabetic) {\n      actual = actual.Alphabetic;\n    }\n    if (typeof actual == 'string') {\n      if (actual.length === 0) return true;\n      if (desired.length === 0 || desired === '*') return true;\n      if (desired[0] === '*' && desired[desired.length - 1] === '*') {\n        // console.log(`Comparing ${actual} to ${desired.substring(1, desired.length - 1)}`)\n        return actual.indexOf(desired.substring(1, desired.length - 1)) != -1;\n      } else if (desired[desired.length - 1] === '*') {\n        return actual.indexOf(desired.substring(0, desired.length - 1)) != -1;\n      } else if (desired[0] === '*') {\n        return (\n          actual.indexOf(desired.substring(1)) ===\n          actual.length - desired.length + 1\n        );\n      }\n    }\n    return desired === actual;\n  }\n\n  /** Compares a pair of dates to see if the value is within the range */\n  compareDateRange(range, value) {\n    if (!value) return true;\n    const dash = range.indexOf('-');\n    if (dash === -1) return this.compareValues(range, value);\n    const start = range.substring(0, dash);\n    const end = range.substring(dash + 1);\n    return (!start || value >= start) && (!end || value <= end);\n  }\n\n  /**\n   * Filters the return list by the query parameters.\n   *\n   * @param anyCaseKey - a possible search key\n   * @param queryParams -\n   * @param {*} study\n   * @param {*} sourceFilterMap\n   * @returns\n   */\n  filterItem(key: string, queryParams, study, sourceFilterMap) {\n    const altKey = sourceFilterMap[key] || key;\n    if (!queryParams) return true;\n    const testValue = queryParams[key] || queryParams[altKey];\n    if (!testValue) return true;\n    const valueElem = study[key] || study[altKey];\n    if (!valueElem) return false;\n    if (valueElem.vr == 'DA') {\n      return this.compareDateRange(testValue, valueElem.Value[0]);\n    }\n    const value = valueElem.Value;\n    return this.compareValues(testValue, value);\n  }\n\n  /** Converts the query parameters to lower case query parameters */\n  toLowerParams(queryParams: Record<string, unknown>): Record<string, unknown> {\n    const lowerParams = {};\n    Object.entries(queryParams).forEach(([key, value]) => {\n      lowerParams[key.toLowerCase()] = value;\n    });\n    return lowerParams;\n  }\n}\n","import { utils } from '@ohif/core';\n\n/**\n * Generates a URL that can be used for direct retrieve of the bulkdata\n *\n * @param {object} params\n * @param {string} params.tag is the tag name of the URL to retrieve\n * @param {string} params.defaultPath path for the pixel data url\n * @param {object} params.instance is the instance object that the tag is in\n * @param {string} params.defaultType is the mime type of the response\n * @param {string} params.singlepart is the type of the part to retrieve\n * @param {string} params.fetchPart unknown?\n * @returns an absolute URL to the resource, if the absolute URL can be retrieved as singlepart,\n *    or is already retrieved, or a promise to a URL for such use if a BulkDataURI\n */\nconst getDirectURL = (config, params) => {\n  const { wadoRoot, singlepart } = config;\n  const {\n    instance,\n    tag = 'PixelData',\n    defaultPath = '/pixeldata',\n    defaultType = 'video/mp4',\n    singlepart: fetchPart = 'video',\n  } = params;\n  const value = instance[tag];\n  if (!value) return undefined;\n\n  if (value.DirectRetrieveURL) return value.DirectRetrieveURL;\n  if (value.InlineBinary) {\n    const blob = utils.b64toBlob(value.InlineBinary, defaultType);\n    value.DirectRetrieveURL = URL.createObjectURL(blob);\n    return value.DirectRetrieveURL;\n  }\n  if (\n    !singlepart ||\n    (singlepart !== true && singlepart.indexOf(fetchPart) === -1)\n  ) {\n    if (value.retrieveBulkData) {\n      return value.retrieveBulkData().then(arr => {\n        value.DirectRetrieveURL = URL.createObjectURL(\n          new Blob([arr], { type: defaultType })\n        );\n        return value.DirectRetrieveURL;\n      });\n    }\n    console.warn('Unable to retrieve', tag, 'from', instance);\n    return undefined;\n  }\n\n  const { StudyInstanceUID, SeriesInstanceUID, SOPInstanceUID } = instance;\n  const BulkDataURI =\n    (value && value.BulkDataURI) ||\n    `series/${SeriesInstanceUID}/instances/${SOPInstanceUID}${defaultPath}`;\n  const hasQuery = BulkDataURI.indexOf('?') !== -1;\n  const hasAccept = BulkDataURI.indexOf('accept=') !== -1;\n  const acceptUri =\n    BulkDataURI +\n    (hasAccept ? '' : (hasQuery ? '&' : '?') + `accept=${defaultType}`);\n\n  if (tag === 'PixelData' || tag === 'EncapsulatedDocument') {\n    return `${wadoRoot}/studies/${StudyInstanceUID}/series/${SeriesInstanceUID}/instances/${SOPInstanceUID}/rendered`;\n  }\n\n  // The DICOMweb standard states that the default is multipart related, and then\n  // separately states that the accept parameter is the URL parameter equivalent of the accept header.\n  return acceptUri;\n};\n\nexport default getDirectURL;\n","/**\n * Modifies a bulkDataURI to ensure it is absolute based on the DICOMWeb configuration and\n * instance data. The modification is in-place.\n *\n * If the bulkDataURI is relative to the series or study (according to the DICOM standard),\n * it is made absolute by prepending the relevant paths.\n *\n * In scenarios where the bulkDataURI is a server-relative path (starting with '/'), the function\n * handles two cases:\n *\n * 1. If the wado root is absolute (starts with 'http'), it prepends the wado root to the bulkDataURI.\n * 2. If the wado root is relative, no changes are needed as the bulkDataURI is already correctly relative to the server root.\n *\n * @param value - The object containing BulkDataURI to be fixed.\n * @param instance - The object (DICOM instance data) containing StudyInstanceUID and SeriesInstanceUID.\n * @param dicomWebConfig - The DICOMWeb configuration object, containing wadoRoot and potentially bulkDataURI.relativeResolution.\n * @returns The function modifies `value` in-place, it does not return a value.\n */\nfunction fixBulkDataURI(value, instance, dicomWebConfig) {\n  // in case of the relative path, make it absolute. The current DICOM standard says\n  // the bulkdataURI is relative to the series. However, there are situations where\n  // it can be relative to the study too\n  if (\n    !value.BulkDataURI.startsWith('http') &&\n    !value.BulkDataURI.startsWith('/')\n  ) {\n    if (dicomWebConfig.bulkDataURI?.relativeResolution === 'studies') {\n      value.BulkDataURI = `${dicomWebConfig.wadoRoot}/studies/${instance.StudyInstanceUID}/${value.BulkDataURI}`;\n    } else if (\n      dicomWebConfig.bulkDataURI?.relativeResolution === 'series' ||\n      !dicomWebConfig.bulkDataURI?.relativeResolution\n    ) {\n      value.BulkDataURI = `${dicomWebConfig.wadoRoot}/studies/${instance.StudyInstanceUID}/series/${instance.SeriesInstanceUID}/${value.BulkDataURI}`;\n    }\n\n    return;\n  }\n\n  // in case it is relative path but starts at the server (e.g., /bulk/1e, note the missing http\n  // in the beginning and the first character is /) There are two scenarios, whether the wado root\n  // is absolute or relative. In case of absolute, we need to prepend the wado root to the bulkdata\n  // uri (e.g., bulkData: /bulk/1e, wado root: http://myserver.com/dicomweb, output: http://myserver.com/bulk/1e)\n  // and in case of relative wado root, we need to prepend the bulkdata uri to the wado root (e.g,. bulkData: /bulk/1e\n  // wado root: /dicomweb, output: /bulk/1e)\n  if (value.BulkDataURI[0] === '/') {\n    if (dicomWebConfig.wadoRoot.startsWith('http')) {\n      // Absolute wado root\n      const url = new URL(dicomWebConfig.wadoRoot);\n      value.BulkDataURI = `${url.origin}${value.BulkDataURI}`;\n    } else {\n      // Relative wado root, we don't need to do anything, bulkdata uri is already correct\n    }\n  }\n}\n\nexport { fixBulkDataURI };\n","import { api } from 'dicomweb-client';\nimport {\n  DicomMetadataStore,\n  IWebApiDataSource,\n  utils,\n  errorHandler,\n  classes,\n} from '@ohif/core';\n\nimport {\n  mapParams,\n  search as qidoSearch,\n  seriesInStudy,\n  processResults,\n  processSeriesResults,\n} from './qido.js';\nimport dcm4cheeReject from './dcm4cheeReject';\n\nimport getImageId from './utils/getImageId';\nimport dcmjs from 'dcmjs';\nimport {\n  retrieveStudyMetadata,\n  deleteStudyMetadataPromise,\n} from './retrieveStudyMetadata.js';\nimport StaticWadoClient from './utils/StaticWadoClient';\nimport getDirectURL from '../utils/getDirectURL';\nimport { fixBulkDataURI } from './utils/fixBulkDataURI';\n\nconst { DicomMetaDictionary, DicomDict } = dcmjs.data;\n\nconst { naturalizeDataset, denaturalizeDataset } = DicomMetaDictionary;\n\nconst ImplementationClassUID =\n  '2.25.270695996825855179949881587723571202391.2.0.0';\nconst ImplementationVersionName = 'OHIF-VIEWER-2.0.0';\nconst EXPLICIT_VR_LITTLE_ENDIAN = '1.2.840.10008.1.2.1';\n\nconst metadataProvider = classes.MetadataProvider;\n\n/**\n *\n * @param {string} name - Data source name\n * @param {string} wadoUriRoot - Legacy? (potentially unused/replaced)\n * @param {string} qidoRoot - Base URL to use for QIDO requests\n * @param {string} wadoRoot - Base URL to use for WADO requests\n * @param {boolean} qidoSupportsIncludeField - Whether QIDO supports the \"Include\" option to request additional fields in response\n * @param {string} imageRengering - wadors | ? (unsure of where/how this is used)\n * @param {string} thumbnailRendering - wadors | ? (unsure of where/how this is used)\n * @param {bool} supportsReject - Whether the server supports reject calls (i.e. DCM4CHEE)\n * @param {bool} lazyLoadStudy - \"enableStudyLazyLoad\"; Request series meta async instead of blocking\n * @param {string|bool} singlepart - indicates of the retrieves can fetch singlepart.  Options are bulkdata, video, image or boolean true\n */\nfunction createDicomWebApi(dicomWebConfig, userAuthenticationService) {\n  const {\n    qidoRoot,\n    wadoRoot,\n    enableStudyLazyLoad,\n    supportsFuzzyMatching,\n    supportsWildcard,\n    supportsReject,\n    staticWado,\n    singlepart,\n  } = dicomWebConfig;\n\n  const dicomWebConfigCopy = JSON.parse(JSON.stringify(dicomWebConfig));\n\n  const qidoConfig = {\n    url: qidoRoot,\n    staticWado,\n    singlepart,\n    headers: userAuthenticationService.getAuthorizationHeader(),\n    errorInterceptor: errorHandler.getHTTPErrorHandler(),\n  };\n\n  const wadoConfig = {\n    url: wadoRoot,\n    staticWado,\n    singlepart,\n    headers: userAuthenticationService.getAuthorizationHeader(),\n    errorInterceptor: errorHandler.getHTTPErrorHandler(),\n  };\n\n  // TODO -> Two clients sucks, but its better than 1000.\n  // TODO -> We'll need to merge auth later.\n  const qidoDicomWebClient = staticWado\n    ? new StaticWadoClient(qidoConfig)\n    : new api.DICOMwebClient(qidoConfig);\n\n  const wadoDicomWebClient = staticWado\n    ? new StaticWadoClient(wadoConfig)\n    : new api.DICOMwebClient(wadoConfig);\n\n  const implementation = {\n    initialize: ({ params, query }) => {\n      const { StudyInstanceUIDs: paramsStudyInstanceUIDs } = params;\n      const queryStudyInstanceUIDs = utils.splitComma(\n        query.getAll('StudyInstanceUIDs')\n      );\n\n      const StudyInstanceUIDs =\n        (queryStudyInstanceUIDs.length && queryStudyInstanceUIDs) ||\n        paramsStudyInstanceUIDs;\n      const StudyInstanceUIDsAsArray =\n        StudyInstanceUIDs && Array.isArray(StudyInstanceUIDs)\n          ? StudyInstanceUIDs\n          : [StudyInstanceUIDs];\n      return StudyInstanceUIDsAsArray;\n    },\n    query: {\n      studies: {\n        mapParams: mapParams.bind(),\n        search: async function(origParams) {\n          const headers = userAuthenticationService.getAuthorizationHeader();\n          if (headers) {\n            qidoDicomWebClient.headers = headers;\n          }\n\n          const { studyInstanceUid, seriesInstanceUid, ...mappedParams } =\n            mapParams(origParams, {\n              supportsFuzzyMatching,\n              supportsWildcard,\n            }) || {};\n\n          const results = await qidoSearch(\n            qidoDicomWebClient,\n            undefined,\n            undefined,\n            mappedParams\n          );\n\n          return processResults(results);\n        },\n        processResults: processResults.bind(),\n      },\n      series: {\n        // mapParams: mapParams.bind(),\n        search: async function(studyInstanceUid) {\n          const headers = userAuthenticationService.getAuthorizationHeader();\n          if (headers) {\n            qidoDicomWebClient.headers = headers;\n          }\n\n          const results = await seriesInStudy(\n            qidoDicomWebClient,\n            studyInstanceUid\n          );\n\n          return processSeriesResults(results);\n        },\n        // processResults: processResults.bind(),\n      },\n      instances: {\n        search: (studyInstanceUid, queryParameters) => {\n          const headers = userAuthenticationService.getAuthorizationHeader();\n          if (headers) {\n            qidoDicomWebClient.headers = headers;\n          }\n\n          qidoSearch.call(\n            undefined,\n            qidoDicomWebClient,\n            studyInstanceUid,\n            null,\n            queryParameters\n          );\n        },\n      },\n    },\n    retrieve: {\n      /**\n       * Generates a URL that can be used for direct retrieve of the bulkdata\n       *\n       * @param {object} params\n       * @param {string} params.tag is the tag name of the URL to retrieve\n       * @param {object} params.instance is the instance object that the tag is in\n       * @param {string} params.defaultType is the mime type of the response\n       * @param {string} params.singlepart is the type of the part to retrieve\n       * @returns an absolute URL to the resource, if the absolute URL can be retrieved as singlepart,\n       *    or is already retrieved, or a promise to a URL for such use if a BulkDataURI\n       */\n      directURL: params => {\n        return getDirectURL({ wadoRoot, singlepart }, params);\n      },\n      bulkDataURI: async ({ StudyInstanceUID, BulkDataURI }) => {\n        const options = {\n          multipart: false,\n          BulkDataURI,\n          StudyInstanceUID,\n        };\n        return qidoDicomWebClient.retrieveBulkData(options).then(val => {\n          const ret = (val && val[0]) || undefined;\n          return ret;\n        });\n      },\n      series: {\n        metadata: async ({\n          StudyInstanceUID,\n          filters,\n          sortCriteria,\n          sortFunction,\n          madeInClient = false,\n        } = {}) => {\n          const headers = userAuthenticationService.getAuthorizationHeader();\n          if (headers) {\n            wadoDicomWebClient.headers = headers;\n          }\n\n          if (!StudyInstanceUID) {\n            throw new Error(\n              'Unable to query for SeriesMetadata without StudyInstanceUID'\n            );\n          }\n\n          if (enableStudyLazyLoad) {\n            return implementation._retrieveSeriesMetadataAsync(\n              StudyInstanceUID,\n              filters,\n              sortCriteria,\n              sortFunction,\n              madeInClient\n            );\n          }\n\n          return implementation._retrieveSeriesMetadataSync(\n            StudyInstanceUID,\n            filters,\n            sortCriteria,\n            sortFunction,\n            madeInClient\n          );\n        },\n      },\n    },\n\n    store: {\n      dicom: async (dataset, request) => {\n        const headers = userAuthenticationService.getAuthorizationHeader();\n        if (headers) {\n          wadoDicomWebClient.headers = headers;\n        }\n\n        if (dataset instanceof ArrayBuffer) {\n          const options = {\n            datasets: [dataset],\n            request,\n          };\n\n          await wadoDicomWebClient.storeInstances(options);\n        } else {\n          const meta = {\n            FileMetaInformationVersion:\n              dataset._meta.FileMetaInformationVersion.Value,\n            MediaStorageSOPClassUID: dataset.SOPClassUID,\n            MediaStorageSOPInstanceUID: dataset.SOPInstanceUID,\n            TransferSyntaxUID: EXPLICIT_VR_LITTLE_ENDIAN,\n            ImplementationClassUID,\n            ImplementationVersionName,\n          };\n\n          const denaturalized = denaturalizeDataset(meta);\n          const dicomDict = new DicomDict(denaturalized);\n\n          dicomDict.dict = denaturalizeDataset(dataset);\n\n          const part10Buffer = dicomDict.write();\n\n          const options = {\n            datasets: [part10Buffer],\n            request,\n          };\n\n          await wadoDicomWebClient.storeInstances(options);\n        }\n      },\n    },\n\n    _retrieveSeriesMetadataSync: async (\n      StudyInstanceUID,\n      filters,\n      sortCriteria,\n      sortFunction,\n      madeInClient\n    ) => {\n      const enableStudyLazyLoad = false;\n\n      // data is all SOPInstanceUIDs\n      const data = await retrieveStudyMetadata(\n        wadoDicomWebClient,\n        StudyInstanceUID,\n        enableStudyLazyLoad,\n        filters,\n        sortCriteria,\n        sortFunction\n      );\n\n      // first naturalize the data\n      const naturalizedInstancesMetadata = data.map(naturalizeDataset);\n\n      const seriesSummaryMetadata = {};\n      const instancesPerSeries = {};\n\n      naturalizedInstancesMetadata.forEach(instance => {\n        if (!seriesSummaryMetadata[instance.SeriesInstanceUID]) {\n          seriesSummaryMetadata[instance.SeriesInstanceUID] = {\n            StudyInstanceUID: instance.StudyInstanceUID,\n            StudyDescription: instance.StudyDescription,\n            SeriesInstanceUID: instance.SeriesInstanceUID,\n            SeriesDescription: instance.SeriesDescription,\n            SeriesNumber: instance.SeriesNumber,\n            SeriesTime: instance.SeriesTime,\n            SOPClassUID: instance.SOPClassUID,\n            ProtocolName: instance.ProtocolName,\n            Modality: instance.Modality,\n          };\n        }\n\n        if (!instancesPerSeries[instance.SeriesInstanceUID]) {\n          instancesPerSeries[instance.SeriesInstanceUID] = [];\n        }\n\n        const imageId = implementation.getImageIdsForInstance({\n          instance,\n        });\n\n        instance.imageId = imageId;\n\n        metadataProvider.addImageIdToUIDs(imageId, {\n          StudyInstanceUID,\n          SeriesInstanceUID: instance.SeriesInstanceUID,\n          SOPInstanceUID: instance.SOPInstanceUID,\n        });\n\n        instancesPerSeries[instance.SeriesInstanceUID].push(instance);\n      });\n\n      // grab all the series metadata\n      const seriesMetadata = Object.values(seriesSummaryMetadata);\n      DicomMetadataStore.addSeriesMetadata(seriesMetadata, madeInClient);\n\n      Object.keys(instancesPerSeries).forEach(seriesInstanceUID =>\n        DicomMetadataStore.addInstances(\n          instancesPerSeries[seriesInstanceUID],\n          madeInClient\n        )\n      );\n    },\n\n    _retrieveSeriesMetadataAsync: async (\n      StudyInstanceUID,\n      filters,\n      sortCriteria,\n      sortFunction,\n      madeInClient = false\n    ) => {\n      const enableStudyLazyLoad = true;\n      // Get Series\n      const {\n        preLoadData: seriesSummaryMetadata,\n        promises: seriesPromises,\n      } = await retrieveStudyMetadata(\n        wadoDicomWebClient,\n        StudyInstanceUID,\n        enableStudyLazyLoad,\n        filters,\n        sortCriteria,\n        sortFunction\n      );\n\n      /**\n       * naturalizes the dataset, and adds a retrieve bulkdata method\n       * to any values containing BulkDataURI.\n       * @param {*} instance\n       * @returns naturalized dataset, with retrieveBulkData methods\n       */\n      const addRetrieveBulkData = instance => {\n        const naturalized = naturalizeDataset(instance);\n\n        // if we konw the server doesn't use bulkDataURI, then don't\n        if (!dicomWebConfig.bulkDataURI?.enabled) {\n          return naturalized;\n        }\n\n        Object.keys(naturalized).forEach(key => {\n          const value = naturalized[key];\n\n          // The value.Value will be set with the bulkdata read value\n          // in which case it isn't necessary to re-read this.\n          if (value && value.BulkDataURI && !value.Value) {\n            // Provide a method to fetch bulkdata\n            value.retrieveBulkData = () => {\n              // handle the scenarios where bulkDataURI is relative path\n              fixBulkDataURI(value, naturalized, dicomWebConfig);\n\n              const options = {\n                // The bulkdata fetches work with either multipart or\n                // singlepart, so set multipart to false to let the server\n                // decide which type to respond with.\n                multipart: false,\n                BulkDataURI: value.BulkDataURI,\n                // The study instance UID is required if the bulkdata uri\n                // is relative - that isn't disallowed by DICOMweb, but\n                // isn't well specified in the standard, but is needed in\n                // any implementation that stores static copies of the metadata\n                StudyInstanceUID: naturalized.StudyInstanceUID,\n              };\n              // Todo: this needs to be from wado dicom web client\n              return qidoDicomWebClient.retrieveBulkData(options).then(val => {\n                // There are DICOM PDF cases where the first ArrayBuffer in the array is\n                // the bulk data and DICOM video cases where the second ArrayBuffer is\n                // the bulk data. Here we play it safe and do a find.\n                const ret =\n                  (val instanceof Array &&\n                    val.find(arrayBuffer => arrayBuffer?.byteLength)) ||\n                  undefined;\n                value.Value = ret;\n                return ret;\n              });\n            };\n          }\n        });\n        return naturalized;\n      };\n\n      // Async load series, store as retrieved\n      function storeInstances(instances) {\n        const naturalizedInstances = instances.map(addRetrieveBulkData);\n\n        // Adding instanceMetadata to OHIF MetadataProvider\n        naturalizedInstances.forEach((instance, index) => {\n          instance.wadoRoot = dicomWebConfig.wadoRoot;\n          instance.wadoUri = dicomWebConfig.wadoUri;\n\n          const imageId = implementation.getImageIdsForInstance({\n            instance,\n          });\n\n          // Adding imageId to each instance\n          // Todo: This is not the best way I can think of to let external\n          // metadata handlers know about the imageId that is stored in the store\n          instance.imageId = imageId;\n\n          // Adding UIDs to metadataProvider\n          // Note: storing imageURI in metadataProvider since stack viewports\n          // will use the same imageURI\n          metadataProvider.addImageIdToUIDs(imageId, {\n            StudyInstanceUID,\n            SeriesInstanceUID: instance.SeriesInstanceUID,\n            SOPInstanceUID: instance.SOPInstanceUID,\n          });\n        });\n\n        DicomMetadataStore.addInstances(naturalizedInstances, madeInClient);\n      }\n\n      function setSuccessFlag() {\n        const study = DicomMetadataStore.getStudy(\n          StudyInstanceUID,\n          madeInClient\n        );\n        study.isLoaded = true;\n      }\n\n      // Google Cloud Healthcare doesn't return StudyInstanceUID, so we need to add\n      // it manually here\n      seriesSummaryMetadata.forEach(aSeries => {\n        aSeries.StudyInstanceUID = StudyInstanceUID;\n      });\n\n      DicomMetadataStore.addSeriesMetadata(seriesSummaryMetadata, madeInClient);\n\n      const seriesDeliveredPromises = seriesPromises.map(promise =>\n        promise.then(instances => {\n          storeInstances(instances);\n        })\n      );\n      await Promise.all(seriesDeliveredPromises);\n      setSuccessFlag();\n    },\n    deleteStudyMetadataPromise,\n    getImageIdsForDisplaySet(displaySet) {\n      const images = displaySet.images;\n      const imageIds = [];\n\n      if (!images) {\n        return imageIds;\n      }\n\n      displaySet.images.forEach(instance => {\n        const NumberOfFrames = instance.NumberOfFrames;\n\n        if (NumberOfFrames > 1) {\n          for (let frame = 1; frame <= NumberOfFrames; frame++) {\n            const imageId = this.getImageIdsForInstance({\n              instance,\n              frame,\n            });\n            imageIds.push(imageId);\n          }\n        } else {\n          const imageId = this.getImageIdsForInstance({ instance });\n          imageIds.push(imageId);\n        }\n      });\n\n      return imageIds;\n    },\n    getImageIdsForInstance({ instance, frame }) {\n      const imageIds = getImageId({\n        instance,\n        frame,\n        config: dicomWebConfig,\n      });\n      return imageIds;\n    },\n    getConfig() {\n      return dicomWebConfigCopy;\n    },\n  };\n\n  if (supportsReject) {\n    implementation.reject = dcm4cheeReject(wadoRoot);\n  }\n\n  return IWebApiDataSource.create(implementation);\n}\n\nexport { createDicomWebApi };\n","export default function (wadoRoot) {\n  return {\n    series: (StudyInstanceUID, SeriesInstanceUID) => {\n      return new Promise((resolve, reject) => {\n        // Reject because of Quality. (Seems the most sensible out of the options)\n        const CodeValueAndCodeSchemeDesignator = `113001%5EDCM`;\n\n        const url = `${wadoRoot}/studies/${StudyInstanceUID}/series/${SeriesInstanceUID}/reject/${CodeValueAndCodeSchemeDesignator}`;\n\n        const xhr = new XMLHttpRequest();\n        xhr.open('POST', url, true);\n\n        //Send the proper header information along with the request\n        // TODO -> Auth when we re-add authorization.\n\n        console.log(xhr);\n\n        xhr.onreadystatechange = function () {\n          //Call a function when the state changes.\n          if (xhr.readyState == 4) {\n            switch (xhr.status) {\n              case 204:\n                resolve(xhr.responseText);\n\n                break;\n              case 404:\n                reject('Your dataSource does not support reject functionality');\n            }\n          }\n        };\n        xhr.send();\n      });\n    },\n  };\n}\n","import { DicomMetadataStore, IWebApiDataSource } from '@ohif/core';\nimport OHIF from '@ohif/core';\n\nimport getImageId from '../DicomWebDataSource/utils/getImageId';\nimport getDirectURL from '../utils/getDirectURL';\n\nconst metadataProvider = OHIF.classes.MetadataProvider;\n\nconst mappings = {\n  studyInstanceUid: 'StudyInstanceUID',\n  patientId: 'PatientID',\n};\n\nlet _store = {\n  urls: [],\n  // {\n  //   url: url1\n  //   studies: [Study1, Study2], // if multiple studies\n  // }\n  // {\n  //   url: url2\n  //   studies: [Study1],\n  // }\n  // }\n};\n\nconst getMetaDataByURL = url => {\n  return _store.urls.find(metaData => metaData.url === url);\n};\n\nconst findStudies = (key, value) => {\n  let studies = [];\n  _store.urls.map(metaData => {\n    metaData.studies.map(aStudy => {\n      if (aStudy[key] === value) {\n        studies.push(aStudy);\n      }\n    });\n  });\n  return studies;\n};\n\nfunction createDicomJSONApi(dicomJsonConfig) {\n  const { name, wadoRoot } = dicomJsonConfig;\n\n  const implementation = {\n    initialize: async ({ params, query, url }) => {\n      if (!url) url = query.get('url');\n      let metaData = getMetaDataByURL(url);\n\n      // if we have already cached the data from this specific url\n      // We are only handling one StudyInstanceUID to run; however,\n      // all studies for patientID will be put in the correct tab\n      if (metaData) {\n        return metaData.studies.map(aStudy => {\n          return aStudy.StudyInstanceUID;\n        });\n      }\n\n      const response = await fetch(url);\n      let data = await response.json();\n\n      const studyInstanceUIDs = data.studies.map(\n        study => study.StudyInstanceUID\n      );\n\n      let StudyInstanceUID;\n      let SeriesInstanceUID;\n      data.studies.forEach(study => {\n        StudyInstanceUID = study.StudyInstanceUID;\n\n        study.series.forEach(series => {\n          SeriesInstanceUID = series.SeriesInstanceUID;\n\n          series.instances.forEach(instance => {\n            const { url: imageId, metadata: naturalizedDicom } = instance;\n\n            // Add imageId specific mapping to this data as the URL isn't necessarliy WADO-URI.\n            metadataProvider.addImageIdToUIDs(imageId, {\n              StudyInstanceUID,\n              SeriesInstanceUID,\n              SOPInstanceUID: naturalizedDicom.SOPInstanceUID,\n            });\n          });\n        });\n      });\n\n      _store.urls.push({\n        url,\n        studies: [...data.studies],\n      });\n\n      return studyInstanceUIDs;\n    },\n    query: {\n      studies: {\n        mapParams: () => { },\n        search: async param => {\n          const [key, value] = Object.entries(param)[0];\n          const mappedParam = mappings[key];\n\n          // todo: should fetch from dicomMetadataStore\n          const studies = findStudies(mappedParam, value);\n\n          return studies.map(aStudy => {\n            return {\n              accession: aStudy.AccessionNumber,\n              date: aStudy.StudyDate,\n              description: aStudy.StudyDescription,\n              instances: aStudy.NumInstances,\n              modalities: aStudy.Modalities,\n              mrn: aStudy.PatientID,\n              patientName: aStudy.PatientName,\n              studyInstanceUid: aStudy.StudyInstanceUID,\n              NumInstances: aStudy.NumInstances,\n              time: aStudy.StudyTime,\n            };\n          });\n        },\n        processResults: () => {\n          console.debug(' DICOMJson QUERY processResults');\n        },\n      },\n      series: {\n        // mapParams: mapParams.bind(),\n        search: () => {\n          console.debug(' DICOMJson QUERY SERIES SEARCH');\n        },\n      },\n      instances: {\n        search: () => {\n          console.debug(' DICOMJson QUERY instances SEARCH');\n        },\n      },\n    },\n    retrieve: {\n      /**\n       * Generates a URL that can be used for direct retrieve of the bulkdata\n       *\n       * @param {object} params\n       * @param {string} params.tag is the tag name of the URL to retrieve\n       * @param {string} params.defaultPath path for the pixel data url\n       * @param {object} params.instance is the instance object that the tag is in\n       * @param {string} params.defaultType is the mime type of the response\n       * @param {string} params.singlepart is the type of the part to retrieve\n       * @param {string} params.fetchPart unknown?\n       * @returns an absolute URL to the resource, if the absolute URL can be retrieved as singlepart,\n       *    or is already retrieved, or a promise to a URL for such use if a BulkDataURI\n       */\n      directURL: params => {\n        return getDirectURL(wadoRoot, params);\n      },\n      series: {\n        metadata: ({\n          StudyInstanceUID,\n          madeInClient = false,\n          customSort,\n        } = {}) => {\n          if (!StudyInstanceUID) {\n            throw new Error(\n              'Unable to query for SeriesMetadata without StudyInstanceUID'\n            );\n          }\n\n          const study = findStudies('StudyInstanceUID', StudyInstanceUID)[0];\n          let series;\n\n          if (customSort) {\n            series = customSort(study.series);\n          } else {\n            series = study.series;\n          }\n\n          const seriesSummaryMetadata = series.map(series => {\n            const seriesSummary = {\n              StudyInstanceUID: study.StudyInstanceUID,\n              ...series,\n            };\n            delete seriesSummary.instances;\n            return seriesSummary;\n          });\n\n          // Async load series, store as retrieved\n          function storeInstances(naturalizedInstances) {\n            DicomMetadataStore.addInstances(naturalizedInstances, madeInClient);\n          }\n\n          DicomMetadataStore.addSeriesMetadata(\n            seriesSummaryMetadata,\n            madeInClient\n          );\n\n          function setSuccessFlag() {\n            const study = DicomMetadataStore.getStudy(\n              StudyInstanceUID,\n              madeInClient\n            );\n            study.isLoaded = true;\n          }\n\n          const numberOfSeries = series.length;\n          series.forEach((series, index) => {\n            const instances = series.instances.map(instance => {\n              const obj = {\n                ...instance.metadata,\n                url: instance.url,\n                imageId: instance.url,\n                ...series,\n                ...study,\n              };\n              delete obj.instances;\n              delete obj.series;\n              return obj;\n            });\n            storeInstances(instances);\n            if (index === numberOfSeries - 1) setSuccessFlag();\n          });\n        },\n      },\n    },\n    store: {\n      dicom: () => {\n        console.debug(' DICOMJson store dicom');\n      },\n    },\n    getImageIdsForDisplaySet(displaySet) {\n      const images = displaySet.images;\n      const imageIds = [];\n\n      if (!images) {\n        return imageIds;\n      }\n\n      displaySet.images.forEach(instance => {\n        const NumberOfFrames = instance.NumberOfFrames;\n\n        if (NumberOfFrames > 1) {\n          for (let i = 0; i < NumberOfFrames; i++) {\n            const imageId = getImageId({\n              instance,\n              frame: i,\n              config: dicomJsonConfig,\n            });\n            imageIds.push(imageId);\n          }\n        } else {\n          const imageId = getImageId({ instance, config: dicomJsonConfig });\n          imageIds.push(imageId);\n        }\n      });\n\n      return imageIds;\n    },\n    getImageIdsForInstance({ instance, frame }) {\n      const imageIds = getImageId({\n        instance,\n        frame,\n      });\n      return imageIds;\n    },\n  };\n  return IWebApiDataSource.create(implementation);\n}\n\nexport { createDicomJSONApi };\n","import { DicomMetadataStore, IWebApiDataSource, utils } from '@ohif/core';\nimport OHIF from '@ohif/core';\nimport dcmjs from 'dcmjs';\n\nconst metadataProvider = OHIF.classes.MetadataProvider;\nconst { EVENTS } = DicomMetadataStore;\n\nconst END_MODALITIES = {\n  SR: true,\n  SEG: true,\n  DOC: true,\n};\n\nconst compareValue = (v1, v2, def = 0) => {\n  if (v1 === v2) return def;\n  if (v1 < v2) return -1;\n  return 1;\n};\n\n// Sorting SR modalities to be at the end of series list\nconst customSort = (seriesA, seriesB) => {\n  const instanceA = seriesA.instances[0];\n  const instanceB = seriesB.instances[0];\n  const modalityA = instanceA.Modality;\n  const modalityB = instanceB.Modality;\n\n  const isEndA = END_MODALITIES[modalityA];\n  const isEndB = END_MODALITIES[modalityB];\n\n  if (isEndA && isEndB) {\n    // Compare by series date\n    return compareValue(instanceA.SeriesNumber, instanceB.SeriesNumber);\n  }\n  if (!isEndA && !isEndB) {\n    return compareValue(instanceB.SeriesNumber, instanceA.SeriesNumber);\n  }\n  return isEndA ? -1 : 1;\n};\n\nfunction createDicomLocalApi(dicomLocalConfig) {\n  const { name } = dicomLocalConfig;\n\n  const implementation = {\n    initialize: ({ params, query }) => {\n      const { StudyInstanceUIDs: paramsStudyInstanceUIDs } = params;\n      const queryStudyInstanceUIDs = query.getAll('StudyInstanceUIDs');\n\n      const StudyInstanceUIDs =\n        queryStudyInstanceUIDs || paramsStudyInstanceUIDs;\n      const StudyInstanceUIDsAsArray =\n        StudyInstanceUIDs && Array.isArray(StudyInstanceUIDs)\n          ? StudyInstanceUIDs\n          : [StudyInstanceUIDs];\n\n      // Put SRs at the end of series list to make sure images are loaded first\n      StudyInstanceUIDsAsArray.forEach(StudyInstanceUID => {\n        const study = DicomMetadataStore.getStudy(StudyInstanceUID);\n        study.series = study.series.sort(customSort);\n      });\n\n      return StudyInstanceUIDsAsArray;\n    },\n    query: {\n      studies: {\n        mapParams: () => {},\n        search: params => {\n          const studyUIDs = DicomMetadataStore.getStudyInstanceUIDs();\n\n          return studyUIDs.map(StudyInstanceUID => {\n            let numInstances = 0;\n            const modalities = new Set();\n\n            // Calculating the number of instances in the study and modalities\n            // present in the study\n            const study = DicomMetadataStore.getStudy(StudyInstanceUID);\n            study.series.forEach(aSeries => {\n              numInstances += aSeries.instances.length;\n              modalities.add(aSeries.instances[0].Modality);\n            });\n\n            // first instance in the first series\n            const firstInstance = study?.series[0]?.instances[0];\n\n            if (firstInstance) {\n              return {\n                accession: firstInstance.AccessionNumber,\n                date: firstInstance.StudyDate,\n                description: firstInstance.StudyDescription,\n                mrn: firstInstance.PatientID,\n                patientName: utils.formatPN(firstInstance.PatientName),\n                studyInstanceUid: firstInstance.StudyInstanceUID,\n                time: firstInstance.StudyTime,\n                //\n                instances: numInstances,\n                modalities: Array.from(modalities).join('/'),\n                NumInstances: numInstances,\n              };\n            }\n          });\n        },\n        processResults: () => {\n          console.debug(' DICOMLocal QUERY processResults');\n        },\n      },\n      series: {\n        search: studyInstanceUID => {\n          const study = DicomMetadataStore.getStudy(studyInstanceUID);\n          return study.series.map(aSeries => {\n            const firstInstance = aSeries?.instances[0];\n            return {\n              studyInstanceUid: studyInstanceUID,\n              seriesInstanceUid: firstInstance.SeriesInstanceUID,\n              modality: firstInstance.Modality,\n              seriesNumber: firstInstance.SeriesNumber,\n              seriesDate: firstInstance.SeriesDate,\n              numSeriesInstances: aSeries.instances.length,\n              description: firstInstance.SeriesDescription,\n            };\n          });\n        },\n      },\n      instances: {\n        search: () => {\n          console.debug(' DICOMLocal QUERY instances SEARCH');\n        },\n      },\n    },\n    retrieve: {\n      directURL: params => {\n        const { instance, tag, defaultType } = params;\n\n        const value = instance[tag];\n        if (value instanceof Array && value[0] instanceof ArrayBuffer) {\n          return URL.createObjectURL(\n            new Blob([value[0]], {\n              type: defaultType,\n            })\n          );\n        }\n      },\n      series: {\n        metadata: async ({ StudyInstanceUID, madeInClient = false } = {}) => {\n          if (!StudyInstanceUID) {\n            throw new Error(\n              'Unable to query for SeriesMetadata without StudyInstanceUID'\n            );\n          }\n\n          // Instances metadata already added via local upload\n          const study = DicomMetadataStore.getStudy(\n            StudyInstanceUID,\n            madeInClient\n          );\n\n          // Series metadata already added via local upload\n          DicomMetadataStore._broadcastEvent(EVENTS.SERIES_ADDED, {\n            StudyInstanceUID,\n            madeInClient,\n          });\n\n          study.series.forEach(aSeries => {\n            const { SeriesInstanceUID } = aSeries;\n\n            const isMultiframe = aSeries.instances[0].NumberOfFrames > 1;\n\n            aSeries.instances.forEach((instance, index) => {\n              const {\n                url: imageId,\n                StudyInstanceUID,\n                SeriesInstanceUID,\n                SOPInstanceUID,\n              } = instance;\n\n              instance.imageId = imageId;\n\n              // Add imageId specific mapping to this data as the URL isn't necessarily WADO-URI.\n              metadataProvider.addImageIdToUIDs(imageId, {\n                StudyInstanceUID,\n                SeriesInstanceUID,\n                SOPInstanceUID,\n                frameIndex: isMultiframe ? index : 1,\n              });\n            });\n\n            DicomMetadataStore._broadcastEvent(EVENTS.INSTANCES_ADDED, {\n              StudyInstanceUID,\n              SeriesInstanceUID,\n              madeInClient,\n            });\n          });\n        },\n      },\n    },\n    store: {\n      dicom: naturalizedReport => {\n        const reportBlob = dcmjs.data.datasetToBlob(naturalizedReport);\n\n        //Create a URL for the binary.\n        var objectUrl = URL.createObjectURL(reportBlob);\n        window.location.assign(objectUrl);\n      },\n    },\n    getImageIdsForDisplaySet(displaySet) {\n      const images = displaySet.images;\n      const imageIds = [];\n\n      if (!images) {\n        return imageIds;\n      }\n\n      displaySet.images.forEach(instance => {\n        const NumberOfFrames = instance.NumberOfFrames;\n        if (NumberOfFrames > 1) {\n          // in multiframe we start at frame 1\n          for (let i = 1; i <= NumberOfFrames; i++) {\n            const imageId = this.getImageIdsForInstance({\n              instance,\n              frame: i,\n            });\n            imageIds.push(imageId);\n          }\n        } else {\n          const imageId = this.getImageIdsForInstance({ instance });\n          imageIds.push(imageId);\n        }\n      });\n\n      return imageIds;\n    },\n    getImageIdsForInstance({ instance, frame }) {\n      const { StudyInstanceUID, SeriesInstanceUID, SOPInstanceUID } = instance;\n      const storedInstance = DicomMetadataStore.getInstance(\n        StudyInstanceUID,\n        SeriesInstanceUID,\n        SOPInstanceUID\n      );\n\n      let imageId = storedInstance.url;\n\n      if (frame !== undefined) {\n        imageId += `&frame=${frame}`;\n      }\n\n      return imageId;\n    },\n    deleteStudyMetadataPromise() {\n      console.log('deleteStudyMetadataPromise not implemented');\n    },\n  };\n  return IWebApiDataSource.create(implementation);\n}\n\nexport { createDicomLocalApi };\n","import { IWebApiDataSource } from '@ohif/core';\nimport { createDicomWebApi } from '../DicomWebDataSource/index';\n\n/**\n * This datasource is initialized with a url that returns a JSON object with a\n * dicomWeb datasource configuration array present in a \"servers\" object.\n *\n * Only the first array item is parsed, if there are multiple items in the\n * dicomWeb configuration array\n *\n */\nfunction createDicomWebProxyApi(\n  dicomWebProxyConfig,\n  UserAuthenticationService\n) {\n  const { name } = dicomWebProxyConfig;\n  let dicomWebDelegate = undefined;\n\n  const implementation = {\n    initialize: async ({ params, query }) => {\n      let studyInstanceUIDs = [];\n\n      // there seem to be a couple of variations of the case for this parameter\n      const queryStudyInstanceUIDs =\n        query.get('studyInstanceUIDs') || query.get('studyInstanceUids');\n      if (!queryStudyInstanceUIDs) {\n        throw new Error(`No studyInstanceUids in request for '${name}'`);\n      }\n\n      const url = query.get('url');\n\n      if (!url) {\n        throw new Error(`No url for '${name}'`);\n      } else {\n        const response = await fetch(url);\n        let data = await response.json();\n        if (!data.servers?.dicomWeb?.[0]) {\n          throw new Error('Invalid configuration returned by url');\n        }\n\n        dicomWebDelegate = createDicomWebApi(\n          data.servers.dicomWeb[0],\n          UserAuthenticationService\n        );\n        studyInstanceUIDs = queryStudyInstanceUIDs.split(';');\n      }\n      return studyInstanceUIDs;\n    },\n    query: {\n      studies: {\n        search: params => dicomWebDelegate.query.studies.search(params),\n      },\n      series: {\n        search: (...args) => dicomWebDelegate.query.series.search(...args),\n      },\n      instances: {\n        search: (studyInstanceUid, queryParameters) =>\n          dicomWebDelegate.query.instances.search(\n            studyInstanceUid,\n            queryParameters\n          ),\n      },\n    },\n    retrieve: {\n      directURL: (...args) => dicomWebDelegate.retrieve.directURL(...args),\n      series: {\n        metadata: (...args) =>\n          dicomWebDelegate.retrieve.series.metadata(...args),\n      },\n    },\n    store: {\n      dicom: (...args) => dicomWebDelegate.store(...args),\n    },\n    deleteStudyMetadataPromise: (...args) =>\n      dicomWebDelegate.deleteStudyMetadataPromise(...args),\n    getImageIdsForDisplaySet: (...args) =>\n      dicomWebDelegate.getImageIdsForDisplaySet(...args),\n    getImageIdsForInstance: (...args) =>\n      dicomWebDelegate.getImageIdsForInstance(...args),\n  };\n  return IWebApiDataSource.create(implementation);\n}\n\nexport { createDicomWebProxyApi };\n","// TODO: Pull in IWebClientApi from @ohif/core\n// TODO: Use constructor to create an instance of IWebClientApi\n// TODO: Use existing DICOMWeb configuration (previously, appConfig, to configure instance)\n\nimport { createDicomWebApi } from './DicomWebDataSource/index.js';\nimport { createDicomJSONApi } from './DicomJSONDataSource/index.js';\nimport { createDicomLocalApi } from './DicomLocalDataSource/index.js';\nimport { createDicomWebProxyApi } from './DicomWebProxyDataSource/index.js';\n\n/**\n *\n */\nfunction getDataSourcesModule() {\n  return [\n    {\n      name: 'dicomweb',\n      type: 'webApi',\n      createDataSource: createDicomWebApi,\n    },\n    {\n      name: 'dicomwebproxy',\n      type: 'webApi',\n      createDataSource: createDicomWebProxyApi,\n    },\n    {\n      name: 'dicomjson',\n      type: 'jsonApi',\n      createDataSource: createDicomJSONApi,\n    },\n    {\n      name: 'dicomlocal',\n      type: 'localApi',\n      createDataSource: createDicomLocalApi,\n    },\n  ];\n}\n\nexport default getDataSourcesModule;\n","import React, { useEffect, useState } from 'react';\nimport classnames from 'classnames';\n\nexport default function Toolbar({ servicesManager }) {\n  const { toolbarService } = servicesManager.services;\n  const [toolbarButtons, setToolbarButtons] = useState([]);\n  const [buttonState, setButtonState] = useState({\n    primaryToolId: '',\n    toggles: {},\n    groups: {},\n  });\n\n  // Could track buttons and state separately...?\n  useEffect(() => {\n    const { unsubscribe: unsub1 } = toolbarService.subscribe(\n      toolbarService.EVENTS.TOOL_BAR_MODIFIED,\n      () => setToolbarButtons(toolbarService.getButtonSection('primary'))\n    );\n    const { unsubscribe: unsub2 } = toolbarService.subscribe(\n      toolbarService.EVENTS.TOOL_BAR_STATE_MODIFIED,\n      () => setButtonState({ ...toolbarService.state })\n    );\n\n    return () => {\n      unsub1();\n      unsub2();\n    };\n  }, [toolbarService]);\n\n  return (\n    <>\n      {toolbarButtons.map((toolDef, index) => {\n        const { id, Component, componentProps } = toolDef;\n        // TODO: ...\n\n        // isActive if:\n        // - id is primary?\n        // - id is in list of \"toggled on\"?\n        let isActive;\n        if (componentProps.type === 'toggle') {\n          isActive = buttonState.toggles[id];\n        }\n        // Also need... to filter list for splitButton, and set primary based on most recently clicked\n        // Also need to kill the radioGroup button's magic logic\n        // Everything should be reactive off these props, so commands can inform ToolbarService\n\n        // These can... Trigger toolbar events based on updates?\n        // Then sync using useEffect, or simply modify the state here?\n        return (\n          // The margin for separating the tools on the toolbar should go here and NOT in each individual component (button) item.\n          // This allows for the individual items to be included in other UI components where perhaps alternative margins are desired.\n          <div key={id} className={classnames('mr-1')}>\n            <Component\n              id={id}\n              {...componentProps}\n              bState={buttonState}\n              isActive={isActive}\n              onInteraction={args => toolbarService.recordInteraction(args)}\n              servicesManager={servicesManager}\n            />\n          </div>\n        );\n      })}\n    </>\n  );\n}\n","import React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { useNavigate } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { useLocation } from 'react-router';\n\nimport {\n  SidePanel,\n  ErrorBoundary,\n  UserPreferences,\n  AboutModal,\n  Header,\n  useModal,\n  LoadingIndicatorProgress,\n} from '@ohif/ui';\nimport i18n from '@ohif/i18n';\nimport {\n  ServicesManager,\n  HangingProtocolService,\n  hotkeys,\n  CommandsManager,\n} from '@ohif/core';\nimport { useAppConfig } from '@state';\nimport Toolbar from '../Toolbar/Toolbar';\n\nconst { availableLanguages, defaultLanguage, currentLanguage } = i18n;\n\nfunction ViewerLayout({\n  // From Extension Module Params\n  extensionManager,\n  servicesManager,\n  hotkeysManager,\n  commandsManager,\n  // From Modes\n  viewports,\n  ViewportGridComp,\n  leftPanels = [],\n  rightPanels = [],\n  leftPanelDefaultClosed = false,\n  rightPanelDefaultClosed = false,\n}): React.FunctionComponent {\n  const [appConfig] = useAppConfig();\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  const onClickReturnButton = () => {\n    const { pathname } = location;\n    const dataSourceIdx = pathname.indexOf('/', 1);\n    // const search =\n    //   dataSourceIdx === -1\n    //     ? undefined\n    //     : `datasources=${pathname.substring(dataSourceIdx + 1)}`;\n\n    // Todo: Handle parameters in a better way.\n    const query = new URLSearchParams(window.location.search);\n    const configUrl = query.get('configUrl');\n\n    const searchQuery = new URLSearchParams();\n    if (dataSourceIdx !== -1) {\n      searchQuery.append('datasources', pathname.substring(dataSourceIdx + 1));\n    }\n\n    if (configUrl) {\n      searchQuery.append('configUrl', configUrl);\n    }\n\n    navigate({\n      pathname: '/',\n      search: decodeURIComponent(searchQuery.toString()),\n    });\n  };\n\n  const { t } = useTranslation();\n  const { show, hide } = useModal();\n\n  const [showLoadingIndicator, setShowLoadingIndicator] = useState(\n    appConfig.showLoadingIndicator\n  );\n\n  const { hangingProtocolService } = servicesManager.services;\n\n  const { hotkeyDefinitions, hotkeyDefaults } = hotkeysManager;\n  const versionNumber = process.env.VERSION_NUMBER;\n  const commitHash = process.env.COMMIT_HASH;\n\n  const menuOptions = [\n    {\n      title: t('Header:About'),\n      icon: 'info',\n      onClick: () =>\n        show({\n          content: AboutModal,\n          title: 'About OHIF Viewer',\n          contentProps: { versionNumber, commitHash },\n        }),\n    },\n    {\n      title: t('Header:Preferences'),\n      icon: 'settings',\n      onClick: () =>\n        show({\n          title: t('UserPreferencesModal:User Preferences'),\n          content: UserPreferences,\n          contentProps: {\n            hotkeyDefaults: hotkeysManager.getValidHotkeyDefinitions(\n              hotkeyDefaults\n            ),\n            hotkeyDefinitions,\n            currentLanguage: currentLanguage(),\n            availableLanguages,\n            defaultLanguage,\n            onCancel: () => {\n              hotkeys.stopRecord();\n              hotkeys.unpause();\n              hide();\n            },\n            onSubmit: ({ hotkeyDefinitions, language }) => {\n              i18n.changeLanguage(language.value);\n              hotkeysManager.setHotkeys(hotkeyDefinitions);\n              hide();\n            },\n            onReset: () => hotkeysManager.restoreDefaultBindings(),\n            hotkeysModule: hotkeys,\n          },\n        }),\n    },\n  ];\n\n  if (appConfig.oidc) {\n    menuOptions.push({\n      title: t('Header:Logout'),\n      icon: 'power-off',\n      onClick: async () => {\n        navigate(\n          `/logout?redirect_uri=${encodeURIComponent(window.location.href)}`\n        );\n      },\n    });\n  }\n\n  /**\n   * Set body classes (tailwindcss) that don't allow vertical\n   * or horizontal overflow (no scrolling). Also guarantee window\n   * is sized to our viewport.\n   */\n  useEffect(() => {\n    document.body.classList.add('bg-black');\n    document.body.classList.add('overflow-hidden');\n    return () => {\n      document.body.classList.remove('bg-black');\n      document.body.classList.remove('overflow-hidden');\n    };\n  }, []);\n\n  const getComponent = id => {\n    const entry = extensionManager.getModuleEntry(id);\n\n    if (!entry) {\n      throw new Error(\n        `${id} is not a valid entry for an extension module, please check your configuration or make sure the extension is registered.`\n      );\n    }\n\n    let content;\n    if (entry && entry.component) {\n      content = entry.component;\n    } else {\n      throw new Error(\n        `No component found from extension ${id}. Check the reference string to the extension in your Mode configuration`\n      );\n    }\n\n    return { entry, content };\n  };\n\n  const getPanelData = id => {\n    const { content, entry } = getComponent(id);\n\n    return {\n      id: entry.id,\n      iconName: entry.iconName,\n      iconLabel: entry.iconLabel,\n      label: entry.label,\n      name: entry.name,\n      content,\n    };\n  };\n\n  useEffect(() => {\n    const { unsubscribe } = hangingProtocolService.subscribe(\n      HangingProtocolService.EVENTS.PROTOCOL_CHANGED,\n\n      // Todo: right now to set the loading indicator to false, we need to wait for the\n      // hangingProtocolService to finish applying the viewport matching to each viewport,\n      // however, this might not be the only approach to set the loading indicator to false. we need to explore this further.\n      () => {\n        setShowLoadingIndicator(false);\n      }\n    );\n\n    return () => {\n      unsubscribe();\n    };\n  }, [hangingProtocolService]);\n\n  const getViewportComponentData = viewportComponent => {\n    const { entry } = getComponent(viewportComponent.namespace);\n\n    return {\n      component: entry.component,\n      displaySetsToDisplay: viewportComponent.displaySetsToDisplay,\n    };\n  };\n\n  const leftPanelComponents = leftPanels.map(getPanelData);\n  const rightPanelComponents = rightPanels.map(getPanelData);\n  const viewportComponents = viewports.map(getViewportComponentData);\n\n  return (\n    <div>\n      <Header\n        menuOptions={menuOptions}\n        isReturnEnabled={!!appConfig.showStudyList}\n        onClickReturnButton={onClickReturnButton}\n        WhiteLabeling={appConfig.whiteLabeling}\n      >\n        <ErrorBoundary context=\"Primary Toolbar\">\n          <div className=\"relative flex justify-center\">\n            <Toolbar servicesManager={servicesManager} />\n          </div>\n        </ErrorBoundary>\n      </Header>\n      <div\n        className=\"bg-black flex flex-row items-stretch w-full overflow-hidden flex-nowrap relative\"\n        style={{ height: 'calc(100vh - 52px' }}\n      >\n        <React.Fragment>\n          {showLoadingIndicator && (\n            <LoadingIndicatorProgress className=\"h-full w-full bg-black\" />\n          )}\n          {/* LEFT SIDEPANELS */}\n          {leftPanelComponents.length ? (\n            <ErrorBoundary context=\"Left Panel\">\n              <SidePanel\n                side=\"left\"\n                activeTabIndex={leftPanelDefaultClosed ? null : 0}\n                tabs={leftPanelComponents}\n                servicesManager={servicesManager}\n              />\n            </ErrorBoundary>\n          ) : null}\n          {/* TOOLBAR + GRID */}\n          <div className=\"flex flex-col flex-1 h-full\">\n            <div className=\"flex items-center justify-center flex-1 h-full overflow-hidden bg-black relative\">\n              <ErrorBoundary context=\"Grid\">\n                <ViewportGridComp\n                  servicesManager={servicesManager}\n                  viewportComponents={viewportComponents}\n                  commandsManager={commandsManager}\n                />\n              </ErrorBoundary>\n            </div>\n          </div>\n          {rightPanelComponents.length ? (\n            <ErrorBoundary context=\"Right Panel\">\n              <SidePanel\n                side=\"right\"\n                activeTabIndex={rightPanelDefaultClosed ? null : 0}\n                tabs={rightPanelComponents}\n                servicesManager={servicesManager}\n              />\n            </ErrorBoundary>\n          ) : null}\n        </React.Fragment>\n      </div>\n    </div>\n  );\n}\n\nViewerLayout.propTypes = {\n  // From extension module params\n  extensionManager: PropTypes.shape({\n    getModuleEntry: PropTypes.func.isRequired,\n  }).isRequired,\n  commandsManager: PropTypes.instanceOf(CommandsManager),\n  servicesManager: PropTypes.instanceOf(ServicesManager),\n  // From modes\n  leftPanels: PropTypes.array,\n  rightPanels: PropTypes.array,\n  leftPanelDefaultClosed: PropTypes.bool.isRequired,\n  rightPanelDefaultClosed: PropTypes.bool.isRequired,\n  /** Responsible for rendering our grid of viewports; provided by consuming application */\n  children: PropTypes.oneOfType([PropTypes.node, PropTypes.func]).isRequired,\n};\n\nexport default ViewerLayout;\n","import React, { useState, useEffect, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { StudyBrowser, useImageViewer, useViewportGrid } from '@ohif/ui';\nimport { utils } from '@ohif/core';\n\nconst { sortStudyInstances, formatDate } = utils;\n\n/**\n *\n * @param {*} param0\n */\nfunction PanelStudyBrowser({\n  servicesManager,\n  getImageSrc,\n  getStudiesForPatientByMRN,\n  requestDisplaySetCreationForStudy,\n  dataSource,\n}) {\n  const {\n    hangingProtocolService,\n    displaySetService,\n    uiNotificationService,\n  } = servicesManager.services;\n  // Normally you nest the components so the tree isn't so deep, and the data\n  // doesn't have to have such an intense shape. This works well enough for now.\n  // Tabs --> Studies --> DisplaySets --> Thumbnails\n  const { StudyInstanceUIDs } = useImageViewer();\n  const [\n    { activeViewportIndex, viewports },\n    viewportGridService,\n  ] = useViewportGrid();\n  const [activeTabName, setActiveTabName] = useState('primary');\n  const [expandedStudyInstanceUIDs, setExpandedStudyInstanceUIDs] = useState([\n    ...StudyInstanceUIDs,\n  ]);\n  const [studyDisplayList, setStudyDisplayList] = useState([]);\n  const [displaySets, setDisplaySets] = useState([]);\n  const [thumbnailImageSrcMap, setThumbnailImageSrcMap] = useState({});\n  const isMounted = useRef(true);\n\n  const onDoubleClickThumbnailHandler = displaySetInstanceUID => {\n    let updatedViewports = [];\n    const viewportIndex = activeViewportIndex;\n    try {\n      updatedViewports = hangingProtocolService.getViewportsRequireUpdate(\n        viewportIndex,\n        displaySetInstanceUID\n      );\n    } catch (error) {\n      console.warn(error);\n      uiNotificationService.show({\n        title: 'Thumbnail Double Click',\n        message:\n          'The selected display sets could not be added to the viewport.',\n        type: 'info',\n        duration: 3000,\n      });\n    }\n\n    viewportGridService.setDisplaySetsForViewports(updatedViewports);\n  };\n\n  // ~~ studyDisplayList\n  useEffect(() => {\n    // Fetch all studies for the patient in each primary study\n    async function fetchStudiesForPatient(StudyInstanceUID) {\n      // current study qido\n      const qidoForStudyUID = await dataSource.query.studies.search({\n        studyInstanceUid: StudyInstanceUID,\n      });\n\n      let qidoStudiesForPatient = qidoForStudyUID;\n\n      // try to fetch the prior studies based on the patientID if the\n      // server can respond.\n      try {\n        qidoStudiesForPatient = await getStudiesForPatientByMRN(\n          qidoForStudyUID\n        );\n      } catch (error) {\n        console.warn(error);\n      }\n\n      const mappedStudies = _mapDataSourceStudies(qidoStudiesForPatient);\n      const actuallyMappedStudies = mappedStudies.map(qidoStudy => {\n        return {\n          studyInstanceUid: qidoStudy.StudyInstanceUID,\n          date: formatDate(qidoStudy.StudyDate),\n          description: qidoStudy.StudyDescription,\n          modalities: qidoStudy.ModalitiesInStudy,\n          numInstances: qidoStudy.NumInstances,\n        };\n      });\n\n      setStudyDisplayList(prevArray => {\n        const ret = [...prevArray];\n        for (const study of actuallyMappedStudies) {\n          if (\n            !prevArray.find(\n              it => it.studyInstanceUid === study.studyInstanceUid\n            )\n          ) {\n            ret.push(study);\n          }\n        }\n        return ret;\n      });\n    }\n\n    StudyInstanceUIDs.forEach(sid => fetchStudiesForPatient(sid));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [StudyInstanceUIDs, getStudiesForPatientByMRN]);\n\n  // // ~~ Initial Thumbnails\n  useEffect(() => {\n    const currentDisplaySets = displaySetService.activeDisplaySets;\n    currentDisplaySets.forEach(async dSet => {\n      const newImageSrcEntry = {};\n      const displaySet = displaySetService.getDisplaySetByUID(\n        dSet.displaySetInstanceUID\n      );\n      const imageIds = dataSource.getImageIdsForDisplaySet(displaySet);\n      const imageId = imageIds[Math.floor(imageIds.length / 2)];\n\n      // TODO: Is it okay that imageIds are not returned here for SR displaySets?\n      if (imageId) {\n        // When the image arrives, render it and store the result in the thumbnailImgSrcMap\n        newImageSrcEntry[dSet.displaySetInstanceUID] = await getImageSrc(\n          imageId\n        );\n        if (isMounted.current) {\n          setThumbnailImageSrcMap(prevState => {\n            return { ...prevState, ...newImageSrcEntry };\n          });\n        }\n      }\n    });\n    return () => {\n      isMounted.current = false;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // ~~ displaySets\n  useEffect(() => {\n    // TODO: Are we sure `activeDisplaySets` will always be accurate?\n    const currentDisplaySets = displaySetService.activeDisplaySets;\n    const mappedDisplaySets = _mapDisplaySets(\n      currentDisplaySets,\n      thumbnailImageSrcMap\n    );\n    sortStudyInstances(mappedDisplaySets);\n\n    setDisplaySets(mappedDisplaySets);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [thumbnailImageSrcMap]);\n\n  // ~~ subscriptions --> displaySets\n  useEffect(() => {\n    // DISPLAY_SETS_ADDED returns an array of DisplaySets that were added\n    const SubscriptionDisplaySetsAdded = displaySetService.subscribe(\n      displaySetService.EVENTS.DISPLAY_SETS_ADDED,\n      data => {\n        const { displaySetsAdded } = data;\n        displaySetsAdded.forEach(async dSet => {\n          const newImageSrcEntry = {};\n          const displaySet = displaySetService.getDisplaySetByUID(\n            dSet.displaySetInstanceUID\n          );\n          const imageIds = dataSource.getImageIdsForDisplaySet(displaySet);\n          const imageId = imageIds[Math.floor(imageIds.length / 2)];\n\n          // TODO: Is it okay that imageIds are not returned here for SR displaysets?\n          if (imageId) {\n            // When the image arrives, render it and store the result in the thumbnailImgSrcMap\n            newImageSrcEntry[dSet.displaySetInstanceUID] = await getImageSrc(\n              imageId,\n              dSet.initialViewport\n            );\n            if (isMounted.current) {\n              setThumbnailImageSrcMap(prevState => {\n                return { ...prevState, ...newImageSrcEntry };\n              });\n            }\n          }\n        });\n      }\n    );\n\n    // TODO: Will this always hold _all_ the displaySets we care about?\n    // DISPLAY_SETS_CHANGED returns `DisplaySerService.activeDisplaySets`\n    const SubscriptionDisplaySetsChanged = displaySetService.subscribe(\n      displaySetService.EVENTS.DISPLAY_SETS_CHANGED,\n      changedDisplaySets => {\n        const mappedDisplaySets = _mapDisplaySets(\n          changedDisplaySets,\n          thumbnailImageSrcMap\n        );\n        setDisplaySets(mappedDisplaySets);\n      }\n    );\n\n    return () => {\n      SubscriptionDisplaySetsAdded.unsubscribe();\n      SubscriptionDisplaySetsChanged.unsubscribe();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const tabs = _createStudyBrowserTabs(\n    StudyInstanceUIDs,\n    studyDisplayList,\n    displaySets\n  );\n\n  // TODO: Should not fire this on \"close\"\n  function _handleStudyClick(StudyInstanceUID) {\n    const shouldCollapseStudy = expandedStudyInstanceUIDs.includes(\n      StudyInstanceUID\n    );\n    const updatedExpandedStudyInstanceUIDs = shouldCollapseStudy\n      ? // eslint-disable-next-line prettier/prettier\n        [\n          ...expandedStudyInstanceUIDs.filter(\n            stdyUid => stdyUid !== StudyInstanceUID\n          ),\n        ]\n      : [...expandedStudyInstanceUIDs, StudyInstanceUID];\n\n    setExpandedStudyInstanceUIDs(updatedExpandedStudyInstanceUIDs);\n\n    if (!shouldCollapseStudy) {\n      const madeInClient = true;\n      requestDisplaySetCreationForStudy(\n        displaySetService,\n        StudyInstanceUID,\n        madeInClient\n      );\n    }\n  }\n\n  const activeDisplaySetInstanceUIDs =\n    viewports[activeViewportIndex]?.displaySetInstanceUIDs;\n\n  return (\n    <StudyBrowser\n      tabs={tabs}\n      servicesManager={servicesManager}\n      activeTabName={activeTabName}\n      onDoubleClickThumbnail={onDoubleClickThumbnailHandler}\n      activeDisplaySetInstanceUIDs={activeDisplaySetInstanceUIDs}\n      expandedStudyInstanceUIDs={expandedStudyInstanceUIDs}\n      onClickStudy={_handleStudyClick}\n      onClickTab={clickedTabName => {\n        setActiveTabName(clickedTabName);\n      }}\n    />\n  );\n}\n\nPanelStudyBrowser.propTypes = {\n  servicesManager: PropTypes.object.isRequired,\n  dataSource: PropTypes.shape({\n    getImageIdsForDisplaySet: PropTypes.func.isRequired,\n  }).isRequired,\n  getImageSrc: PropTypes.func.isRequired,\n  getStudiesForPatientByMRN: PropTypes.func.isRequired,\n  requestDisplaySetCreationForStudy: PropTypes.func.isRequired,\n};\n\nexport default PanelStudyBrowser;\n\n/**\n * Maps from the DataSource's format to a naturalized object\n *\n * @param {*} studies\n */\nfunction _mapDataSourceStudies(studies) {\n  return studies.map(study => {\n    // TODO: Why does the data source return in this format?\n    return {\n      AccessionNumber: study.accession,\n      StudyDate: study.date,\n      StudyDescription: study.description,\n      NumInstances: study.instances,\n      ModalitiesInStudy: study.modalities,\n      PatientID: study.mrn,\n      PatientName: study.patientName,\n      StudyInstanceUID: study.studyInstanceUid,\n      StudyTime: study.time,\n    };\n  });\n}\n\nfunction _mapDisplaySets(displaySets, thumbnailImageSrcMap) {\n  const thumbnailDisplaySets = [];\n  const thumbnailNoImageDisplaySets = [];\n\n  displaySets\n    .filter(ds => !ds.excludeFromThumbnailBrowser)\n    .forEach(ds => {\n      const imageSrc = thumbnailImageSrcMap[ds.displaySetInstanceUID];\n      const componentType = _getComponentType(ds.Modality);\n\n      const array =\n        componentType === 'thumbnail'\n          ? thumbnailDisplaySets\n          : thumbnailNoImageDisplaySets;\n\n      array.push({\n        displaySetInstanceUID: ds.displaySetInstanceUID,\n        description: ds.SeriesDescription || '',\n        seriesNumber: ds.SeriesNumber,\n        modality: ds.Modality,\n        seriesDate: ds.SeriesDate,\n        seriesTime: ds.SeriesTime,\n        numInstances: ds.numImageFrames,\n        countIcon: ds.countIcon,\n        StudyInstanceUID: ds.StudyInstanceUID,\n        componentType,\n        imageSrc,\n        dragData: {\n          type: 'displayset',\n          displaySetInstanceUID: ds.displaySetInstanceUID,\n          // .. Any other data to pass\n        },\n      });\n    });\n\n  return [...thumbnailDisplaySets, ...thumbnailNoImageDisplaySets];\n}\n\nconst thumbnailNoImageModalities = [\n  'SR',\n  'SEG',\n  'SM',\n  'RTSTRUCT',\n  'RTPLAN',\n  'RTDOSE',\n];\n\nfunction _getComponentType(Modality) {\n  if (thumbnailNoImageModalities.includes(Modality)) {\n    // TODO probably others.\n    return 'thumbnailNoImage';\n  }\n\n  return 'thumbnail';\n}\n\n/**\n *\n * @param {string[]} primaryStudyInstanceUIDs\n * @param {object[]} studyDisplayList\n * @param {string} studyDisplayList.studyInstanceUid\n * @param {string} studyDisplayList.date\n * @param {string} studyDisplayList.description\n * @param {string} studyDisplayList.modalities\n * @param {number} studyDisplayList.numInstances\n * @param {object[]} displaySets\n * @returns tabs - The prop object expected by the StudyBrowser component\n */\nfunction _createStudyBrowserTabs(\n  primaryStudyInstanceUIDs,\n  studyDisplayList,\n  displaySets\n) {\n  const primaryStudies = [];\n  const recentStudies = [];\n  const allStudies = [];\n\n  studyDisplayList.forEach(study => {\n    const displaySetsForStudy = displaySets.filter(\n      ds => ds.StudyInstanceUID === study.studyInstanceUid\n    );\n    const tabStudy = Object.assign({}, study, {\n      displaySets: displaySetsForStudy,\n    });\n\n    if (primaryStudyInstanceUIDs.includes(study.studyInstanceUid)) {\n      primaryStudies.push(tabStudy);\n    } else {\n      // TODO: Filter allStudies to dates within one year of current date\n      recentStudies.push(tabStudy);\n      allStudies.push(tabStudy);\n    }\n  });\n\n  const tabs = [\n    {\n      name: 'primary',\n      label: 'Primary',\n      studies: primaryStudies,\n    },\n    {\n      name: 'recent',\n      label: 'Recent',\n      studies: recentStudies,\n    },\n    {\n      name: 'all',\n      label: 'All',\n      studies: allStudies,\n    },\n  ];\n\n  return tabs;\n}\n","/**\n * @param {*} cornerstone\n * @param {*} imageId\n */\nfunction getImageSrcFromImageId(cornerstone, imageId) {\n  return new Promise((resolve, reject) => {\n    const canvas = document.createElement('canvas');\n    cornerstone.utilities\n      .loadImageToCanvas({ canvas, imageId })\n      .then(imageId => {\n        resolve(canvas.toDataURL());\n      })\n      .catch(reject);\n  });\n}\nexport default getImageSrcFromImageId;\n","async function getStudiesForPatientByMRN(dataSource, qidoForStudyUID) {\n  if (qidoForStudyUID && qidoForStudyUID.length && qidoForStudyUID[0].mrn) {\n    return dataSource.query.studies.search({\n      patientId: qidoForStudyUID[0].mrn,\n    });\n  }\n  console.log('No mrn found for', qidoForStudyUID);\n  return qidoForStudyUID;\n}\n\nexport default getStudiesForPatientByMRN;\n","function requestDisplaySetCreationForStudy(\n  dataSource,\n  displaySetService,\n  StudyInstanceUID,\n  madeInClient\n) {\n  // TODO: is this already short-circuited by the map of Retrieve promises?\n  if (\n    displaySetService.activeDisplaySets.some(\n      displaySet => displaySet.StudyInstanceUID === StudyInstanceUID\n    )\n  ) {\n    return;\n  }\n\n  dataSource.retrieve.series.metadata({ StudyInstanceUID, madeInClient });\n}\n\nexport default requestDisplaySetCreationForStudy;\n","import React from 'react';\nimport PropTypes from 'prop-types';\n//\nimport PanelStudyBrowser from './PanelStudyBrowser';\nimport getImageSrcFromImageId from './getImageSrcFromImageId';\nimport getStudiesForPatientByMRN from './getStudiesForPatientByMRN';\nimport requestDisplaySetCreationForStudy from './requestDisplaySetCreationForStudy';\n\n/**\n * Wraps the PanelStudyBrowser and provides features afforded by managers/services\n *\n * @param {object} params\n * @param {object} commandsManager\n * @param {object} extensionManager\n */\nfunction WrappedPanelStudyBrowser({\n  commandsManager,\n  extensionManager,\n  servicesManager,\n}) {\n  // TODO: This should be made available a different way; route should have\n  // already determined our datasource\n  const dataSource = extensionManager.getDataSources()[0];\n  const _getStudiesForPatientByMRN = getStudiesForPatientByMRN.bind(\n    null,\n    dataSource\n  );\n  const _getImageSrcFromImageId = _createGetImageSrcFromImageIdFn(\n    extensionManager\n  );\n  const _requestDisplaySetCreationForStudy = requestDisplaySetCreationForStudy.bind(\n    null,\n    dataSource\n  );\n\n  return (\n    <PanelStudyBrowser\n      servicesManager={servicesManager}\n      dataSource={dataSource}\n      getImageSrc={_getImageSrcFromImageId}\n      getStudiesForPatientByMRN={_getStudiesForPatientByMRN}\n      requestDisplaySetCreationForStudy={_requestDisplaySetCreationForStudy}\n    />\n  );\n}\n\n/**\n * Grabs cornerstone library reference using a dependent command from\n * the @ohif/extension-cornerstone extension. Then creates a helper function\n * that can take an imageId and return an image src.\n *\n * @param {func} getCommand - CommandManager's getCommand method\n * @returns {func} getImageSrcFromImageId - A utility function powered by\n * cornerstone\n */\nfunction _createGetImageSrcFromImageIdFn(extensionManager) {\n  const utilities = extensionManager.getModuleEntry(\n    '@ohif/extension-cornerstone.utilityModule.common'\n  );\n\n  try {\n    const { cornerstone } = utilities.exports.getCornerstoneLibraries();\n    return getImageSrcFromImageId.bind(null, cornerstone);\n  } catch (ex) {\n    throw new Error('Required command not found');\n  }\n}\n\nWrappedPanelStudyBrowser.propTypes = {\n  commandsManager: PropTypes.object.isRequired,\n  extensionManager: PropTypes.object.isRequired,\n  servicesManager: PropTypes.object.isRequired,\n};\n\nexport default WrappedPanelStudyBrowser;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { useTranslation } from 'react-i18next';\n\nimport { Button, ButtonGroup } from '@ohif/ui';\n\nfunction ActionButtons({ onExportClick, onCreateReportClick }) {\n  const { t } = useTranslation('MeasurementTable');\n\n  return (\n    <React.Fragment>\n      <ButtonGroup color=\"black\" size=\"inherit\">\n        <Button className=\"px-2 py-2 text-base\" onClick={onExportClick}>\n          {t('Export CSV')}\n        </Button>\n        <Button className=\"px-2 py-2 text-base\" onClick={onCreateReportClick}>\n          {t('Create Report')}\n        </Button>\n      </ButtonGroup>\n    </React.Fragment>\n  );\n}\n\nActionButtons.propTypes = {\n  onExportClick: PropTypes.func,\n  onCreateReportClick: PropTypes.func,\n};\n\nActionButtons.defaultProps = {\n  onExportClick: () => alert('Export'),\n  onCreateReportClick: () => alert('Create Report'),\n};\n\nexport default ActionButtons;\n","/* eslint-disable react/display-name */\nimport React from 'react';\nimport { Dialog, Input, Select } from '@ohif/ui';\n\nexport const CREATE_REPORT_DIALOG_RESPONSE = {\n  CANCEL: 0,\n  CREATE_REPORT: 1,\n};\n\nexport default function createReportDialogPrompt(\n  uiDialogService,\n  { extensionManager }\n) {\n  return new Promise(function(resolve, reject) {\n    let dialogId = undefined;\n\n    const _handleClose = () => {\n      // Dismiss dialog\n      uiDialogService.dismiss({ id: dialogId });\n      // Notify of cancel action\n      resolve({\n        action: CREATE_REPORT_DIALOG_RESPONSE.CANCEL,\n        value: undefined,\n        dataSourceName: undefined,\n      });\n    };\n\n    /**\n     *\n     * @param {string} param0.action - value of action performed\n     * @param {string} param0.value - value from input field\n     */\n    const _handleFormSubmit = ({ action, value }) => {\n      uiDialogService.dismiss({ id: dialogId });\n      switch (action.id) {\n        case 'save':\n          resolve({\n            action: CREATE_REPORT_DIALOG_RESPONSE.CREATE_REPORT,\n            value: value.label,\n            dataSourceName: value.dataSourceName,\n          });\n          break;\n        case 'cancel':\n          resolve({\n            action: CREATE_REPORT_DIALOG_RESPONSE.CANCEL,\n            value: undefined,\n            dataSourceName: undefined,\n          });\n          break;\n      }\n    };\n\n    const dataSourcesOpts = Object.keys(extensionManager.dataSourceMap)\n      .filter(ds => {\n        const configuration =\n          extensionManager.dataSourceDefs[ds]?.configuration;\n        const supportsStow =\n          configuration?.supportsStow ?? configuration?.wadoRoot;\n        return supportsStow;\n      })\n      .map(ds => {\n        return {\n          value: ds,\n          label: ds,\n          placeHolder: ds,\n        };\n      });\n\n    dialogId = uiDialogService.create({\n      centralize: true,\n      isDraggable: false,\n      content: Dialog,\n      useLastPosition: false,\n      showOverlay: true,\n      contentProps: {\n        title: 'Create Report',\n        value: {\n          label: '',\n          dataSourceName: extensionManager.activeDataSource,\n        },\n        noCloseButton: true,\n        onClose: _handleClose,\n        actions: [\n          { id: 'cancel', text: 'Cancel', type: 'primary' },\n          { id: 'save', text: 'Save', type: 'secondary' },\n        ],\n        // TODO: Should be on button press...\n        onSubmit: _handleFormSubmit,\n        body: ({ value, setValue }) => {\n          const onChangeHandler = event => {\n            event.persist();\n            setValue(value => ({ ...value, label: event.target.value }));\n          };\n          const onKeyPressHandler = event => {\n            if (event.key === 'Enter') {\n              uiDialogService.dismiss({ id: dialogId });\n              resolve({\n                action: CREATE_REPORT_DIALOG_RESPONSE.CREATE_REPORT,\n                value: value.label,\n              });\n            }\n          };\n          return (\n            <>\n              {dataSourcesOpts.length > 1 && (\n                <Select\n                  closeMenuOnSelect={true}\n                  className=\"mr-2 bg-black border-primary-main\"\n                  options={dataSourcesOpts}\n                  placeholder={\n                    dataSourcesOpts.find(\n                      option => option.value === value.dataSourceName\n                    ).placeHolder\n                  }\n                  value={value.dataSourceName}\n                  onChange={evt => {\n                    setValue(v => ({ ...v, dataSourceName: evt.value }));\n                  }}\n                  isClearable={false}\n                />\n              )}\n              <Input\n                autoFocus\n                label=\"Enter the report name\"\n                labelClassName=\"text-white text-[14px] leading-[1.2]\"\n                className=\"bg-black border-primary-main\"\n                type=\"text\"\n                value={value.label}\n                onChange={onChangeHandler}\n                onKeyPress={onKeyPressHandler}\n                required\n              />\n            </>\n          );\n        },\n      },\n    });\n  });\n}\n","import React from 'react';\nimport { DicomMetadataStore } from '@ohif/core';\n\n/**\n *\n * @param {*} servicesManager\n * @param {*} dataSource\n * @param {*} measurements\n * @param {*} options\n * @returns {string[]} displaySetInstanceUIDs\n */\nasync function createReportAsync(\n  servicesManager,\n  commandsManager,\n  dataSource,\n  measurements,\n  options\n) {\n  const {\n    displaySetService,\n    uiNotificationService,\n    uiDialogService,\n  } = servicesManager.services;\n  const loadingDialogId = uiDialogService.create({\n    showOverlay: true,\n    isDraggable: false,\n    centralize: true,\n    // TODO: Create a loading indicator component + zeplin design?\n    content: Loading,\n  });\n\n  try {\n    const naturalizedReport = await commandsManager.runCommand(\n      'storeMeasurements',\n      {\n        measurementData: measurements,\n        dataSource,\n        additionalFindingTypes: ['ArrowAnnotate'],\n        options,\n      },\n      'CORNERSTONE_STRUCTURED_REPORT'\n    );\n\n    // The \"Mode\" route listens for DicomMetadataStore changes\n    // When a new instance is added, it listens and\n    // automatically calls makeDisplaySets\n    DicomMetadataStore.addInstances([naturalizedReport], true);\n\n    const displaySetInstanceUID = displaySetService.getMostRecentDisplaySet();\n\n    uiNotificationService.show({\n      title: 'Create Report',\n      message: 'Measurements saved successfully',\n      type: 'success',\n    });\n\n    return [displaySetInstanceUID];\n  } catch (error) {\n    uiNotificationService.show({\n      title: 'Create Report',\n      message: error.message || 'Failed to store measurements',\n      type: 'error',\n    });\n  } finally {\n    uiDialogService.dismiss({ id: loadingDialogId });\n  }\n}\n\nfunction Loading() {\n  return <div className=\"text-primary-active\">Loading...</div>;\n}\n\nexport default createReportAsync;\n","const MIN_SR_SERIES_NUMBER = 4700;\n\nexport default function getNextSRSeriesNumber(displaySetService) {\n  const activeDisplaySets = displaySetService.getActiveDisplaySets();\n  const srDisplaySets = activeDisplaySets.filter(ds => ds.Modality === 'SR');\n  const srSeriesNumbers = srDisplaySets.map(ds => ds.SeriesNumber);\n  const maxSeriesNumber = Math.max(...srSeriesNumbers, MIN_SR_SERIES_NUMBER);\n\n  return maxSeriesNumber + 1;\n}\n","import { DisplaySetService, Types } from '@ohif/core';\n\nimport getNextSRSeriesNumber from './getNextSRSeriesNumber';\n\n/**\n * Find an SR having the same series description.\n * This is used by the store service in order to store DICOM SR's having the\n * same Series Description into a single series under consecutive instance numbers\n * That way, they are all organized as a set and could have tools to view\n * \"prior\" SR instances.\n *\n * @param SeriesDescription - is the description to look for\n * @param displaySetService - the display sets to search for DICOM SR in\n * @returns SeriesMetadata from a DICOM SR having the same series description\n */\nexport default function findSRWithSameSeriesDescription(\n  SeriesDescription: string,\n  displaySetService: DisplaySetService\n): Types.SeriesMetadata {\n  const activeDisplaySets = displaySetService.getActiveDisplaySets();\n  const srDisplaySets = activeDisplaySets.filter(ds => ds.Modality === 'SR');\n  const sameSeries = srDisplaySets.find(\n    ds => ds.SeriesDescription === SeriesDescription\n  );\n  if (sameSeries) {\n    console.log('Storing to same series', sameSeries);\n    const { instance } = sameSeries;\n    const {\n      SeriesInstanceUID,\n      SeriesDescription,\n      SeriesDate,\n      SeriesTime,\n      SeriesNumber,\n      Modality,\n    } = instance;\n    return {\n      SeriesInstanceUID,\n      SeriesDescription,\n      SeriesDate,\n      SeriesTime,\n      SeriesNumber,\n      Modality,\n      InstanceNumber: sameSeries.instances.length + 1,\n    };\n  }\n\n  const SeriesNumber = getNextSRSeriesNumber(displaySetService);\n  return { SeriesDescription, SeriesNumber };\n}\n","import React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { utils, ServicesManager } from '@ohif/core';\nimport { MeasurementTable, Dialog, Input, useViewportGrid } from '@ohif/ui';\nimport ActionButtons from './ActionButtons';\nimport debounce from 'lodash.debounce';\n\nimport createReportDialogPrompt, {\n  CREATE_REPORT_DIALOG_RESPONSE,\n} from './createReportDialogPrompt';\nimport createReportAsync from '../Actions/createReportAsync';\nimport findSRWithSameSeriesDescription from '../utils/findSRWithSameSeriesDescription';\n\nconst { downloadCSVReport } = utils;\n\nexport default function PanelMeasurementTable({\n  servicesManager,\n  commandsManager,\n  extensionManager,\n}): React.FunctionComponent {\n  const [viewportGrid, viewportGridService] = useViewportGrid();\n  const { activeViewportIndex, viewports } = viewportGrid;\n  const {\n    measurementService,\n    uiDialogService,\n    uiNotificationService,\n    displaySetService,\n  } = (servicesManager as ServicesManager).services;\n  const [displayMeasurements, setDisplayMeasurements] = useState([]);\n\n  useEffect(() => {\n    const debouncedSetDisplayMeasurements = debounce(\n      setDisplayMeasurements,\n      100\n    );\n    // ~~ Initial\n    setDisplayMeasurements(_getMappedMeasurements(measurementService));\n\n    // ~~ Subscription\n    const added = measurementService.EVENTS.MEASUREMENT_ADDED;\n    const addedRaw = measurementService.EVENTS.RAW_MEASUREMENT_ADDED;\n    const updated = measurementService.EVENTS.MEASUREMENT_UPDATED;\n    const removed = measurementService.EVENTS.MEASUREMENT_REMOVED;\n    const cleared = measurementService.EVENTS.MEASUREMENTS_CLEARED;\n    const subscriptions = [];\n\n    [added, addedRaw, updated, removed, cleared].forEach(evt => {\n      subscriptions.push(\n        measurementService.subscribe(evt, () => {\n          debouncedSetDisplayMeasurements(\n            _getMappedMeasurements(measurementService)\n          );\n        }).unsubscribe\n      );\n    });\n\n    return () => {\n      subscriptions.forEach(unsub => {\n        unsub();\n      });\n      debouncedSetDisplayMeasurements.cancel();\n    };\n  }, []);\n\n  async function exportReport() {\n    const measurements = measurementService.getMeasurements();\n\n    downloadCSVReport(measurements, measurementService);\n  }\n\n  async function clearMeasurements() {\n    measurementService.clearMeasurements();\n  }\n\n  async function createReport(): Promise<any> {\n    // filter measurements that are added to the active study\n    const activeViewport = viewports[activeViewportIndex];\n    const measurements = measurementService.getMeasurements();\n    const displaySet = displaySetService.getDisplaySetByUID(\n      activeViewport.displaySetInstanceUIDs[0]\n    );\n    const trackedMeasurements = measurements.filter(\n      m => displaySet.StudyInstanceUID === m.referenceStudyUID\n    );\n\n    if (trackedMeasurements.length <= 0) {\n      uiNotificationService.show({\n        title: 'No Measurements',\n        message: 'No Measurements are added to the current Study.',\n        type: 'info',\n        duration: 3000,\n      });\n      return;\n    }\n\n    const promptResult = await createReportDialogPrompt(uiDialogService, {\n      extensionManager,\n    });\n\n    if (promptResult.action === CREATE_REPORT_DIALOG_RESPONSE.CREATE_REPORT) {\n      const dataSources = extensionManager.getDataSources(\n        promptResult.dataSourceName\n      );\n      const dataSource = dataSources[0];\n\n      const SeriesDescription =\n        // isUndefinedOrEmpty\n        promptResult.value === undefined || promptResult.value === ''\n          ? 'Research Derived Series' // default\n          : promptResult.value; // provided value\n\n      // Re-use an existing series having the same series description to avoid\n      // creating too many series instances.\n      const options = findSRWithSameSeriesDescription(\n        SeriesDescription,\n        displaySetService\n      );\n\n      return createReportAsync(\n        servicesManager,\n        commandsManager,\n        dataSource,\n        trackedMeasurements,\n        options\n      );\n    }\n  }\n\n  const jumpToImage = ({ uid, isActive }) => {\n    measurementService.jumpToMeasurement(viewportGrid.activeViewportIndex, uid);\n\n    onMeasurementItemClickHandler({ uid, isActive });\n  };\n\n  const onMeasurementItemEditHandler = ({ uid, isActive }) => {\n    const measurement = measurementService.getMeasurement(uid);\n    //Todo: why we are jumping to image?\n    // jumpToImage({ id, isActive });\n\n    const onSubmitHandler = ({ action, value }) => {\n      switch (action.id) {\n        case 'save': {\n          measurementService.update(\n            uid,\n            {\n              ...measurement,\n              ...value,\n            },\n            true\n          );\n        }\n      }\n      uiDialogService.dismiss({ id: 'enter-annotation' });\n    };\n\n    uiDialogService.create({\n      id: 'enter-annotation',\n      centralize: true,\n      isDraggable: false,\n      showOverlay: true,\n      content: Dialog,\n      contentProps: {\n        title: 'Annotation',\n        noCloseButton: true,\n        value: { label: measurement.label || '' },\n        body: ({ value, setValue }) => {\n          const onChangeHandler = event => {\n            event.persist();\n            setValue(value => ({ ...value, label: event.target.value }));\n          };\n\n          const onKeyPressHandler = event => {\n            if (event.key === 'Enter') {\n              onSubmitHandler({ value, action: { id: 'save' } });\n            }\n          };\n          return (\n            <Input\n              label=\"Enter your annotation\"\n              labelClassName=\"text-white text-[14px] leading-[1.2]\"\n              autoFocus\n              id=\"annotation\"\n              className=\"bg-black border-primary-main\"\n              type=\"text\"\n              value={value.label}\n              onChange={onChangeHandler}\n              onKeyPress={onKeyPressHandler}\n            />\n          );\n        },\n        actions: [\n          // temp: swap button types until colors are updated\n          { id: 'cancel', text: 'Cancel', type: 'primary' },\n          { id: 'save', text: 'Save', type: 'secondary' },\n        ],\n        onSubmit: onSubmitHandler,\n      },\n    });\n  };\n\n  const onMeasurementItemClickHandler = ({ uid, isActive }) => {\n    if (!isActive) {\n      const measurements = [...displayMeasurements];\n      const measurement = measurements.find(m => m.uid === uid);\n\n      measurements.forEach(m => (m.isActive = m.uid !== uid ? false : true));\n      measurement.isActive = true;\n      setDisplayMeasurements(measurements);\n    }\n  };\n\n  return (\n    <>\n      <div\n        className=\"overflow-x-hidden overflow-y-auto ohif-scrollbar\"\n        data-cy={'measurements-panel'}\n      >\n        <MeasurementTable\n          title=\"Measurements\"\n          servicesManager={servicesManager}\n          data={displayMeasurements}\n          onClick={jumpToImage}\n          onEdit={onMeasurementItemEditHandler}\n        />\n      </div>\n      <div className=\"flex justify-center p-4\">\n        <ActionButtons\n          onExportClick={exportReport}\n          onClearMeasurementsClick={clearMeasurements}\n          onCreateReportClick={createReport}\n        />\n      </div>\n    </>\n  );\n}\n\nPanelMeasurementTable.propTypes = {\n  servicesManager: PropTypes.instanceOf(ServicesManager).isRequired,\n};\n\nfunction _getMappedMeasurements(measurementService) {\n  const measurements = measurementService.getMeasurements();\n\n  const mappedMeasurements = measurements.map((m, index) =>\n    _mapMeasurementToDisplay(m, index, measurementService.VALUE_TYPES)\n  );\n\n  return mappedMeasurements;\n}\n\n/**\n * Map the measurements to the display text.\n * Adds finding and site inforamtion to the displayText and/or label,\n * and provides as 'displayText' and 'label', while providing the original\n * values as baseDisplayText and baseLabel\n */\nfunction _mapMeasurementToDisplay(measurement, index, types) {\n  const {\n    displayText: baseDisplayText,\n    uid,\n    label: baseLabel,\n    type,\n    selected,\n    findingSites,\n    finding,\n  } = measurement;\n\n  const firstSite = findingSites?.[0];\n  const label = baseLabel || finding?.text || firstSite?.text || '(empty)';\n  let displayText = baseDisplayText || [];\n  if (findingSites) {\n    const siteText = [];\n    findingSites.forEach(site => {\n      if (site?.text !== label) siteText.push(site.text);\n    });\n    displayText = [...siteText, ...displayText];\n  }\n  if (finding && finding?.text !== label) {\n    displayText = [finding.text, ...displayText];\n  }\n\n  return {\n    uid,\n    label,\n    baseLabel,\n    measurementType: type,\n    displayText,\n    baseDisplayText,\n    isActive: selected,\n    finding,\n    findingSites,\n  };\n}\n","import React from 'react';\nimport { WrappedPanelStudyBrowser, PanelMeasurementTable } from './Panels';\n\n// TODO:\n// - No loading UI exists yet\n// - cancel promises when component is destroyed\n// - show errors in UI for thumbnails if promise fails\n\nfunction getPanelModule({\n  commandsManager,\n  extensionManager,\n  servicesManager,\n}) {\n  const wrappedMeasurementPanel = () => {\n    return (\n      <PanelMeasurementTable\n        commandsManager={commandsManager}\n        servicesManager={servicesManager}\n        extensionManager={extensionManager}\n      />\n    );\n  };\n\n  return [\n    {\n      name: 'seriesList',\n      iconName: 'group-layers',\n      iconLabel: 'Studies',\n      label: 'Studies',\n      component: WrappedPanelStudyBrowser.bind(null, {\n        commandsManager,\n        extensionManager,\n        servicesManager,\n      }),\n    },\n    {\n      name: 'measure',\n      iconName: 'tab-linear',\n      iconLabel: 'Measure',\n      label: 'Measurements',\n      secondaryLabel: 'Measurements',\n      component: wrappedMeasurementPanel,\n    },\n  ];\n}\n\nexport default getPanelModule;\n","import packageJson from '../package.json';\n\nconst id = packageJson.name;\n\nexport { id };\n","import { isImage } from '@ohif/core/src/utils/isImage';\nimport sopClassDictionary from '@ohif/core/src/utils/sopClassDictionary';\nimport ImageSet from '@ohif/core/src/classes/ImageSet';\nimport isDisplaySetReconstructable from '@ohif/core/src/utils/isDisplaySetReconstructable';\nimport { id } from './id';\n\nconst sopClassHandlerName = 'stack';\n\nconst isMultiFrame = instance => {\n  return instance.NumberOfFrames > 1;\n};\n\nconst makeDisplaySet = instances => {\n  const instance = instances[0];\n  const imageSet = new ImageSet(instances);\n\n  const {\n    value: isReconstructable,\n    averageSpacingBetweenFrames,\n  } = isDisplaySetReconstructable(instances);\n\n  // set appropriate attributes to image set...\n  imageSet.setAttributes({\n    displaySetInstanceUID: imageSet.uid, // create a local alias for the imageSet UID\n    SeriesDate: instance.SeriesDate,\n    SeriesTime: instance.SeriesTime,\n    SeriesInstanceUID: instance.SeriesInstanceUID,\n    StudyInstanceUID: instance.StudyInstanceUID,\n    SeriesNumber: instance.SeriesNumber || 0,\n    FrameRate: instance.FrameTime,\n    SOPClassUID: instance.SOPClassUID,\n    SeriesDescription: instance.SeriesDescription || '',\n    Modality: instance.Modality,\n    isMultiFrame: isMultiFrame(instance),\n    countIcon: isReconstructable ? 'icon-mpr' : undefined,\n    numImageFrames: instances.length,\n    SOPClassHandlerId: `${id}.sopClassHandlerModule.${sopClassHandlerName}`,\n    isReconstructable,\n    averageSpacingBetweenFrames: averageSpacingBetweenFrames || null,\n  });\n\n  // Sort the images in this series if needed\n  const shallSort = true; //!OHIF.utils.ObjectPath.get(Meteor, 'settings.public.ui.sortSeriesByIncomingOrder');\n  if (shallSort) {\n    imageSet.sortBy((a, b) => {\n      // Sort by InstanceNumber (0020,0013)\n      return (\n        (parseInt(a.InstanceNumber) || 0) - (parseInt(b.InstanceNumber) || 0)\n      );\n    });\n  }\n\n  // Include the first image instance number (after sorted)\n  /*imageSet.setAttribute(\n    'instanceNumber',\n    imageSet.getImage(0).InstanceNumber\n  );*/\n\n  /*const isReconstructable = isDisplaySetReconstructable(series, instances);\n\n  imageSet.isReconstructable = isReconstructable.value;\n\n  if (isReconstructable.missingFrames) {\n    // TODO -> This is currently unused, but may be used for reconstructing\n    // Volumes with gaps later on.\n    imageSet.missingFrames = isReconstructable.missingFrames;\n  }*/\n\n  return imageSet;\n};\n\nconst isSingleImageModality = modality => {\n  return modality === 'CR' || modality === 'MG' || modality === 'DX';\n};\n\nfunction getSopClassUids(instances) {\n  const uniqueSopClassUidsInSeries = new Set();\n  instances.forEach(instance => {\n    uniqueSopClassUidsInSeries.add(instance.SOPClassUID);\n  });\n  const sopClassUids = Array.from(uniqueSopClassUidsInSeries);\n\n  return sopClassUids;\n}\n\n/**\n * Basic SOPClassHandler:\n * - For all Image types that are stackable, create\n *   a displaySet with a stack of images\n *\n * @param {Array} sopClassHandlerModules List of SOP Class Modules\n * @param {SeriesMetadata} series The series metadata object from which the display sets will be created\n * @returns {Array} The list of display sets created for the given series object\n */\nfunction getDisplaySetsFromSeries(instances) {\n  // If the series has no instances, stop here\n  if (!instances || !instances.length) {\n    throw new Error('No instances were provided');\n  }\n\n  const displaySets = [];\n  const sopClassUids = getSopClassUids(instances);\n\n  // Search through the instances (InstanceMetadata object) of this series\n  // Split Multi-frame instances and Single-image modalities\n  // into their own specific display sets. Place the rest of each\n  // series into another display set.\n  const stackableInstances = [];\n  instances.forEach(instance => {\n    // All imaging modalities must have a valid value for sopClassUid (x00080016) or rows (x00280010)\n    if (!isImage(instance.SOPClassUID) && !instance.Rows) {\n      return;\n    }\n\n    let displaySet;\n\n    if (isMultiFrame(instance)) {\n      displaySet = makeDisplaySet([instance]);\n\n      displaySet.setAttributes({\n        sopClassUids,\n        isClip: true,\n        numImageFrames: instance.NumberOfFrames,\n        instanceNumber: instance.InstanceNumber,\n        acquisitionDatetime: instance.AcquisitionDateTime,\n      });\n      displaySets.push(displaySet);\n    } else if (isSingleImageModality(instance.Modality)) {\n      displaySet = makeDisplaySet([instance]);\n      displaySet.setAttributes({\n        sopClassUids,\n        instanceNumber: instance.InstanceNumber,\n        acquisitionDatetime: instance.AcquisitionDateTime,\n      });\n      displaySets.push(displaySet);\n    } else {\n      stackableInstances.push(instance);\n    }\n  });\n\n  if (stackableInstances.length) {\n    const displaySet = makeDisplaySet(stackableInstances);\n    displaySet.setAttribute('studyInstanceUid', instances[0].StudyInstanceUID);\n    displaySet.setAttributes({\n      sopClassUids,\n    });\n    displaySets.push(displaySet);\n  }\n\n  return displaySets;\n}\n\nconst sopClassUids = [\n  sopClassDictionary.ComputedRadiographyImageStorage,\n  sopClassDictionary.DigitalXRayImageStorageForPresentation,\n  sopClassDictionary.DigitalXRayImageStorageForProcessing,\n  sopClassDictionary.DigitalMammographyXRayImageStorageForPresentation,\n  sopClassDictionary.DigitalMammographyXRayImageStorageForProcessing,\n  sopClassDictionary.DigitalIntraOralXRayImageStorageForPresentation,\n  sopClassDictionary.DigitalIntraOralXRayImageStorageForProcessing,\n  sopClassDictionary.CTImageStorage,\n  sopClassDictionary.EnhancedCTImageStorage,\n  sopClassDictionary.LegacyConvertedEnhancedCTImageStorage,\n  sopClassDictionary.UltrasoundMultiframeImageStorage,\n  sopClassDictionary.MRImageStorage,\n  sopClassDictionary.EnhancedMRImageStorage,\n  sopClassDictionary.EnhancedMRColorImageStorage,\n  sopClassDictionary.LegacyConvertedEnhancedMRImageStorage,\n  sopClassDictionary.UltrasoundImageStorage,\n  sopClassDictionary.UltrasoundImageStorageRET,\n  sopClassDictionary.SecondaryCaptureImageStorage,\n  sopClassDictionary.MultiframeSingleBitSecondaryCaptureImageStorage,\n  sopClassDictionary.MultiframeGrayscaleByteSecondaryCaptureImageStorage,\n  sopClassDictionary.MultiframeGrayscaleWordSecondaryCaptureImageStorage,\n  sopClassDictionary.MultiframeTrueColorSecondaryCaptureImageStorage,\n  sopClassDictionary.XRayAngiographicImageStorage,\n  sopClassDictionary.EnhancedXAImageStorage,\n  sopClassDictionary.XRayRadiofluoroscopicImageStorage,\n  sopClassDictionary.EnhancedXRFImageStorage,\n  sopClassDictionary.XRay3DAngiographicImageStorage,\n  sopClassDictionary.XRay3DCraniofacialImageStorage,\n  sopClassDictionary.BreastTomosynthesisImageStorage,\n  sopClassDictionary.BreastProjectionXRayImageStorageForPresentation,\n  sopClassDictionary.BreastProjectionXRayImageStorageForProcessing,\n  sopClassDictionary.IntravascularOpticalCoherenceTomographyImageStorageForPresentation,\n  sopClassDictionary.IntravascularOpticalCoherenceTomographyImageStorageForProcessing,\n  sopClassDictionary.NuclearMedicineImageStorage,\n  sopClassDictionary.VLEndoscopicImageStorage,\n  sopClassDictionary.VideoEndoscopicImageStorage,\n  sopClassDictionary.VLMicroscopicImageStorage,\n  sopClassDictionary.VideoMicroscopicImageStorage,\n  sopClassDictionary.VLSlideCoordinatesMicroscopicImageStorage,\n  sopClassDictionary.VLPhotographicImageStorage,\n  sopClassDictionary.VideoPhotographicImageStorage,\n  sopClassDictionary.OphthalmicPhotography8BitImageStorage,\n  sopClassDictionary.OphthalmicPhotography16BitImageStorage,\n  sopClassDictionary.OphthalmicTomographyImageStorage,\n  sopClassDictionary.VLWholeSlideMicroscopyImageStorage,\n  sopClassDictionary.PositronEmissionTomographyImageStorage,\n  sopClassDictionary.EnhancedPETImageStorage,\n  sopClassDictionary.LegacyConvertedEnhancedPETImageStorage,\n  sopClassDictionary.RTImageStorage,\n  sopClassDictionary.EnhancedUSVolumeStorage,\n];\n\nfunction getSopClassHandlerModule() {\n  return [\n    {\n      name: sopClassHandlerName,\n      sopClassUids,\n      getDisplaySetsFromSeries,\n    },\n  ];\n}\n\nexport default getSopClassHandlerModule;\n","import React from 'react';\n\nexport default function ToolbarDivider() {\n  return (\n    <span className=\"self-center w-4 h-8 mx-2 border-l border-common-dark\" />\n  );\n}\n","import React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { LayoutSelector as OHIFLayoutSelector, ToolbarButton } from '@ohif/ui';\n\nimport { ServicesManager } from '@ohif/core';\n\nfunction LayoutSelector({\n  rows,\n  columns,\n  className,\n  servicesManager,\n  ...rest\n}) {\n  const [isOpen, setIsOpen] = useState(false);\n\n  const {\n    hangingProtocolService,\n    toolbarService,\n  } = (servicesManager as ServicesManager).services;\n\n  const closeOnOutsideClick = () => {\n    if (isOpen) {\n      setIsOpen(false);\n    }\n  };\n\n  useEffect(() => {\n    const { unsubscribe } = hangingProtocolService.subscribe(\n      hangingProtocolService.EVENTS.PROTOCOL_CHANGED,\n      evt => {\n        const { protocol } = evt;\n      }\n    );\n\n    return () => {\n      unsubscribe();\n    };\n  }, [hangingProtocolService]);\n\n  useEffect(() => {\n    window.addEventListener('click', closeOnOutsideClick);\n    return () => {\n      window.removeEventListener('click', closeOnOutsideClick);\n    };\n  }, [isOpen]);\n\n  const onInteractionHandler = () => setIsOpen(!isOpen);\n  const DropdownContent = isOpen ? OHIFLayoutSelector : null;\n\n  const onSelectionHandler = props => {\n    toolbarService.recordInteraction({\n      interactionType: 'action',\n      commands: [\n        {\n          commandName: 'setViewportGridLayout',\n          commandOptions: { ...props },\n          context: 'DEFAULT',\n        },\n      ],\n    });\n  };\n\n  return (\n    <ToolbarButton\n      id=\"Layout\"\n      label=\"Grid Layout\"\n      icon=\"tool-layout\"\n      onInteraction={onInteractionHandler}\n      className={className}\n      rounded={rest.rounded}\n      dropdownContent={\n        DropdownContent !== null && (\n          <DropdownContent\n            rows={rows}\n            columns={columns}\n            onSelection={onSelectionHandler}\n          />\n        )\n      }\n      isActive={isOpen}\n      type=\"toggle\"\n    />\n  );\n}\n\nLayoutSelector.propTypes = {\n  rows: PropTypes.number,\n  columns: PropTypes.number,\n  onLayoutChange: PropTypes.func,\n  servicesManager: PropTypes.instanceOf(ServicesManager),\n};\n\nLayoutSelector.defaultProps = {\n  rows: 3,\n  columns: 3,\n  onLayoutChange: () => {},\n};\n\nexport default LayoutSelector;\n","import { SplitButton } from '@ohif/ui';\n\nexport default SplitButton;\n","import { Types } from '@ohif/ui';\nimport { Menu, SelectorProps, MenuItem, ContextMenuProps } from './types';\n\ntype ContextMenuItem = Types.ContextMenuItem;\n\n/**\n * Finds menu by menu id\n *\n * @returns Menu having the menuId\n */\nexport function findMenuById(menus: Menu[], menuId?: string): Menu {\n  if (!menuId) {\n    return;\n  }\n\n  return menus.find(menu => menu.id === menuId);\n}\n\n/**\n * Default finding menu method.  This method will go through\n * the list of menus until it finds the first one which\n * has no selector, OR has the selector, when applied to the\n * check props, return true.\n * The selectorProps are a set of provided properties which can be\n * passed into the selector function to determine when to display a menu.\n * For example, a selector function of:\n * `({displayset}) => displaySet?.SeriesDescription?.indexOf?.('Left')!==-1\n * would match series descriptions containing 'Left'.\n *\n * @param {Object[]} menus List of menus\n * @param {*} subProps\n * @returns\n */\nexport function findMenuDefault(\n  menus: Menu[],\n  subProps: Record<string, unknown>\n): Menu {\n  if (!menus) {\n    return null;\n  }\n  return menus.find(\n    menu => !menu.selector || menu.selector(subProps.selectorProps)\n  );\n}\n\n/**\n * Finds the menu to be used for different scenarios:\n * This will first look for a subMenu with the specified subMenuId\n * Next it will look for the first menu whose selector returns true.\n *\n * @param menus - List of menus\n * @param props - root props\n * @param menuIdFilter - menu id identifier (to be considered on selection)\n *      This is intended to support other types of filtering in the future.\n */\nexport function findMenu(\n  menus: Menu[],\n  props?: Types.IProps,\n  menuIdFilter?: string\n) {\n  const { subMenu } = props;\n\n  function* findMenuIterator() {\n    yield findMenuById(menus, menuIdFilter || subMenu);\n    yield findMenuDefault(menus, props);\n  }\n\n  const findIt = findMenuIterator();\n\n  let current = findIt.next();\n  let menu = current.value;\n\n  while (!current.done) {\n    menu = current.value;\n\n    if (menu) {\n      findIt.return();\n    }\n    current = findIt.next();\n  }\n\n  console.log('Menu chosen', menu?.id || 'NONE');\n\n  return menu;\n}\n\n/**\n * Returns the menu from a list of possible menus, based on the actual state of component props and tool data nearby.\n * This uses the findMenu command above to first find the appropriate\n * menu, and then it chooses the actual contents of that menu.\n * A menu item can be optional by implementing the 'selector',\n * which will be called with the selectorProps, and if it does not return true,\n * then the item is excluded.\n *\n * Other menus can be delegated to by setting the delegating value to\n * a string id for another menu.  That menu's content will replace the\n * current menu item (only if the item would be included).\n *\n * This allows single id menus to be chosen by id, but have varying contents\n * based on the delegated menus.\n *\n * Finally, for each item, the adaptItem call is made.  This allows\n * items to modify themselves before being displayed, such as\n * incorporating additional information from translation sources.\n * See the `test-mode` examples for details.\n *\n * @param selectorProps\n * @param {*} event event that originates the context menu\n * @param {*} menus List of menus\n * @param {*} menuIdFilter\n * @returns\n */\nexport function getMenuItems(\n  selectorProps: SelectorProps,\n  event: Event,\n  menus: Menu[],\n  menuIdFilter?: string\n): MenuItem[] | void {\n  // Include both the check props and the ...check props as one is used\n  // by the child menu and the other used by the selector function\n  const subProps = { selectorProps, event };\n\n  const menu = findMenu(menus, subProps, menuIdFilter);\n\n  if (!menu) {\n    return undefined;\n  }\n\n  if (!menu.items) {\n    console.warn('Must define items in menu', menu);\n    return [];\n  }\n\n  let menuItems = [];\n  menu.items.forEach(item => {\n    const { delegating, selector, subMenu } = item;\n\n    if (!selector || selector(selectorProps)) {\n      if (delegating) {\n        menuItems = [\n          ...menuItems,\n          ...getMenuItems(selectorProps, event, menus, subMenu),\n        ];\n      } else {\n        const toAdd = adaptItem(item, subProps);\n        menuItems.push(toAdd);\n      }\n    }\n  });\n\n  return menuItems;\n}\n\n/**\n * Returns item adapted to be consumed by ContextMenu component\n * and then goes through the item to add action behaviour for clicking the item,\n * making it compatible with the default ContextMenu display.\n *\n * @param {Object} item\n * @param {Object} subProps\n * @returns a MenuItem that is compatible with the base ContextMenu\n *    This requires having a label and set of actions to be called.\n */\nexport function adaptItem(\n  item: MenuItem,\n  subProps: ContextMenuProps\n): ContextMenuItem {\n  const newItem: ContextMenuItem = {\n    ...item,\n    value: subProps.selectorProps?.value,\n  };\n\n  if (item.actionType === 'ShowSubMenu' && !newItem.iconRight) {\n    newItem.iconRight = 'chevron-menu';\n  }\n  if (!item.action) {\n    newItem.action = (itemRef, componentProps) => {\n      const { event = {} } = componentProps;\n      const { detail = {} } = event;\n      newItem.element = detail.element;\n\n      componentProps.onClose();\n      const action = componentProps[`on${itemRef.actionType || 'Default'}`];\n      if (action) {\n        action.call(componentProps, newItem, itemRef, subProps);\n      } else {\n        console.warn('No action defined for', itemRef);\n      }\n    };\n  }\n\n  return newItem;\n}\n","import * as ContextMenuItemsBuilder from './ContextMenuItemsBuilder';\nimport ContextMenu from '../../../../platform/ui/src/components/ContextMenu/ContextMenu';\nimport { CommandsManager, ServicesManager, Types } from '@ohif/core';\nimport { Menu, MenuItem, Point, ContextMenuProps } from './types';\n\n/**\n * The context menu controller is a helper class that knows how\n * to manage context menus based on the UI Customization Service.\n * There are a few parts to this:\n *    1. Basic controls to manage displaying and hiding context menus\n *    2. Menu selection services, which use the UI customization service\n *       to choose which menu to display\n *    3. Menu item adapter services to convert menu items into displayable and actionable items.\n *\n * The format for a menu is defined in the exported type MenuItem\n */\nexport default class ContextMenuController {\n  commandsManager: CommandsManager;\n  services: Types.Services;\n  menuItems: Menu[] | MenuItem[];\n\n  constructor(\n    servicesManager: ServicesManager,\n    commandsManager: CommandsManager\n  ) {\n    this.services = servicesManager.services as Obj;\n    this.commandsManager = commandsManager;\n  }\n\n  closeContextMenu() {\n    this.services.uiDialogService.dismiss({ id: 'context-menu' });\n  }\n\n  /**\n   * Figures out which context menu is appropriate to display and shows it.\n   *\n   * @param contextMenuProps - the context menu properties, see ./types.ts\n   * @param viewportElement - the DOM element this context menu is related to\n   * @param defaultPointsPosition - a default position to show the context menu\n   */\n  showContextMenu(\n    contextMenuProps: ContextMenuProps,\n    viewportElement,\n    defaultPointsPosition\n  ): void {\n    if (!this.services.uiDialogService) {\n      console.warn('Unable to show dialog; no UI Dialog Service available.');\n      return;\n    }\n\n    const { event, subMenu, menuId, menus, selectorProps } = contextMenuProps;\n\n    console.log('Getting items from', menus);\n    const items = ContextMenuItemsBuilder.getMenuItems(\n      selectorProps || contextMenuProps,\n      event,\n      menus,\n      menuId\n    );\n\n    this.services.uiDialogService.dismiss({ id: 'context-menu' });\n    this.services.uiDialogService.create({\n      id: 'context-menu',\n      isDraggable: false,\n      preservePosition: false,\n      preventCutOf: true,\n      defaultPosition: ContextMenuController._getDefaultPosition(\n        defaultPointsPosition,\n        event?.detail,\n        viewportElement\n      ),\n      event,\n      content: ContextMenu,\n\n      // This naming is part of hte uiDialogService convention\n      // Clicking outside simpy closes the dialog box.\n      onClickOutside: () =>\n        this.services.uiDialogService.dismiss({ id: 'context-menu' }),\n\n      contentProps: {\n        items,\n        selectorProps,\n        menus,\n        event,\n        subMenu,\n        eventData: event?.detail,\n\n        onClose: () => {\n          this.services.uiDialogService.dismiss({ id: 'context-menu' });\n        },\n\n        /**\n         * Displays a sub-menu, removing this menu\n         * @param {*} item\n         * @param {*} itemRef\n         * @param {*} subProps\n         */\n        onShowSubMenu: (item, itemRef, subProps) => {\n          if (!itemRef.subMenu) {\n            console.warn('No submenu defined for', item, itemRef, subProps);\n            return;\n          }\n          this.showContextMenu(\n            {\n              ...contextMenuProps,\n              menuId: itemRef.subMenu,\n            },\n            viewportElement,\n            defaultPointsPosition\n          );\n        },\n\n        // Default is to run the specified commands.\n        onDefault: (item, itemRef, subProps) => {\n          this.commandsManager.run(item, {\n            ...selectorProps,\n            ...itemRef,\n            subProps,\n          });\n        },\n      },\n    });\n  }\n\n  static getDefaultPosition = (): Point => {\n    return {\n      x: 0,\n      y: 0,\n    };\n  };\n\n  static _getEventDefaultPosition = eventDetail => ({\n    x: eventDetail && eventDetail.currentPoints.client[0],\n    y: eventDetail && eventDetail.currentPoints.client[1],\n  });\n\n  static _getElementDefaultPosition = element => {\n    if (element) {\n      const boundingClientRect = element.getBoundingClientRect();\n      return {\n        x: boundingClientRect.x,\n        y: boundingClientRect.y,\n      };\n    }\n\n    return {\n      x: undefined,\n      y: undefined,\n    };\n  };\n\n  static _getCanvasPointsPosition = (points = [], element) => {\n    const viewerPos = ContextMenuController._getElementDefaultPosition(element);\n\n    for (let pointIndex = 0; pointIndex < points.length; pointIndex++) {\n      const point = {\n        x: points[pointIndex][0] || points[pointIndex]['x'],\n        y: points[pointIndex][1] || points[pointIndex]['y'],\n      };\n      if (\n        ContextMenuController._isValidPosition(point) &&\n        ContextMenuController._isValidPosition(viewerPos)\n      ) {\n        return {\n          x: point.x + viewerPos.x,\n          y: point.y + viewerPos.y,\n        };\n      }\n    }\n  };\n\n  static _isValidPosition = (source): boolean => {\n    return (\n      source && typeof source.x === 'number' && typeof source.y === 'number'\n    );\n  };\n\n  /**\n   * Returns the context menu default position. It look for the positions of: canvasPoints (got from selected), event that triggers it, current viewport element\n   */\n  static _getDefaultPosition = (canvasPoints, eventDetail, viewerElement) => {\n    function* getPositionIterator() {\n      yield ContextMenuController._getCanvasPointsPosition(\n        canvasPoints,\n        viewerElement\n      );\n      yield ContextMenuController._getEventDefaultPosition(eventDetail);\n      yield ContextMenuController._getElementDefaultPosition(viewerElement);\n      yield ContextMenuController.getDefaultPosition();\n    }\n\n    const positionIterator = getPositionIterator();\n\n    let current = positionIterator.next();\n    let position = current.value;\n\n    while (!current.done) {\n      position = current.value;\n\n      if (ContextMenuController._isValidPosition(position)) {\n        positionIterator.return();\n      }\n      current = positionIterator.next();\n    }\n\n    return position;\n  };\n}\n","const defaultContextMenu = {\n  id: 'measurementsContextMenu',\n  customizationType: 'ohif.contextMenu',\n  menus: [\n    // Get the items from the UI Customization for the menu name (and have a custom name)\n    {\n      id: 'forExistingMeasurement',\n      selector: ({ nearbyToolData }) => !!nearbyToolData,\n      items: [\n        {\n          label: 'Delete measurement',\n          commands: [\n            {\n              commandName: 'deleteMeasurement',\n            },\n          ],\n        },\n        {\n          label: 'Add Label',\n          commands: [\n            {\n              commandName: 'setMeasurementLabel',\n            },\n          ],\n        },\n      ],\n    },\n  ],\n};\n\nexport default defaultContextMenu;\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { VariableSizeList as List } from 'react-window';\nimport classNames from 'classnames';\nimport debounce from 'lodash.debounce';\n\nconst lineHeightPx = 20;\nconst lineHeightClassName = `leading-[${lineHeightPx}px]`;\nconst rowVerticalPaddingPx = 10;\nconst rowBottomBorderPx = 1;\nconst rowVerticalPaddingStyle = { padding: `${rowVerticalPaddingPx}px 0` };\nconst rowStyle = {\n  borderBottomWidth: `${rowBottomBorderPx}px`,\n  ...rowVerticalPaddingStyle,\n};\n\nfunction ColumnHeaders({ tagRef, vrRef, keywordRef, valueRef }) {\n  return (\n    <div\n      className={classNames(\n        'flex flex-row w-full bg-secondary-dark ohif-scrollbar overflow-y-scroll'\n      )}\n      style={rowVerticalPaddingStyle}\n    >\n      <div className=\"px-3 w-4/24\">\n        <label\n          ref={tagRef}\n          className=\"flex flex-col flex-1 text-white text-lg pl-1 select-none\"\n        >\n          <span className=\"flex flex-row items-center focus:outline-none\">\n            Tag\n          </span>\n        </label>\n      </div>\n      <div className=\"px-3 w-2/24\">\n        <label\n          ref={vrRef}\n          className=\"flex flex-col flex-1 text-white text-lg pl-1 select-none\"\n        >\n          <span className=\"flex flex-row items-center focus:outline-none\">\n            VR\n          </span>\n        </label>\n      </div>\n      <div className=\"px-3 w-6/24\">\n        <label\n          ref={keywordRef}\n          className=\"flex flex-col flex-1 text-white text-lg pl-1 select-none\"\n        >\n          <span className=\"flex flex-row items-center focus:outline-none\">\n            Keyword\n          </span>\n        </label>\n      </div>\n      <div className=\"px-3 w-5/24 grow\">\n        <label\n          ref={valueRef}\n          className=\"flex flex-col flex-1 text-white text-lg pl-1 select-none\"\n        >\n          <span className=\"flex flex-row items-center focus:outline-none\">\n            Value\n          </span>\n        </label>\n      </div>\n    </div>\n  );\n}\n\nfunction DicomTagTable({ rows }) {\n  const listRef = useRef();\n  const canvasRef = useRef();\n\n  const [tagHeaderElem, setTagHeaderElem] = useState(null);\n  const [vrHeaderElem, setVrHeaderElem] = useState(null);\n  const [keywordHeaderElem, setKeywordHeaderElem] = useState(null);\n  const [valueHeaderElem, setValueHeaderElem] = useState(null);\n\n  // Here the refs are inturn stored in state to trigger a render of the table.\n  // This virtualized table does NOT render until the header is rendered because the header column widths are used to determine the row heights in the table.\n  // Therefore whenever the refs change (in particular the first time the refs are set), we want to trigger a render of the table.\n  const tagRef = elem => {\n    if (elem) {\n      setTagHeaderElem(elem);\n    }\n  };\n  const vrRef = elem => {\n    if (elem) {\n      setVrHeaderElem(elem);\n    }\n  };\n  const keywordRef = elem => {\n    if (elem) {\n      setKeywordHeaderElem(elem);\n    }\n  };\n  const valueRef = elem => {\n    if (elem) {\n      setValueHeaderElem(elem);\n    }\n  };\n\n  /**\n   * When new rows are set, scroll to the top and reset the virtualization.\n   */\n  useEffect(() => {\n    if (!listRef?.current) {\n      return;\n    }\n\n    listRef.current.scrollTo(0);\n    listRef.current.resetAfterIndex(0);\n  }, [rows]);\n\n  /**\n   * When the browser window resizes, update the row virtualization (i.e. row heights)\n   */\n  useEffect(() => {\n    const debouncedResize = debounce(\n      () => listRef.current.resetAfterIndex(0),\n      100\n    );\n\n    window.addEventListener('resize', debouncedResize);\n\n    return () => {\n      debouncedResize.cancel();\n      window.removeEventListener('resize', debouncedResize);\n    };\n  }, []);\n\n  const Row = useCallback(\n    ({ index, style }) => {\n      const row = rows[index];\n\n      return (\n        <div\n          style={{ ...style, ...rowStyle }}\n          className={classNames(\n            'hover:bg-secondary-main transition duration-300 bg-black flex flex-row w-full border-secondary-light items-center text-base break-all',\n            lineHeightClassName\n          )}\n          key={`DICOMTagRow-${index}`}\n        >\n          <div className=\"px-3 w-4/24\">{row[0]}</div>\n          <div className=\"px-3 w-2/24\">{row[1]}</div>\n          <div className=\"px-3 w-6/24\">{row[2]}</div>\n          <div className=\"px-3 w-5/24 grow\">{row[3]}</div>\n        </div>\n      );\n    },\n    [rows]\n  );\n\n  /**\n   * Whenever any one of the column headers is set, then the header is rendered.\n   * Here we chose the tag header.\n   */\n  const isHeaderRendered = useCallback(() => tagHeaderElem !== null, [\n    tagHeaderElem,\n  ]);\n\n  /**\n   * Get the item/row size. We use the header column widths to calculate the various row heights.\n   * @param index the row index\n   * @returns the row height\n   */\n  const getItemSize = useCallback(\n    index => {\n      const headerWidths = [\n        tagHeaderElem.offsetWidth,\n        vrHeaderElem.offsetWidth,\n        keywordHeaderElem.offsetWidth,\n        valueHeaderElem.offsetWidth,\n      ];\n\n      const context = canvasRef.current.getContext('2d');\n      context.font = getComputedStyle(canvasRef.current).font;\n\n      return rows[index]\n        .map((colText, index) => {\n          const colOneLineWidth = context.measureText(colText).width;\n          const numLines = Math.ceil(colOneLineWidth / headerWidths[index]);\n          return (\n            numLines * lineHeightPx +\n            2 * rowVerticalPaddingPx +\n            rowBottomBorderPx\n          );\n        })\n        .reduce((maxHeight, colHeight) => Math.max(maxHeight, colHeight));\n    },\n    [rows, keywordHeaderElem, tagHeaderElem, valueHeaderElem, vrHeaderElem]\n  );\n\n  return (\n    <div>\n      <canvas\n        style={{ visibility: 'hidden', position: 'absolute' }}\n        className=\"text-base\"\n        ref={canvasRef}\n      />\n      <ColumnHeaders\n        tagRef={tagRef}\n        vrRef={vrRef}\n        keywordRef={keywordRef}\n        valueRef={valueRef}\n      />\n      <div\n        className=\"m-auto relative border-2 border-black bg-black\"\n        style={{ height: '32rem' }}\n      >\n        {isHeaderRendered() && (\n          <List\n            ref={listRef}\n            height={500}\n            itemCount={rows.length}\n            itemSize={getItemSize}\n            width={'100%'}\n            className=\"ohif-scrollbar\"\n          >\n            {Row}\n          </List>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default DicomTagTable;\n","import dcmjs from 'dcmjs';\nimport moment from 'moment';\nimport React, { useState, useMemo, useEffect, useRef } from 'react';\nimport { classes } from '@ohif/core';\nimport { Icon, InputRange, Select, Typography } from '@ohif/ui';\nimport debounce from 'lodash.debounce';\nimport classNames from 'classnames';\n\nimport DicomTagTable from './DicomTagTable';\nimport './DicomTagBrowser.css';\n\nconst { ImageSet } = classes;\nconst { DicomMetaDictionary } = dcmjs.data;\nconst { nameMap } = DicomMetaDictionary;\n\nconst DicomTagBrowser = ({ displaySets, displaySetInstanceUID }) => {\n  // The column indices that are to be excluded during a filter of the table.\n  // At present the column indices are:\n  // 0: DICOM tag\n  // 1: VR\n  // 2: Keyword\n  // 3: Value\n  const excludedColumnIndicesForFilter: Set<number> = new Set([1]);\n\n  const [\n    selectedDisplaySetInstanceUID,\n    setSelectedDisplaySetInstanceUID,\n  ] = useState(displaySetInstanceUID);\n  const [instanceNumber, setInstanceNumber] = useState(1);\n  const [filterValue, setFilterValue] = useState('');\n\n  const onSelectChange = value => {\n    setSelectedDisplaySetInstanceUID(value.value);\n    setInstanceNumber(1);\n  };\n\n  const searchInputRef = useRef(null);\n\n  const activeDisplaySet = displaySets.find(\n    ds => ds.displaySetInstanceUID === selectedDisplaySetInstanceUID\n  );\n\n  const isImageStack = _isImageStack(activeDisplaySet);\n  const showInstanceList = isImageStack && activeDisplaySet.images.length > 1;\n\n  const displaySetList = useMemo(() => {\n    displaySets.sort((a, b) => a.SeriesNumber - b.SeriesNumber);\n    return displaySets.map(displaySet => {\n      const {\n        displaySetInstanceUID,\n        SeriesDate,\n        SeriesTime,\n        SeriesNumber,\n        SeriesDescription,\n        Modality,\n      } = displaySet;\n\n      /* Map to display representation */\n      const dateStr = `${SeriesDate}:${SeriesTime}`.split('.')[0];\n      const date = moment(dateStr, 'YYYYMMDD:HHmmss');\n      const displayDate = date.format('ddd, MMM Do YYYY');\n\n      return {\n        value: displaySetInstanceUID,\n        label: `${SeriesNumber} (${Modality}): ${SeriesDescription}`,\n        description: displayDate,\n      };\n    });\n  }, [displaySets]);\n\n  const rows = useMemo(() => {\n    let metadata;\n    if (isImageStack) {\n      metadata = activeDisplaySet.images[instanceNumber - 1];\n    } else {\n      metadata = activeDisplaySet.instance || activeDisplaySet;\n    }\n    const tags = getSortedTags(metadata);\n    return getFormattedRowsFromTags(tags, metadata);\n  }, [instanceNumber, selectedDisplaySetInstanceUID]);\n\n  const filteredRows = useMemo(() => {\n    if (!filterValue) {\n      return rows;\n    }\n\n    const filterValueLowerCase = filterValue.toLowerCase();\n    return rows.filter(row => {\n      return row.reduce((keepRow, col, colIndex) => {\n        if (keepRow) {\n          // We are already keeping the row, why do more work so return now.\n          return keepRow;\n        }\n\n        if (excludedColumnIndicesForFilter.has(colIndex)) {\n          return keepRow;\n        }\n\n        return keepRow || col.toLowerCase().includes(filterValueLowerCase);\n      }, false);\n    });\n  }, [rows, filterValue]);\n\n  const debouncedSetFilterValue = useMemo(() => {\n    return debounce(setFilterValue, 200);\n  }, []);\n\n  useEffect(() => {\n    return () => {\n      debouncedSetFilterValue?.cancel();\n    };\n  }, []);\n\n  return (\n    <div className=\"dicom-tag-browser-content\">\n      <div className=\"flex flex-row mb-6 items-center pl-1\">\n        <div className=\"flex flex-row items-center w-1/2\">\n          <Typography variant=\"subtitle\" className=\"mr-4\">\n            Series\n          </Typography>\n          <div className=\"grow mr-8\">\n            <Select\n              id=\"display-set-selector\"\n              isClearable={false}\n              onChange={onSelectChange}\n              options={displaySetList}\n              value={displaySetList.find(\n                ds => ds.value === selectedDisplaySetInstanceUID\n              )}\n              className=\"text-white\"\n            />\n          </div>\n        </div>\n        <div className=\"flex flex-row items-center w-1/2\">\n          {showInstanceList && (\n            <Typography variant=\"subtitle\" className=\"mr-4\">\n              Instance Number\n            </Typography>\n          )}\n          {showInstanceList && (\n            <div className=\"grow\">\n              <InputRange\n                value={instanceNumber}\n                key={selectedDisplaySetInstanceUID}\n                onChange={value => {\n                  setInstanceNumber(parseInt(value));\n                }}\n                minValue={1}\n                maxValue={activeDisplaySet.images.length}\n                step={1}\n                inputClassName=\"w-full\"\n                labelPosition=\"left\"\n                trackColor={'#3a3f99'}\n              />\n            </div>\n          )}\n        </div>\n      </div>\n      <div className=\"w-full h-1 bg-black\"></div>\n      <div className=\"flex flex-row my-3 w-1/2\">\n        {/* TODO - refactor the following into its own reusable component */}\n        <label className=\"relative block w-full mr-8\">\n          <span className=\"absolute inset-y-0 left-0 flex items-center pl-2\">\n            <Icon name=\"icon-search\"></Icon>\n          </span>\n          <input\n            ref={searchInputRef}\n            type=\"text\"\n            className=\"block bg-black w-full shadow transition duration-300 appearance-none border border-inputfield-main focus:border-inputfield-focus focus:outline-none disabled:border-inputfield-disabled rounded w-full py-2 px-9 text-base leading-tight placeholder:text-inputfield-placeholder\"\n            placeholder=\"Search metadata...\"\n            onChange={event => debouncedSetFilterValue(event.target.value)}\n            autoComplete=\"off\"\n          ></input>\n          <span className=\"absolute inset-y-0 right-0 flex items-center pr-2\">\n            <Icon\n              name=\"icon-clear-field\"\n              className={classNames(\n                'cursor-pointer',\n                filterValue ? '' : 'hidden'\n              )}\n              onClick={() => {\n                searchInputRef.current.value = '';\n                debouncedSetFilterValue('');\n              }}\n            ></Icon>\n          </span>\n        </label>\n      </div>\n      <DicomTagTable rows={filteredRows} />\n    </div>\n  );\n};\n\nfunction getFormattedRowsFromTags(tags, metadata) {\n  const rows = [];\n\n  tags.forEach(tagInfo => {\n    if (tagInfo.vr === 'SQ') {\n      rows.push([\n        `${tagInfo.tagIndent}${tagInfo.tag}`,\n        tagInfo.vr,\n        tagInfo.keyword,\n        '',\n      ]);\n\n      const { values } = tagInfo;\n\n      values.forEach((item, index) => {\n        const formatedRowsFromTags = getFormattedRowsFromTags(item, metadata);\n\n        rows.push([\n          `${item[0].tagIndent}(FFFE,E000)`,\n          '',\n          `Item #${index}`,\n          '',\n        ]);\n\n        rows.push(...formatedRowsFromTags);\n      });\n    } else {\n      if (tagInfo.vr === 'xs') {\n        try {\n          const tag = dcmjs.data.Tag.fromPString(tagInfo.tag).toCleanString();\n          const originalTagInfo = metadata[tag];\n          tagInfo.vr = originalTagInfo.vr;\n        } catch (error) {\n          console.error(\n            `Failed to parse value representation for tag '${tagInfo.keyword}'`\n          );\n        }\n      }\n      rows.push([\n        `${tagInfo.tagIndent}${tagInfo.tag}`,\n        tagInfo.vr,\n        tagInfo.keyword,\n        tagInfo.value,\n      ]);\n    }\n  });\n\n  return rows;\n}\n\nfunction getSortedTags(metadata) {\n  const tagList = getRows(metadata);\n\n  // Sort top level tags, sequence groups are sorted when created.\n  _sortTagList(tagList);\n\n  return tagList;\n}\n\nfunction getRows(metadata, depth = 0) {\n  // Tag, Type, Value, Keyword\n\n  const keywords = Object.keys(metadata);\n\n  let tagIndent = '';\n\n  for (let i = 0; i < depth; i++) {\n    tagIndent += '>';\n  }\n\n  if (depth > 0) {\n    tagIndent += ' '; // If indented, add a space after the indents.\n  }\n\n  const rows = [];\n  for (let i = 0; i < keywords.length; i++) {\n    let keyword = keywords[i];\n\n    if (keyword === '_vrMap') {\n      continue;\n    }\n\n    const tagInfo = nameMap[keyword];\n\n    let value = metadata[keyword];\n\n    if (tagInfo && tagInfo.vr === 'SQ') {\n      const sequenceAsArray = toArray(value);\n\n      // Push line defining the sequence\n\n      const sequence = {\n        tag: tagInfo.tag,\n        tagIndent,\n        vr: tagInfo.vr,\n        keyword,\n        values: [],\n      };\n\n      rows.push(sequence);\n\n      if (value === null) {\n        // Type 2 Sequence\n        continue;\n      }\n\n      sequenceAsArray.forEach(item => {\n        const sequenceRows = getRows(item, depth + 1);\n\n        if (sequenceRows.length) {\n          // Sort the sequence group.\n          _sortTagList(sequenceRows);\n          sequence.values.push(sequenceRows);\n        }\n      });\n\n      continue;\n    }\n\n    if (Array.isArray(value)) {\n      if (value.length > 0 && typeof value[0] != 'object') {\n        value = value.join('\\\\');\n      }\n    }\n\n    if (typeof value === 'number') {\n      value = value.toString();\n    }\n\n    if (typeof value !== 'string') {\n      if (value === null) {\n        value = ' ';\n      } else {\n        if (typeof value === 'object') {\n          if (value.InlineBinary) {\n            value = 'Inline Binary';\n          } else if (value.BulkDataURI) {\n            value = `Bulk Data URI`; //: ${value.BulkDataURI}`;\n          } else if (value.Alphabetic) {\n            value = value.Alphabetic;\n          } else {\n            console.warn(`Unrecognised Value: ${value} for ${keyword}:`);\n            console.warn(value);\n            value = ' ';\n          }\n        } else {\n          console.warn(`Unrecognised Value: ${value} for ${keyword}:`);\n          value = ' ';\n        }\n      }\n    }\n\n    // tag / vr/ keyword/ value\n\n    // Remove retired tags\n    keyword = keyword.replace('RETIRED_', '');\n    if (tagInfo) {\n      rows.push({\n        tag: tagInfo.tag,\n        tagIndent,\n        vr: tagInfo.vr,\n        keyword,\n        value,\n      });\n    } else {\n      // skip properties without hex tag numbers\n      const regex = /[0-9A-Fa-f]{6}/g;\n      if (keyword.match(regex)) {\n        const tag = `(${keyword.substring(0, 4)},${keyword.substring(4, 8)})`;\n        rows.push({\n          tag,\n          tagIndent,\n          vr: '',\n          keyword: 'Private Tag',\n          value,\n        });\n      }\n    }\n  }\n\n  return rows;\n}\n\nfunction _isImageStack(displaySet) {\n  return displaySet instanceof ImageSet;\n}\n\nfunction toArray(objectOrArray) {\n  return Array.isArray(objectOrArray) ? objectOrArray : [objectOrArray];\n}\n\nfunction _sortTagList(tagList) {\n  tagList.sort((a, b) => {\n    if (a.tag < b.tag) {\n      return -1;\n    }\n\n    return 1;\n  });\n}\n\nexport default DicomTagBrowser;\n","import { HangingProtocolService, StateSyncService, Types } from '@ohif/core';\n\nexport type ReturnType = {\n  hangingProtocolStageIndexMap: Record<string, Types.HangingProtocol.HPInfo>;\n  viewportGridStore: Record<string, unknown>;\n  displaySetSelectorMap: Record<string, string>;\n};\n\n/**\n * Calculates a set of state information for hanging protocols and viewport grid\n * which defines the currently applied hanging protocol state.\n * @param state is the viewport grid state\n * @param syncService is the state sync service to use for getting existing state\n * @returns Set of states that can be applied to the state sync to remember\n *   the current view state.\n */\nconst reuseCachedLayout = (\n  state,\n  hangingProtocolService: HangingProtocolService,\n  syncService: StateSyncService\n): ReturnType => {\n  const { activeViewportIndex, viewports, layout } = state;\n  const hpInfo = hangingProtocolService.getState();\n  const { protocolId, stageIndex, activeStudyUID } = hpInfo;\n  const { protocol } = hangingProtocolService.getActiveProtocol();\n  const stage = protocol.stages[stageIndex];\n  const storeId = `${activeStudyUID}:${protocolId}:${stageIndex}`;\n  const syncState = syncService.getState();\n  const cacheId = `${activeStudyUID}:${protocolId}`;\n  const viewportGridStore = { ...syncState.viewportGridStore };\n  const hangingProtocolStageIndexMap = {\n    ...syncState.hangingProtocolStageIndexMap,\n  };\n  const displaySetSelectorMap = { ...syncState.displaySetSelectorMap };\n  const { rows, columns } = stage.viewportStructure.properties;\n  const custom =\n    stage.viewports.length !== state.viewports.length ||\n    state.layout.numRows !== rows ||\n    state.layout.numCols !== columns;\n\n  hangingProtocolStageIndexMap[cacheId] = hpInfo;\n\n  if (storeId && custom) {\n    viewportGridStore[storeId] = { ...state };\n  }\n\n  for (let idx = 0; idx < state.viewports.length; idx++) {\n    const viewport = state.viewports[idx];\n    const { displaySetOptions, displaySetInstanceUIDs } = viewport;\n    if (!displaySetOptions) continue;\n    for (let i = 0; i < displaySetOptions.length; i++) {\n      const displaySetUID = displaySetInstanceUIDs[i];\n      if (!displaySetUID) continue;\n      if (idx === activeViewportIndex && i === 0) {\n        displaySetSelectorMap[\n          `${activeStudyUID}:activeDisplaySet:0`\n        ] = displaySetUID;\n      }\n      if (displaySetOptions[i]?.id) {\n        displaySetSelectorMap[\n          `${activeStudyUID}:${displaySetOptions[i].id}:${displaySetOptions[i]\n            .matchedDisplaySetsIndex || 0}`\n        ] = displaySetUID;\n      }\n    }\n  }\n\n  return {\n    hangingProtocolStageIndexMap,\n    viewportGridStore,\n    displaySetSelectorMap,\n  };\n};\n\nexport default reuseCachedLayout;\n","import { StateSyncService, Types } from '@ohif/core';\n\n/**\n * This find or create viewport is paired with the reduce results from\n * below, and the action of this viewport is to look for previously filled\n * viewports, and to re-use by position id.  If there is no filled viewport,\n * then one can be re-used from the display set if it isn't going to be displayed.\n * @param hangingProtocolService - bound parameter supplied before using this\n * @param viewportsByPosition - bound parameter supplied before using this\n * @param viewportIndex - the index to retrieve\n * @param positionId - the current position on screen to retrieve\n * @param options - the set of options used, so that subsequent calls can\n *                  store state that is reset by the setLayout.\n *                  This class uses the options to store the already viewed\n *                  display sets, filling it initially with the pre-existing viewports.\n */\nexport const findOrCreateViewport = (\n  hangingProtocolService,\n  viewportsByPosition,\n  viewportIndex: number,\n  positionId: string,\n  options: Record<string, unknown>\n) => {\n  const byPositionViewport = viewportsByPosition?.[positionId];\n  if (byPositionViewport) return { ...byPositionViewport };\n  const { protocolId, stageIndex } = hangingProtocolService.getState();\n\n  // Setup the initial in display correctly for initial view/select\n  if (!options.inDisplay) {\n    options.inDisplay = [...viewportsByPosition.initialInDisplay];\n  }\n  // See if there is a default viewport for new views.\n  const missing = hangingProtocolService.getMissingViewport(\n    protocolId,\n    stageIndex,\n    options\n  );\n  if (missing) {\n    const displaySetInstanceUIDs = missing.displaySetsInfo.map(\n      it => it.displaySetInstanceUID\n    );\n    options.inDisplay.push(...displaySetInstanceUIDs);\n    return {\n      displaySetInstanceUIDs,\n      displaySetOptions: missing.displaySetsInfo.map(\n        it => it.displaySetOptions\n      ),\n      viewportOptions: {\n        ...missing.viewportOptions,\n      },\n    };\n  }\n  return {};\n};\n\n/**\n * Records the information on what viewports are displayed in which position.\n * Also records what instances from the existing positions are going to be in\n * view initially.\n * @param state is the viewport grid state\n * @param syncService is the state sync service to use for getting existing state\n * @returns Set of states that can be applied to the state sync to remember\n *   the current view state.\n */\nconst findViewportsByPosition = (\n  state,\n  { numRows, numCols },\n  syncService: StateSyncService\n): Record<string, Record<string, unknown>> => {\n  const { viewports } = state;\n  const syncState = syncService.getState();\n  const viewportsByPosition = { ...syncState.viewportsByPosition };\n  const initialInDisplay = [];\n\n  for (const viewport of viewports) {\n    if (viewport.positionId) {\n      const storedViewport = {\n        ...viewport,\n        viewportOptions: { ...viewport.viewportOptions },\n      };\n      viewportsByPosition[viewport.positionId] = storedViewport;\n      // The cache doesn't store the viewport options - it is only useful\n      // for remembering the type of viewport and UIDs\n      delete storedViewport.viewportId;\n      delete storedViewport.viewportOptions.viewportId;\n    }\n  }\n\n  for (let row = 0; row < numRows; row++) {\n    for (let col = 0; col < numCols; col++) {\n      const pos = col + row * numCols;\n      const positionId = viewports?.[pos]?.positionId || `${col}-${row}`;\n      const viewport = viewportsByPosition[positionId];\n      if (viewport?.displaySetInstanceUIDs) {\n        initialInDisplay.push(...viewport.displaySetInstanceUIDs);\n      }\n    }\n  }\n\n  // Store the initially displayed elements\n  viewportsByPosition.initialInDisplay = initialInDisplay;\n\n  return { viewportsByPosition };\n};\n\nexport default findViewportsByPosition;\n","import { ServicesManager, utils, Types } from '@ohif/core';\n\nimport {\n  ContextMenuController,\n  defaultContextMenu,\n} from './CustomizableContextMenu';\nimport DicomTagBrowser from './DicomTagBrowser/DicomTagBrowser';\nimport reuseCachedLayouts from './utils/reuseCachedLayouts';\nimport findViewportsByPosition, {\n  findOrCreateViewport as layoutFindOrCreate,\n} from './findViewportsByPosition';\n\nimport { ContextMenuProps } from './CustomizableContextMenu/types';\nimport { NavigateHistory } from './types/commandModuleTypes';\nimport { history } from '@ohif/app';\n\nconst { subscribeToNextViewportGridChange } = utils;\n\nexport type HangingProtocolParams = {\n  protocolId?: string;\n  stageIndex?: number;\n  activeStudyUID?: string;\n  stageId?: string;\n};\n\nexport type UpdateViewportDisplaySetParams = {\n  direction: number;\n  excludeNonImageModalities?: boolean;\n};\n\n/**\n * Determine if a command is a hanging protocol one.\n * For now, just use the two hanging protocol commands that are in this\n * commands module, but if others get added elsewhere this may need enhancing.\n */\nconst isHangingProtocolCommand = command =>\n  command &&\n  (command.commandName === 'setHangingProtocol' ||\n    command.commandName === 'toggleHangingProtocol');\n\nconst commandsModule = ({\n  servicesManager,\n  commandsManager,\n}: Types.Extensions.ExtensionParams): Types.Extensions.CommandsModule => {\n  const {\n    customizationService,\n    measurementService,\n    hangingProtocolService,\n    uiNotificationService,\n    viewportGridService,\n    displaySetService,\n    stateSyncService,\n    toolbarService,\n  } = (servicesManager as ServicesManager).services;\n\n  // Define a context menu controller for use with any context menus\n  const contextMenuController = new ContextMenuController(\n    servicesManager,\n    commandsManager\n  );\n\n  const actions = {\n    /**\n     * Show the context menu.\n     * @param options.menuId defines the menu name to lookup, from customizationService\n     * @param options.defaultMenu contains the default menu set to use\n     * @param options.element is the element to show the menu within\n     * @param options.event is the event that caused the context menu\n     * @param options.selectorProps is the set of selection properties to use\n     */\n    showContextMenu: (options: ContextMenuProps) => {\n      const {\n        menuCustomizationId,\n        element,\n        event,\n        selectorProps,\n        defaultPointsPosition = [],\n      } = options;\n\n      const optionsToUse = { ...options };\n\n      if (menuCustomizationId) {\n        Object.assign(\n          optionsToUse,\n          customizationService.get(menuCustomizationId, defaultContextMenu)\n        );\n      }\n\n      // TODO - make the selectorProps richer by including the study metadata and display set.\n      const { protocol, stage } = hangingProtocolService.getActiveProtocol();\n      optionsToUse.selectorProps = {\n        event,\n        protocol,\n        stage,\n        ...selectorProps,\n      };\n\n      contextMenuController.showContextMenu(\n        optionsToUse,\n        element,\n        defaultPointsPosition\n      );\n    },\n\n    /** Close a context menu currently displayed */\n    closeContextMenu: () => {\n      contextMenuController.closeContextMenu();\n    },\n\n    displayNotification: ({ text, title, type }) => {\n      uiNotificationService.show({\n        title: title,\n        message: text,\n        type: type,\n      });\n    },\n    clearMeasurements: () => {\n      measurementService.clear();\n    },\n\n    /**\n     * Toggles off all tools which contain a commandName of setHangingProtocol\n     * or toggleHangingProtocol, and which match/don't match the protocol id/stage\n     */\n    toggleHpTools: () => {\n      const {\n        protocol,\n        stageIndex: toggleStageIndex,\n        stage,\n      } = hangingProtocolService.getActiveProtocol();\n      const enableListener = button => {\n        if (!button.id) return;\n        const { commands, items } = button.props || button;\n        if (items) {\n          items.forEach(enableListener);\n        }\n        const hpCommand = commands?.find?.(isHangingProtocolCommand);\n        if (!hpCommand) return;\n        const { protocolId, stageIndex, stageId } = hpCommand.commandOptions;\n        const isActive =\n          (!protocolId || protocolId === protocol.id) &&\n          (stageIndex === undefined || stageIndex === toggleStageIndex) &&\n          (!stageId || stageId === stage.id);\n        toolbarService.setActive(button.id, isActive);\n      };\n      Object.values(toolbarService.getButtons()).forEach(enableListener);\n    },\n\n    /**\n     *  Sets the specified protocol\n     *    1. Records any existing state using the viewport grid service\n     *    2. Finds the destination state - this can be one of:\n     *       a. The specified protocol stage\n     *       b. An alternate (toggled or restored) protocol stage\n     *       c. A restored custom layout\n     *    3. Finds the parameters for the specified state\n     *       a. Gets the displaySetSelectorMap\n     *       b. Gets the map by position\n     *       c. Gets any toggle mapping to map position to/from current view\n     *    4. If restore, then sets layout\n     *       a. Maps viewport position by currently displayed viewport map id\n     *       b. Uses toggle information to map display set id\n     *    5. Else applies the hanging protocol\n     *       a. HP Service is provided displaySetSelectorMap\n     *       b. HP Service will throw an exception if it isn't applicable\n     * @param options - contains information on the HP to apply\n     * @param options.activeStudyUID - the updated study to apply the HP to\n     * @param options.protocolId - the protocol ID to change to\n     * @param options.stageId - the stageId to apply\n     * @param options.stageIndex - the index of the stage to go to.\n     * @param options.reset - flag to indicate if the HP should be reset to its original and not restored to a previous state\n     */\n    setHangingProtocol: ({\n      activeStudyUID = '',\n      protocolId,\n      stageId,\n      stageIndex,\n      reset = false,\n    }: HangingProtocolParams): boolean => {\n      try {\n        // Stores in the state the display set selector id to displaySetUID mapping\n        // Pass in viewportId for the active viewport.  This item will get set as\n        // the activeViewportId\n        const state = viewportGridService.getState();\n        const hpInfo = hangingProtocolService.getState();\n        const {\n          protocol: oldProtocol,\n        } = hangingProtocolService.getActiveProtocol();\n        const stateSyncReduce = reuseCachedLayouts(\n          state,\n          hangingProtocolService,\n          stateSyncService\n        );\n        const {\n          hangingProtocolStageIndexMap,\n          viewportGridStore,\n          displaySetSelectorMap,\n        } = stateSyncReduce;\n\n        if (!protocolId) {\n          // Re-use the previous protocol id, and optionally stage\n          protocolId = hpInfo.protocolId;\n          if (stageId === undefined && stageIndex === undefined) {\n            stageIndex = hpInfo.stageIndex;\n          }\n        } else if (stageIndex === undefined && stageId === undefined) {\n          // Re-set the same stage as was previously used\n          const hangingId = `${activeStudyUID ||\n            hpInfo.activeStudyUID}:${protocolId}`;\n          stageIndex = hangingProtocolStageIndexMap[hangingId]?.stageIndex;\n        }\n\n        const useStageIdx =\n          stageIndex ??\n          hangingProtocolService.getStageIndex(protocolId, {\n            stageId,\n            stageIndex,\n          });\n\n        if (activeStudyUID) {\n          hangingProtocolService.setActiveStudyUID(activeStudyUID);\n        }\n\n        const storedHanging = `${\n          hangingProtocolService.getState().activeStudyUID\n        }:${protocolId}:${useStageIdx || 0}`;\n\n        const restoreProtocol = !reset && viewportGridStore[storedHanging];\n\n        if (\n          protocolId === hpInfo.protocolId &&\n          useStageIdx === hpInfo.stageIndex &&\n          !activeStudyUID\n        ) {\n          // Clear the HP setting to reset them\n          hangingProtocolService.setProtocol(protocolId, {\n            stageId,\n            stageIndex: useStageIdx,\n          });\n        } else {\n          hangingProtocolService.setProtocol(protocolId, {\n            displaySetSelectorMap,\n            stageId,\n            stageIndex: useStageIdx,\n            restoreProtocol,\n          });\n          if (restoreProtocol) {\n            viewportGridService.set(viewportGridStore[storedHanging]);\n          }\n        }\n        // Do this after successfully applying the update\n        // Note, don't store the active display set - it is only needed while\n        // changing display sets.  This causes jump to measurement to fail on\n        // multi-study display.\n        delete displaySetSelectorMap[\n          `${activeStudyUID || hpInfo.activeStudyUID}:activeDisplaySet:0`\n        ];\n        stateSyncService.store(stateSyncReduce);\n        // This is a default action applied\n        actions.toggleHpTools(hangingProtocolService.getActiveProtocol());\n        // Send the notification about updating the state\n        if (protocolId !== hpInfo.protocolId) {\n          const { protocol } = hangingProtocolService.getActiveProtocol();\n          // The old protocol callbacks are used for turning off things\n          // like crosshairs when moving to the new HP\n          commandsManager.run(oldProtocol.callbacks?.onProtocolExit);\n          // The new protocol callback is used for things like\n          // activating modes etc.\n          commandsManager.run(protocol.callbacks?.onProtocolEnter);\n        }\n        return true;\n      } catch (e) {\n        actions.toggleHpTools(hangingProtocolService.getActiveProtocol());\n        uiNotificationService.show({\n          title: 'Apply Hanging Protocol',\n          message: 'The hanging protocol could not be applied.',\n          type: 'error',\n          duration: 3000,\n        });\n        return false;\n      }\n    },\n\n    toggleHangingProtocol: ({\n      protocolId,\n      stageIndex,\n    }: HangingProtocolParams): boolean => {\n      const {\n        protocol,\n        stageIndex: desiredStageIndex,\n        activeStudy,\n      } = hangingProtocolService.getActiveProtocol();\n      const { toggleHangingProtocol } = stateSyncService.getState();\n      const storedHanging = `${\n        activeStudy.StudyInstanceUID\n      }:${protocolId}:${stageIndex | 0}`;\n      if (\n        protocol.id === protocolId &&\n        (stageIndex === undefined || stageIndex === desiredStageIndex)\n      ) {\n        // Toggling off - restore to previous state\n        const previousState = toggleHangingProtocol[storedHanging] || {\n          protocolId: 'default',\n        };\n        return actions.setHangingProtocol(previousState);\n      } else {\n        stateSyncService.store({\n          toggleHangingProtocol: {\n            ...toggleHangingProtocol,\n            [storedHanging]: {\n              protocolId: protocol.id,\n              stageIndex: desiredStageIndex,\n            },\n          },\n        });\n        return actions.setHangingProtocol({\n          protocolId,\n          stageIndex,\n          reset: true,\n        });\n      }\n    },\n\n    deltaStage: ({ direction }) => {\n      const {\n        protocolId,\n        stageIndex: oldStageIndex,\n      } = hangingProtocolService.getState();\n      const { protocol } = hangingProtocolService.getActiveProtocol();\n      for (\n        let stageIndex = oldStageIndex + direction;\n        stageIndex >= 0 && stageIndex < protocol.stages.length;\n        stageIndex += direction\n      ) {\n        if (protocol.stages[stageIndex].status !== 'disabled') {\n          return actions.setHangingProtocol({\n            protocolId,\n            stageIndex,\n          });\n        }\n      }\n      uiNotificationService.show({\n        title: 'Change Stage',\n        message: 'The hanging protocol has no more applicable stages',\n        type: 'info',\n        duration: 3000,\n      });\n    },\n\n    /**\n     * Changes the viewport grid layout in terms of the MxN layout.\n     */\n    setViewportGridLayout: ({ numRows, numCols }) => {\n      const { protocol } = hangingProtocolService.getActiveProtocol();\n      const onLayoutChange = protocol.callbacks?.onLayoutChange;\n      if (commandsManager.run(onLayoutChange, { numRows, numCols }) === false) {\n        console.log(\n          'setViewportGridLayout running',\n          onLayoutChange,\n          numRows,\n          numCols\n        );\n        // Don't apply the layout if the run command returns false\n        return;\n      }\n\n      const completeLayout = () => {\n        const state = viewportGridService.getState();\n        const stateReduce = findViewportsByPosition(\n          state,\n          { numRows, numCols },\n          stateSyncService\n        );\n        const findOrCreateViewport = layoutFindOrCreate.bind(\n          null,\n          hangingProtocolService,\n          stateReduce.viewportsByPosition\n        );\n\n        viewportGridService.setLayout({\n          numRows,\n          numCols,\n          findOrCreateViewport,\n        });\n        stateSyncService.store(stateReduce);\n      };\n      // Need to finish any work in the callback\n      window.setTimeout(completeLayout, 0);\n    },\n\n    toggleOneUp() {\n      const viewportGridState = viewportGridService.getState();\n      const { activeViewportIndex, viewports, layout } = viewportGridState;\n      const {\n        displaySetInstanceUIDs,\n        displaySetOptions,\n        viewportOptions,\n      } = viewports[activeViewportIndex];\n\n      if (layout.numCols === 1 && layout.numRows === 1) {\n        // The viewer is in one-up. Check if there is a state to restore/toggle back to.\n        const { toggleOneUpViewportGridStore } = stateSyncService.getState();\n\n        if (!toggleOneUpViewportGridStore.layout) {\n          return;\n        }\n        // There is a state to toggle back to. The viewport that was\n        // originally toggled to one up was the former active viewport.\n        const viewportIndexToUpdate =\n          toggleOneUpViewportGridStore.activeViewportIndex;\n\n        // Determine which viewports need to be updated. This is particularly\n        // important when MPR is toggled to one up and a different reconstructable\n        // is swapped in. Note that currently HangingProtocolService.getViewportsRequireUpdate\n        // does not support viewport with multiple display sets.\n        const updatedViewports =\n          displaySetInstanceUIDs.length > 1\n            ? []\n            : displaySetInstanceUIDs\n                .map(displaySetInstanceUID =>\n                  hangingProtocolService.getViewportsRequireUpdate(\n                    viewportIndexToUpdate,\n                    displaySetInstanceUID\n                  )\n                )\n                .flat();\n\n        // This findOrCreateViewport returns either one of the updatedViewports\n        // returned from the HP service OR if there is not one from the HP service then\n        // simply returns what was in the previous state.\n        const findOrCreateViewport = (viewportIndex: number) => {\n          const viewport = updatedViewports.find(\n            viewport => viewport.viewportIndex === viewportIndex\n          );\n\n          return viewport\n            ? { viewportOptions, displaySetOptions, ...viewport }\n            : toggleOneUpViewportGridStore.viewports[viewportIndex];\n        };\n\n        const layoutOptions = viewportGridService.getLayoutOptionsFromState(\n          toggleOneUpViewportGridStore\n        );\n\n        // Restore the previous layout including the active viewport.\n        viewportGridService.setLayout({\n          numRows: toggleOneUpViewportGridStore.layout.numRows,\n          numCols: toggleOneUpViewportGridStore.layout.numCols,\n          activeViewportIndex: viewportIndexToUpdate,\n          layoutOptions,\n          findOrCreateViewport,\n        });\n      } else {\n        // We are not in one-up, so toggle to one up.\n\n        // Store the current viewport grid state so we can toggle it back later.\n        stateSyncService.store({\n          toggleOneUpViewportGridStore: viewportGridState,\n        });\n\n        // This findOrCreateViewport only return one viewport - the active\n        // one being toggled to one up.\n        const findOrCreateViewport = () => {\n          return {\n            displaySetInstanceUIDs,\n            displaySetOptions,\n            viewportOptions,\n          };\n        };\n\n        // Set the layout to be 1x1/one-up.\n        viewportGridService.setLayout({\n          numRows: 1,\n          numCols: 1,\n          findOrCreateViewport,\n        });\n\n        // Subscribe to ANY (i.e. manual and hanging protocol) layout changes so that\n        // any grid layout state to toggle to from one up is cleared. This is performed on\n        // a timeout to avoid clearing the state for the actual to one up change.\n        // Whenever the next layout change event is fired, the subscriptions are unsubscribed.\n        const clearToggleOneUpViewportGridStore = () => {\n          const toggleOneUpViewportGridStore = {};\n          stateSyncService.store({\n            toggleOneUpViewportGridStore,\n          });\n        };\n\n        subscribeToNextViewportGridChange(\n          viewportGridService,\n          clearToggleOneUpViewportGridStore\n        );\n      }\n    },\n\n    /**\n     * Exposes the browser history navigation used by OHIF. This command can be used to either replace or\n     * push a new entry into the browser history. For example, the following will replace the current\n     * browser history entry with the specified relative URL which changes the study displayed to the\n     * study with study instance UID 1.2.3. Note that as a result of using `options.replace = true`, the\n     * page prior to invoking this command cannot be returned to via the browser back button.\n     *\n     * navigateHistory({\n     *   to: 'viewer?StudyInstanceUIDs=1.2.3',\n     *   options: { replace: true },\n     * });\n     *\n     * @param historyArgs - arguments for the history function;\n     *                      the `to` property is the URL;\n     *                      the `options.replace` is a boolean indicating if the current browser history entry\n     *                      should be replaced or a new entry pushed onto the history (stack); the default value\n     *                      for `replace` is false\n     */\n    navigateHistory(historyArgs: NavigateHistory) {\n      history.navigate(historyArgs.to, historyArgs.options);\n    },\n\n    openDICOMTagViewer() {\n      const { activeViewportIndex, viewports } = viewportGridService.getState();\n      const activeViewportSpecificData = viewports[activeViewportIndex];\n      const { displaySetInstanceUIDs } = activeViewportSpecificData;\n\n      const displaySets = displaySetService.activeDisplaySets;\n      const { UIModalService } = servicesManager.services;\n\n      const displaySetInstanceUID = displaySetInstanceUIDs[0];\n      UIModalService.show({\n        content: DicomTagBrowser,\n        contentProps: {\n          displaySets,\n          displaySetInstanceUID,\n          onClose: UIModalService.hide,\n        },\n        title: 'DICOM Tag Browser',\n      });\n    },\n\n    /**\n     * Toggle viewport overlay (the information panel shown on the four corners\n     * of the viewport)\n     * @see ViewportOverlay and CustomizableViewportOverlay components\n     */\n    toggleOverlays: () => {\n      const overlays = document.getElementsByClassName('viewport-overlay');\n      for (let i = 0; i < overlays.length; i++) {\n        overlays.item(i).classList.toggle('hidden');\n      }\n    },\n\n    scrollActiveThumbnailIntoView: () => {\n      const { activeViewportIndex, viewports } = viewportGridService.getState();\n\n      if (\n        !viewports ||\n        activeViewportIndex < 0 ||\n        activeViewportIndex > viewports.length - 1\n      ) {\n        return;\n      }\n\n      const activeViewport = viewports[activeViewportIndex];\n      const activeDisplaySetInstanceUID =\n        activeViewport.displaySetInstanceUIDs[0];\n\n      const thumbnailList = document.querySelector('#ohif-thumbnail-list');\n\n      if (!thumbnailList) {\n        return;\n      }\n\n      const thumbnailListBounds = thumbnailList.getBoundingClientRect();\n\n      const thumbnail = document.querySelector(\n        `#thumbnail-${activeDisplaySetInstanceUID}`\n      );\n\n      if (!thumbnail) {\n        return;\n      }\n\n      const thumbnailBounds = thumbnail.getBoundingClientRect();\n\n      // This only handles a vertical thumbnail list.\n      if (\n        thumbnailBounds.top >= thumbnailListBounds.top &&\n        thumbnailBounds.top <= thumbnailListBounds.bottom\n      ) {\n        return;\n      }\n\n      thumbnail.scrollIntoView({ behavior: 'smooth' });\n    },\n\n    updateViewportDisplaySet: ({\n      direction,\n      excludeNonImageModalities,\n    }: UpdateViewportDisplaySetParams) => {\n      const nonImageModalities = [\n        'SR',\n        'SEG',\n        'SM',\n        'RTSTRUCT',\n        'RTPLAN',\n        'RTDOSE',\n      ];\n\n      // Sort the display sets as per the hanging protocol service viewport/display set scoring system.\n      // The thumbnail list uses the same sorting.\n      const dsSortFn = hangingProtocolService.getDisplaySetSortFunction();\n      const currentDisplaySets = [...displaySetService.activeDisplaySets];\n\n      currentDisplaySets.sort(dsSortFn);\n\n      const { activeViewportIndex, viewports } = viewportGridService.getState();\n\n      const { displaySetInstanceUIDs } = viewports[activeViewportIndex];\n\n      const activeDisplaySetIndex = currentDisplaySets.findIndex(displaySet =>\n        displaySetInstanceUIDs.includes(displaySet.displaySetInstanceUID)\n      );\n\n      let displaySetIndexToShow: number;\n\n      for (\n        displaySetIndexToShow = activeDisplaySetIndex + direction;\n        displaySetIndexToShow > -1 &&\n        displaySetIndexToShow < currentDisplaySets.length;\n        displaySetIndexToShow += direction\n      ) {\n        if (\n          !excludeNonImageModalities ||\n          !nonImageModalities.includes(\n            currentDisplaySets[displaySetIndexToShow].Modality\n          )\n        ) {\n          break;\n        }\n      }\n\n      if (\n        displaySetIndexToShow < 0 ||\n        displaySetIndexToShow >= currentDisplaySets.length\n      ) {\n        return;\n      }\n\n      const { displaySetInstanceUID } = currentDisplaySets[\n        displaySetIndexToShow\n      ];\n\n      let updatedViewports = [];\n\n      try {\n        updatedViewports = hangingProtocolService.getViewportsRequireUpdate(\n          activeViewportIndex,\n          displaySetInstanceUID\n        );\n      } catch (error) {\n        console.warn(error);\n        uiNotificationService.show({\n          title: 'Navigate Viewport Display Set',\n          message:\n            'The requested display sets could not be added to the viewport due to a mismatch in the Hanging Protocol rules.',\n          type: 'info',\n          duration: 3000,\n        });\n      }\n\n      viewportGridService.setDisplaySetsForViewports(updatedViewports);\n\n      setTimeout(() => actions.scrollActiveThumbnailIntoView(), 0);\n    },\n  };\n\n  const definitions = {\n    showContextMenu: {\n      commandFn: actions.showContextMenu,\n    },\n    closeContextMenu: {\n      commandFn: actions.closeContextMenu,\n    },\n    clearMeasurements: {\n      commandFn: actions.clearMeasurements,\n      storeContexts: [],\n      options: {},\n    },\n    displayNotification: {\n      commandFn: actions.displayNotification,\n      storeContexts: [],\n      options: {},\n    },\n    setHangingProtocol: {\n      commandFn: actions.setHangingProtocol,\n      storeContexts: [],\n      options: {},\n    },\n    toggleHangingProtocol: {\n      commandFn: actions.toggleHangingProtocol,\n      storeContexts: [],\n      options: {},\n    },\n    navigateHistory: {\n      commandFn: actions.navigateHistory,\n      storeContexts: [],\n      options: {},\n    },\n    nextStage: {\n      commandFn: actions.deltaStage,\n      storeContexts: [],\n      options: { direction: 1 },\n    },\n    previousStage: {\n      commandFn: actions.deltaStage,\n      storeContexts: [],\n      options: { direction: -1 },\n    },\n    setViewportGridLayout: {\n      commandFn: actions.setViewportGridLayout,\n      storeContexts: [],\n      options: {},\n    },\n    toggleOneUp: {\n      commandFn: actions.toggleOneUp,\n      storeContexts: [],\n      options: {},\n    },\n    openDICOMTagViewer: {\n      commandFn: actions.openDICOMTagViewer,\n    },\n    updateViewportDisplaySet: {\n      commandFn: actions.updateViewportDisplaySet,\n      storeContexts: [],\n      options: {},\n    },\n  };\n\n  return {\n    actions,\n    definitions,\n    defaultContext: 'DEFAULT',\n  };\n};\n\nexport default commandsModule;\n","import { Types } from '@ohif/core';\n\n/**\n * This hanging protocol can be activated on the primary mode by directly\n * referencing it in a URL or by directly including it within a mode, e.g.:\n * `&hangingProtocolId=@ohif/mnGrid` added to the viewer URL\n * It is not included in the viewer mode by default.\n */\nconst hpMN: Types.HangingProtocol.Protocol = {\n  hasUpdatedPriorsInformation: false,\n  id: '@ohif/mnGrid',\n  description: 'Has various hanging protocol grid layouts',\n  name: '2x2',\n  protocolMatchingRules: [\n    {\n      id: 'OneOrMoreSeries',\n      weight: 25,\n      attribute: 'numberOfDisplaySetsWithImages',\n      constraint: {\n        greaterThan: 0,\n      },\n    },\n  ],\n  toolGroupIds: ['default'],\n  displaySetSelectors: {\n    defaultDisplaySetId: {\n      seriesMatchingRules: [\n        {\n          attribute: 'numImageFrames',\n          constraint: {\n            greaterThan: { value: 0 },\n          },\n        },\n        // This display set will select the specified items by preference\n        // It has no affect if nothing is specified in the URL.\n        {\n          attribute: 'isDisplaySetFromUrl',\n          weight: 10,\n          constraint: {\n            equals: true,\n          },\n        },\n      ],\n    },\n  },\n  defaultViewport: {\n    viewportOptions: {\n      viewportType: 'stack',\n      toolGroupId: 'default',\n      allowUnmatchedView: true,\n    },\n    displaySets: [\n      {\n        id: 'defaultDisplaySetId',\n        matchedDisplaySetsIndex: -1,\n      },\n    ],\n  },\n  stages: [\n    {\n      id: '2x2',\n      stageActivation: {\n        enabled: {\n          minViewportsMatched: 4,\n        },\n      },\n      viewportStructure: {\n        layoutType: 'grid',\n        properties: {\n          rows: 2,\n          columns: 2,\n        },\n      },\n      viewports: [\n        {\n          viewportOptions: {\n            toolGroupId: 'default',\n            allowUnmatchedView: true,\n          },\n          displaySets: [\n            {\n              id: 'defaultDisplaySetId',\n            },\n          ],\n        },\n        {\n          viewportOptions: {\n            toolGroupId: 'default',\n            allowUnmatchedView: true,\n          },\n          displaySets: [\n            {\n              matchedDisplaySetsIndex: 1,\n              id: 'defaultDisplaySetId',\n            },\n          ],\n        },\n        {\n          viewportOptions: {\n            toolGroupId: 'default',\n            allowUnmatchedView: true,\n          },\n          displaySets: [\n            {\n              matchedDisplaySetsIndex: 2,\n              id: 'defaultDisplaySetId',\n            },\n          ],\n        },\n        {\n          viewportOptions: {\n            toolGroupId: 'default',\n            allowUnmatchedView: true,\n          },\n          displaySets: [\n            {\n              matchedDisplaySetsIndex: 3,\n              id: 'defaultDisplaySetId',\n            },\n          ],\n        },\n      ],\n    },\n\n    // 3x1 stage\n    {\n      id: '3x1',\n      // Obsolete settings:\n      requiredViewports: 1,\n      preferredViewports: 3,\n      // New equivalent:\n      stageActivation: {\n        enabled: {\n          minViewportsMatched: 3,\n        },\n      },\n      viewportStructure: {\n        layoutType: 'grid',\n        properties: {\n          rows: 1,\n          columns: 3,\n        },\n      },\n      viewports: [\n        {\n          viewportOptions: {\n            toolGroupId: 'default',\n            allowUnmatchedView: true,\n          },\n          displaySets: [\n            {\n              id: 'defaultDisplaySetId',\n            },\n          ],\n        },\n        {\n          viewportOptions: {\n            toolGroupId: 'default',\n            allowUnmatchedView: true,\n          },\n          displaySets: [\n            {\n              id: 'defaultDisplaySetId',\n              matchedDisplaySetsIndex: 1,\n            },\n          ],\n        },\n        {\n          viewportOptions: {\n            toolGroupId: 'default',\n            allowUnmatchedView: true,\n          },\n          displaySets: [\n            {\n              id: 'defaultDisplaySetId',\n              matchedDisplaySetsIndex: 2,\n            },\n          ],\n        },\n      ],\n    },\n\n    // A 2x1 stage\n    {\n      id: '2x1',\n      requiredViewports: 1,\n      preferredViewports: 2,\n      stageActivation: {\n        enabled: {\n          minViewportsMatched: 2,\n        },\n      },\n      viewportStructure: {\n        layoutType: 'grid',\n        properties: {\n          rows: 1,\n          columns: 2,\n        },\n      },\n      viewports: [\n        {\n          viewportOptions: {\n            toolGroupId: 'default',\n            allowUnmatchedView: true,\n          },\n          displaySets: [\n            {\n              id: 'defaultDisplaySetId',\n            },\n          ],\n        },\n        {\n          viewportOptions: {\n            toolGroupId: 'default',\n            allowUnmatchedView: true,\n          },\n          displaySets: [\n            {\n              matchedDisplaySetsIndex: 1,\n              id: 'defaultDisplaySetId',\n            },\n          ],\n        },\n      ],\n    },\n\n    // A 1x1 stage - should be automatically activated if there is only 1 viewable instance\n    {\n      id: '1x1',\n      requiredViewports: 1,\n      preferredViewports: 1,\n      stageActivation: {\n        enabled: {\n          minViewportsMatched: 1,\n        },\n      },\n      viewportStructure: {\n        layoutType: 'grid',\n        properties: {\n          rows: 1,\n          columns: 1,\n        },\n      },\n      viewports: [\n        {\n          viewportOptions: {\n            toolGroupId: 'default',\n            allowUnmatchedView: true,\n          },\n          displaySets: [\n            {\n              id: 'defaultDisplaySetId',\n            },\n          ],\n        },\n      ],\n    },\n  ],\n  numberOfPriorsReferenced: -1,\n};\n\nexport default hpMN;\n","import hpMNGrid from './hpMNGrid';\n\nconst defaultProtocol = {\n  id: 'default',\n  locked: true,\n  // Don't store this hanging protocol as it applies to the currently active\n  // display set by default\n  // cacheId: null,\n  hasUpdatedPriorsInformation: false,\n  name: 'Default',\n  createdDate: '2021-02-23T19:22:08.894Z',\n  modifiedDate: '2023-04-01',\n  availableTo: {},\n  editableBy: {},\n  protocolMatchingRules: [],\n  toolGroupIds: ['default'],\n  // -1 would be used to indicate active only, whereas other values are\n  // the number of required priors referenced - so 0 means active with\n  // 0 or more priors.\n  numberOfPriorsReferenced: 0,\n  // Default viewport is used to define the viewport when\n  // additional viewports are added using the layout tool\n  defaultViewport: {\n    viewportOptions: {\n      viewportType: 'stack',\n      toolGroupId: 'default',\n      allowUnmatchedView: true,\n    },\n    displaySets: [\n      {\n        id: 'defaultDisplaySetId',\n        matchedDisplaySetsIndex: -1,\n      },\n    ],\n  },\n  displaySetSelectors: {\n    defaultDisplaySetId: {\n      // Matches displaysets, NOT series\n      seriesMatchingRules: [\n        // Try to match series with images by default, to prevent weird display\n        // on SEG/SR containing studies\n        {\n          attribute: 'numImageFrames',\n          constraint: {\n            greaterThan: { value: 0 },\n          },\n        },\n        // This display set will select the specified items by preference\n        // It has no affect if nothing is specified in the URL.\n        {\n          attribute: 'isDisplaySetFromUrl',\n          weight: 10,\n          constraint: {\n            equals: true,\n          },\n        },\n      ],\n      // Can be used to select matching studies\n      // studyMatchingRules: [],\n    },\n  },\n  stages: [\n    {\n      name: 'default',\n      viewportStructure: {\n        layoutType: 'grid',\n        properties: {\n          rows: 1,\n          columns: 1,\n        },\n      },\n      viewports: [\n        {\n          viewportOptions: {\n            viewportType: 'stack',\n            toolGroupId: 'default',\n            // This will specify the initial image options index if it matches in the URL\n            // and will otherwise not specify anything.\n            initialImageOptions: {\n              custom: 'sopInstanceLocation',\n            },\n            // Other options for initialImageOptions, which can be included in the default\n            // custom attribute, or can be provided directly.\n            //   index: 180,\n            //   preset: 'middle', // 'first', 'last', 'middle'\n            // },\n          },\n          displaySets: [\n            {\n              id: 'defaultDisplaySetId',\n            },\n          ],\n        },\n      ],\n      createdDate: '2021-02-23T18:32:42.850Z',\n    },\n  ],\n};\n\nfunction getHangingProtocolModule() {\n  return [\n    {\n      name: defaultProtocol.id,\n      protocol: defaultProtocol,\n    },\n    // Create a MxN hanging protocol available by default\n    {\n      name: hpMNGrid.id,\n      protocol: hpMNGrid,\n    },\n  ];\n}\n\nexport default getHangingProtocolModule;\n","import React from 'react';\nimport classnames from 'classnames';\nimport { useNavigate } from 'react-router-dom';\nimport { useAppConfig } from '@state';\n\nimport { Button } from '@ohif/ui';\n\nfunction DataSourceSelector() {\n  const [appConfig] = useAppConfig();\n  const navigate = useNavigate();\n\n  // This is frowned upon, but the raw config is needed here to provide\n  // the selector\n  const dsConfigs = appConfig.dataSources;\n\n  return (\n    <div style={{ width: '100%', height: '100%' }}>\n      <div className=\"h-screen w-screen flex justify-center items-center \">\n        <div className=\"py-8 px-8 mx-auto bg-secondary-dark drop-shadow-md space-y-2 rounded-lg\">\n          <img\n            className=\"block mx-auto h-14\"\n            src=\"./ohif-logo.svg\"\n            alt=\"OHIF\"\n          />\n          <div className=\"text-center space-y-2 pt-4\">\n            {dsConfigs\n              .filter(\n                it =>\n                  it.sourceName !== 'dicomjson' &&\n                  it.sourceName !== 'dicomlocal'\n              )\n              .map(ds => (\n                <div key={ds.sourceName}>\n                  <h1 className=\"text-white\">{ds.friendlyName}</h1>\n                  <Button\n                    className={classnames('font-bold', 'ml-2')}\n                    onClick={() => {\n                      navigate({\n                        pathname: '/',\n                        search: `datasources=${ds.sourceName}`,\n                      });\n                    }}\n                  >\n                    {ds.sourceName}\n                  </Button>\n                  <br />\n                </div>\n              ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default DataSourceSelector;\n","import OHIF from '@ohif/core';\n\nimport {\n  InstanceMetadata,\n  PhilipsPETPrivateGroup,\n} from '@cornerstonejs/calculate-suv/src/types';\n\nconst metadataProvider = OHIF.classes.MetadataProvider;\n\nexport default function getPTImageIdInstanceMetadata(\n  imageId: string\n): InstanceMetadata {\n  const dicomMetaData = metadataProvider.get('instance', imageId);\n\n  if (!dicomMetaData) {\n    throw new Error('dicom metadata are required');\n  }\n\n  if (\n    dicomMetaData.SeriesDate === undefined ||\n    dicomMetaData.SeriesTime === undefined ||\n    dicomMetaData.PatientWeight === undefined ||\n    dicomMetaData.CorrectedImage === undefined ||\n    dicomMetaData.Units === undefined ||\n    !dicomMetaData.RadiopharmaceuticalInformationSequence ||\n    dicomMetaData.RadiopharmaceuticalInformationSequence[0]\n      .RadionuclideHalfLife === undefined ||\n    dicomMetaData.RadiopharmaceuticalInformationSequence[0]\n      .RadionuclideTotalDose === undefined ||\n    dicomMetaData.DecayCorrection === undefined ||\n    dicomMetaData.AcquisitionDate === undefined ||\n    dicomMetaData.AcquisitionTime === undefined ||\n    (dicomMetaData.RadiopharmaceuticalInformationSequence[0]\n      .RadiopharmaceuticalStartDateTime === undefined &&\n      dicomMetaData.RadiopharmaceuticalInformationSequence[0]\n        .RadiopharmaceuticalStartTime === undefined)\n  ) {\n    throw new Error('required metadata are missing');\n  }\n\n  const instanceMetadata: InstanceMetadata = {\n    CorrectedImage: dicomMetaData.CorrectedImage,\n    Units: dicomMetaData.Units,\n    RadionuclideHalfLife:\n      dicomMetaData.RadiopharmaceuticalInformationSequence[0]\n        .RadionuclideHalfLife,\n    RadionuclideTotalDose:\n      dicomMetaData.RadiopharmaceuticalInformationSequence[0]\n        .RadionuclideTotalDose,\n    RadiopharmaceuticalStartDateTime:\n      dicomMetaData.RadiopharmaceuticalInformationSequence[0]\n        .RadiopharmaceuticalStartDateTime,\n    RadiopharmaceuticalStartTime:\n      dicomMetaData.RadiopharmaceuticalInformationSequence[0]\n        .RadiopharmaceuticalStartTime,\n    DecayCorrection: dicomMetaData.DecayCorrection,\n    PatientWeight: dicomMetaData.PatientWeight,\n    SeriesDate: dicomMetaData.SeriesDate,\n    SeriesTime: dicomMetaData.SeriesTime,\n    AcquisitionDate: dicomMetaData.AcquisitionDate,\n    AcquisitionTime: dicomMetaData.AcquisitionTime,\n  };\n\n  if (\n    dicomMetaData['70531000'] ||\n    dicomMetaData['70531000'] !== undefined ||\n    dicomMetaData['70531009'] ||\n    dicomMetaData['70531009'] !== undefined\n  ) {\n    const philipsPETPrivateGroup: PhilipsPETPrivateGroup = {\n      SUVScaleFactor: dicomMetaData['70531000'],\n      ActivityConcentrationScaleFactor: dicomMetaData['70531009'],\n    };\n    instanceMetadata.PhilipsPETPrivateGroup = philipsPETPrivateGroup;\n  }\n\n  if (dicomMetaData['0009100d'] && dicomMetaData['0009100d'] !== undefined) {\n    instanceMetadata.GEPrivatePostInjectionDateTime = dicomMetaData['0009100d'];\n  }\n\n  if (\n    dicomMetaData.FrameReferenceTime &&\n    dicomMetaData.FrameReferenceTime !== undefined\n  ) {\n    instanceMetadata.FrameReferenceTime = dicomMetaData.FrameReferenceTime;\n  }\n\n  if (\n    dicomMetaData.ActualFrameDuration &&\n    dicomMetaData.ActualFrameDuration !== undefined\n  ) {\n    instanceMetadata.ActualFrameDuration = dicomMetaData.ActualFrameDuration;\n  }\n\n  if (dicomMetaData.PatientSex && dicomMetaData.PatientSex !== undefined) {\n    instanceMetadata.PatientSex = dicomMetaData.PatientSex;\n  }\n\n  if (dicomMetaData.PatientSize && dicomMetaData.PatientSize !== undefined) {\n    instanceMetadata.PatientSize = dicomMetaData.PatientSize;\n  }\n\n  return instanceMetadata;\n}\n\nfunction convertInterfaceTimeToString(time): string {\n  const hours = `${time.hours || '00'}`.padStart(2, '0');\n  const minutes = `${time.minutes || '00'}`.padStart(2, '0');\n  const seconds = `${time.seconds || '00'}`.padStart(2, '0');\n\n  const fractionalSeconds = `${time.fractionalSeconds || '000000'}`.padEnd(\n    6,\n    '0'\n  );\n\n  const timeString = `${hours}${minutes}${seconds}.${fractionalSeconds}`;\n  return timeString;\n}\n\nfunction convertInterfaceDateToString(date): string {\n  const month = `${date.month}`.padStart(2, '0');\n  const day = `${date.day}`.padStart(2, '0');\n  const dateString = `${date.year}${month}${day}`;\n  return dateString;\n}\n\nexport { getPTImageIdInstanceMetadata };\n","import { DicomMetadataStore, classes } from '@ohif/core';\nimport { calculateSUVScalingFactors } from '@cornerstonejs/calculate-suv';\n\nimport getPTImageIdInstanceMetadata from './getPTImageIdInstanceMetadata';\n\nconst metadataProvider = classes.MetadataProvider;\n\n/**\n *\n * @param {Object} servicesManager\n * @param {Object} configuration\n */\nexport default function init({ servicesManager, configuration = {} }): void {\n  const { stateSyncService } = servicesManager.services;\n  // Add\n  DicomMetadataStore.subscribe(\n    DicomMetadataStore.EVENTS.INSTANCES_ADDED,\n    handlePETImageMetadata\n  );\n\n  // If the metadata for PET has changed by the user (e.g. manually changing the PatientWeight)\n  // we need to recalculate the SUV Scaling Factors\n  DicomMetadataStore.subscribe(\n    DicomMetadataStore.EVENTS.SERIES_UPDATED,\n    handlePETImageMetadata\n  );\n\n  // viewportGridStore is a sync state which stores the entire\n  // ViewportGridService getState, by the keys `<activeStudyUID>:<protocolId>:<stageIndex>`\n  // Used to recover manual changes to the layout of a stage.\n  stateSyncService.register('viewportGridStore', { clearOnModeExit: true });\n\n  // displaySetSelectorMap stores a map from\n  // `<activeStudyUID>:<displaySetSelectorId>:<matchOffset>` to\n  // a displaySetInstanceUID, used to display named display sets in\n  // specific spots within a hanging protocol and be able to remember what the\n  // user did with those named spots between stages and protocols.\n  stateSyncService.register('displaySetSelectorMap', { clearOnModeExit: true });\n\n  // Stores a map from `<activeStudyUID>:${protocolId}` to the getHPInfo results\n  // in order to recover the correct stage when returning to a Hanging Protocol.\n  stateSyncService.register('hangingProtocolStageIndexMap', {\n    clearOnModeExit: true,\n  });\n\n  // Stores a map from the to be applied hanging protocols `<activeStudyUID>:<protocolId>`\n  // to the previously applied hanging protolStageIndexMap key, in order to toggle\n  // off the applied protocol and remember the old state.\n  stateSyncService.register('toggleHangingProtocol', { clearOnModeExit: true });\n\n  // Stores the viewports by `rows-cols` position so that when the layout\n  // changes numRows and numCols, the viewports can be remembers and then replaced\n  // afterwards.\n  stateSyncService.register('viewportsByPosition', { clearOnModeExit: true });\n}\n\nconst handlePETImageMetadata = ({ SeriesInstanceUID, StudyInstanceUID }) => {\n  const { instances } = DicomMetadataStore.getSeries(\n    StudyInstanceUID,\n    SeriesInstanceUID\n  );\n\n  const modality = instances[0].Modality;\n  if (modality !== 'PT') {\n    return;\n  }\n  const imageIds = instances.map(instance => instance.imageId);\n  const instanceMetadataArray = [];\n  imageIds.forEach(imageId => {\n    const instanceMetadata = getPTImageIdInstanceMetadata(imageId);\n    if (instanceMetadata) {\n      instanceMetadataArray.push(instanceMetadata);\n    }\n  });\n\n  if (!instanceMetadataArray.length) {\n    return;\n  }\n\n  // try except block to prevent errors when the metadata is not correct\n  let suvScalingFactors;\n  try {\n    suvScalingFactors = calculateSUVScalingFactors(instanceMetadataArray);\n  } catch (error) {\n    console.log(error);\n  }\n\n  if (!suvScalingFactors) {\n    return;\n  }\n\n  instanceMetadataArray.forEach((instanceMetadata, index) => {\n    metadataProvider.addCustomMetadata(\n      imageIds[index],\n      'scalingModule',\n      suvScalingFactors[index]\n    );\n  });\n};\n","import { Types } from '@ohif/core';\n\nimport getDataSourcesModule from './getDataSourcesModule.js';\nimport getLayoutTemplateModule from './getLayoutTemplateModule.js';\nimport getPanelModule from './getPanelModule';\nimport getSopClassHandlerModule from './getSopClassHandlerModule.js';\nimport getToolbarModule from './getToolbarModule';\nimport getCommandsModule from './commandsModule';\nimport getHangingProtocolModule from './getHangingProtocolModule';\nimport getStudiesForPatientByMRN from './Panels/getStudiesForPatientByMRN';\nimport getCustomizationModule from './getCustomizationModule';\nimport { id } from './id.js';\nimport preRegistration from './init';\nimport {\n  ContextMenuController,\n  CustomizableContextMenuTypes,\n} from './CustomizableContextMenu';\nimport * as dicomWebUtils from './DicomWebDataSource/utils';\n\nconst defaultExtension: Types.Extensions.Extension = {\n  /**\n   * Only required property. Should be a unique value across all extensions.\n   */\n  id,\n  preRegistration,\n  getDataSourcesModule,\n  getLayoutTemplateModule,\n  getPanelModule,\n  getHangingProtocolModule,\n  getSopClassHandlerModule,\n  getToolbarModule,\n  getCommandsModule,\n  getUtilityModule({ servicesManager }) {\n    return [\n      {\n        name: 'common',\n        exports: {\n          getStudiesForPatientByMRN,\n        },\n      },\n    ];\n  },\n\n  getCustomizationModule,\n};\n\nexport default defaultExtension;\n\nexport {\n  ContextMenuController,\n  CustomizableContextMenuTypes,\n  getStudiesForPatientByMRN,\n  dicomWebUtils,\n};\n","import ViewerLayout from './ViewerLayout';\n/*\n- Define layout for the viewer in mode configuration.\n- Pass in the viewport types that can populate the viewer.\n- Init layout based on the displaySets and the objects.\n*/\n\nexport default function({\n  servicesManager,\n  extensionManager,\n  commandsManager,\n  hotkeysManager,\n}) {\n  function ViewerLayoutWithServices(props) {\n    return ViewerLayout({\n      servicesManager,\n      extensionManager,\n      commandsManager,\n      hotkeysManager,\n      ...props,\n    });\n  }\n\n  return [\n    // Layout Template Definition\n    // TODO: this is weird naming\n    {\n      name: 'viewerLayout',\n      id: 'viewerLayout',\n      component: ViewerLayoutWithServices,\n    },\n  ];\n}\n","import { ToolbarButton } from '@ohif/ui';\nimport ToolbarDivider from './Toolbar/ToolbarDivider.tsx';\nimport ToolbarLayoutSelector from './Toolbar/ToolbarLayoutSelector.tsx';\nimport ToolbarSplitButton from './Toolbar/ToolbarSplitButton.tsx';\n\nexport default function getToolbarModule({ commandsManager, servicesManager }) {\n  return [\n    {\n      name: 'ohif.divider',\n      defaultComponent: ToolbarDivider,\n      clickHandler: () => {},\n    },\n    {\n      name: 'ohif.action',\n      defaultComponent: ToolbarButton,\n      clickHandler: () => {},\n    },\n    {\n      name: 'ohif.radioGroup',\n      defaultComponent: ToolbarButton,\n      clickHandler: () => {},\n    },\n    {\n      name: 'ohif.splitButton',\n      defaultComponent: ToolbarSplitButton,\n      clickHandler: () => {},\n    },\n    {\n      name: 'ohif.layoutSelector',\n      defaultComponent: ToolbarLayoutSelector,\n      clickHandler: (evt, clickedBtn, btnSectionName) => {},\n    },\n    {\n      name: 'ohif.toggle',\n      defaultComponent: ToolbarButton,\n      clickHandler: () => {},\n    },\n  ];\n}\n","import { CustomizationService } from '@ohif/core';\nimport React from 'react';\nimport DataSourceSelector from './Panels/DataSourceSelector';\n\n/**\n *\n * Note: this is an example of how the customization module can be used\n * using the customization module. Below, we are adding a new custom route\n * to the application at the path /custom and rendering a custom component\n * Real world use cases of the having a custom route would be to add a\n * custom page for the user to view their profile, or to add a custom\n * page for login etc.\n */\nexport default function getCustomizationModule() {\n  return [\n    {\n      name: 'helloPage',\n      value: {\n        id: 'customRoutes',\n        routes: [\n          {\n            path: '/custom',\n            children: () => (\n              <h1 style={{ color: 'white' }}>Hello Custom Route</h1>\n            ),\n          },\n        ],\n      },\n    },\n\n    // Example customization to list a set of datasources\n    {\n      name: 'datasources',\n      value: {\n        id: 'customRoutes',\n        routes: [\n          {\n            path: '/datasources',\n            children: DataSourceSelector,\n          },\n        ],\n      },\n    },\n\n    {\n      name: 'default',\n      value: [\n        /**\n         * Customization Component Type definition for overlay items.\n         * Overlay items are texts (or other components) that will be displayed\n         * on a Viewport Overlay, which contains the information panels on the\n         * four corners of a viewport.\n         *\n         * @definition of a overlay item using this type\n         * The value to be displayed is defined by\n         *  - setting DICOM image instance's property to this field,\n         *  - or defining contentF()\n         *\n         * {\n         *   id: string - unique id for the overlay item\n         *   customizationType: string - indicates customization type definition to this\n         *   label: string - Label, to be displayed for the item\n         *   title: string - Tooltip, for the item\n         *   color: string - Color of the text\n         *   condition: ({ instance }) => boolean - decides whether to display the overlay item or not\n         *   attribute: string - property name of the DICOM image instance\n         *   contentF: ({ instance, formatters }) => string | component,\n         * }\n         *\n         * @example\n         *  {\n         *    id: 'PatientNameOverlay',\n         *    customizationType: 'ohif.overlayItem',\n         *    label: 'PN:',\n         *    title: 'Patient Name',\n         *    color: 'yellow',\n         *    condition: ({ instance }) => instance && instance.PatientName && instance.PatientName.Alphabetic,\n         *    attribute: 'PatientName',\n         *    contentF: ({ instance, formatters: { formatPN } }) => `${formatPN(instance.PatientName.Alphabetic)} ${(instance.PatientSex ? '(' + instance.PatientSex + ')' : '')}`,\n         *  },\n         *\n         * @see CustomizableViewportOverlay\n         */\n        {\n          id: 'ohif.overlayItem',\n          content: function (props) {\n            if (this.condition && !this.condition(props)) return null;\n\n            const { instance } = props;\n            const value =\n              instance && this.attribute\n                ? instance[this.attribute]\n                : this.contentF && typeof this.contentF === 'function'\n                  ? this.contentF(props)\n                  : null;\n            if (!value) return null;\n\n            return (\n              <span\n                className=\"overlay-item flex flex-row\"\n                style={{ color: this.color || undefined }}\n                title={this.title || ''}\n              >\n                {this.label && (\n                  <span className=\"mr-1 shrink-0\">{this.label}</span>\n                )}\n                <span className=\"font-light\">{value}</span>\n              </span>\n            );\n          },\n        },\n\n        {\n          id: 'ohif.contextMenu',\n\n          /** Applies the customizationType to all the menu items.\n           * This function clones the object and child objects to prevent\n           * changes to the original customization object.\n           */\n          transform: function (customizationService: CustomizationService) {\n            // Don't modify the children, as those are copied by reference\n            const clonedObject = { ...this };\n            clonedObject.menus = this.menus.map(menu => ({ ...menu }));\n\n            for (const menu of clonedObject.menus) {\n              const { items: originalItems } = menu;\n              menu.items = [];\n              for (const item of originalItems) {\n                menu.items.push(customizationService.transform(item));\n              }\n            }\n            return clonedObject;\n          },\n        },\n      ],\n    },\n  ];\n}\n"],"names":["getString","getName","getModalities","DICOMWeb","processResults","qidoStudies","length","studies","forEach","qidoStudy","push","studyInstanceUid","date","time","accession","mrn","patientName","utils","formatPN","instances","Number","description","modalities","async","search","dicomWebClient","seriesInstanceUid","queryParameters","searchForStudies","undefined","queryParams","mapParams","params","options","arguments","commaSeparatedFields","join","supportsWildcard","withWildcard","value","parameters","PatientName","patientId","AccessionNumber","accessionNumber","StudyDescription","studyDescription","ModalitiesInStudy","modalitiesInStudy","limit","offset","fuzzymatching","supportsFuzzyMatching","includefield","startDate","endDate","StudyDate","today","Date","DD","String","getDate","padStart","MM","getMonth","todayStr","getFullYear","oldDateStr","studyUids","Array","isArray","replace","StudyInstanceUID","final","Object","keys","key","getImageId","_ref","instance","frame","config","thumbnail","url","renderingAttr","uri","baseWadoRsUri","SeriesInstanceUID","SOPInstanceUID","wadoRoot","buildInstanceWadoRsUri","buildInstanceFrameWadoRsUri","getWADORSImageId","wadouri","paramString","wadoUriRoot","buildInstanceWadoUrl","imageId","RetrieveMetadataLoader","constructor","client","studyInstanceUID","filters","sortCriteria","sortFunction","this","preLoadData","preLoad","loadData","load","posLoad","loaders","result","loader","e","next","done","Error","RetrieveMetadataLoaderSync","getOptions","seriesInstanceUID","retrieveSeriesMetadata","bind","retrieveStudyMetadata","getLoaders","runLoaders","RetrieveMetadataLoaderAsync","preLoaders","searchForSeries","getPreLoaders","naturalizeDataset","dcmjs","DicomMetaDictionary","naturalized","map","sortStudySeries","sortingCriteria","seriesSortCriteria","seriesInfoSortingCriteria","seriesAsyncLoader","seriesInstanceUIDList","freeze","hasNext","shift","makeSeriesAsyncLoader","s","promises","enableStudyLazyLoad","retrieveMetadataLoader","execLoad","moduleName","StudyMetaDataPromises","Map","has","get","promise","Promise","resolve","reject","RetrieveMetadata","then","data","set","deleteStudyMetadataPromise","delete","StaticWadoClient","api","DICOMwebClient","qidoConfig","super","staticWado","searchResult","lowerParams","toLowerParams","filter","study","studyFilterKeys","filterItem","series","seriesFilterKeys","compareValues","desired","actual","find","item","actualItem","Alphabetic","indexOf","substring","compareDateRange","range","dash","start","end","sourceFilterMap","altKey","testValue","valueElem","vr","Value","entries","toLowerCase","studyinstanceuid","patientname","studydescription","studydate","modalitiesinstudy","accessionnumber","seriesinstanceuid","seriesnumber","modality","getDirectURL","singlepart","tag","defaultPath","defaultType","fetchPart","DirectRetrieveURL","InlineBinary","blob","b64toBlob","URL","createObjectURL","retrieveBulkData","arr","Blob","type","console","warn","BulkDataURI","hasQuery","hasAccept","fixBulkDataURI","dicomWebConfig","startsWith","origin","bulkDataURI","relativeResolution","DicomDict","denaturalizeDataset","ImplementationClassUID","ImplementationVersionName","EXPLICIT_VR_LITTLE_ENDIAN","metadataProvider","classes","MetadataProvider","createDicomWebApi","userAuthenticationService","qidoRoot","supportsReject","dicomWebConfigCopy","JSON","parse","stringify","headers","getAuthorizationHeader","errorInterceptor","errorHandler","getHTTPErrorHandler","wadoConfig","qidoDicomWebClient","wadoDicomWebClient","implementation","initialize","query","StudyInstanceUIDs","paramsStudyInstanceUIDs","queryStudyInstanceUIDs","splitComma","getAll","origParams","mappedParams","qidoSearch","qidoSeries","seriesNumber","seriesDate","formatDate","numSeriesInstances","processSeriesResults","seriesInStudy","call","retrieve","directURL","_ref2","multipart","val","metadata","madeInClient","_retrieveSeriesMetadataAsync","_retrieveSeriesMetadataSync","store","dicom","dataset","request","ArrayBuffer","datasets","storeInstances","meta","FileMetaInformationVersion","_meta","MediaStorageSOPClassUID","SOPClassUID","MediaStorageSOPInstanceUID","TransferSyntaxUID","denaturalized","dicomDict","dict","write","naturalizedInstancesMetadata","seriesSummaryMetadata","instancesPerSeries","SeriesDescription","SeriesNumber","SeriesTime","ProtocolName","Modality","getImageIdsForInstance","addImageIdToUIDs","seriesMetadata","values","DicomMetadataStore","addSeriesMetadata","addInstances","seriesPromises","addRetrieveBulkData","enabled","ret","arrayBuffer","byteLength","aSeries","seriesDeliveredPromises","naturalizedInstances","index","wadoUri","all","getStudy","isLoaded","getImageIdsForDisplaySet","displaySet","images","imageIds","NumberOfFrames","_ref3","getConfig","xhr","XMLHttpRequest","open","log","onreadystatechange","readyState","status","responseText","send","dcm4cheeReject","IWebApiDataSource","create","OHIF","mappings","_store","urls","getMetaDataByURL","metaData","findStudies","aStudy","createDicomJSONApi","dicomJsonConfig","name","response","fetch","json","studyInstanceUIDs","naturalizedDicom","param","mappedParam","NumInstances","Modalities","PatientID","StudyTime","debug","customSort","seriesSummary","numberOfSeries","obj","i","EVENTS","END_MODALITIES","SR","SEG","DOC","compareValue","v1","v2","seriesA","seriesB","instanceA","instanceB","modalityA","modalityB","isEndA","isEndB","createDicomLocalApi","dicomLocalConfig","StudyInstanceUIDsAsArray","sort","getStudyInstanceUIDs","numInstances","Set","add","firstInstance","from","SeriesDate","_broadcastEvent","SERIES_ADDED","isMultiframe","frameIndex","INSTANCES_ADDED","naturalizedReport","reportBlob","datasetToBlob","objectUrl","window","location","assign","getInstance","createDicomWebProxyApi","dicomWebProxyConfig","UserAuthenticationService","dicomWebDelegate","servers","dicomWeb","split","createDataSource","Toolbar","servicesManager","toolbarService","services","toolbarButtons","setToolbarButtons","useState","buttonState","setButtonState","primaryToolId","toggles","groups","useEffect","unsubscribe","unsub1","subscribe","TOOL_BAR_MODIFIED","getButtonSection","unsub2","TOOL_BAR_STATE_MODIFIED","state","React","toolDef","id","Component","componentProps","isActive","className","classnames","_extends","bState","onInteraction","args","recordInteraction","availableLanguages","defaultLanguage","currentLanguage","i18n","ViewerLayout","extensionManager","hotkeysManager","commandsManager","viewports","ViewportGridComp","leftPanels","rightPanels","leftPanelDefaultClosed","rightPanelDefaultClosed","appConfig","useAppConfig","navigate","useNavigate","useLocation","t","useTranslation","show","hide","useModal","showLoadingIndicator","setShowLoadingIndicator","hangingProtocolService","hotkeyDefinitions","hotkeyDefaults","menuOptions","title","icon","onClick","content","AboutModal","contentProps","versionNumber","process","commitHash","UserPreferences","getValidHotkeyDefinitions","onCancel","hotkeys","stopRecord","unpause","onSubmit","language","changeLanguage","setHotkeys","onReset","restoreDefaultBindings","hotkeysModule","oidc","encodeURIComponent","href","document","body","classList","remove","getComponent","entry","getModuleEntry","component","getPanelData","iconName","iconLabel","label","HangingProtocolService","PROTOCOL_CHANGED","leftPanelComponents","rightPanelComponents","viewportComponents","viewportComponent","namespace","displaySetsToDisplay","Header","isReturnEnabled","showStudyList","onClickReturnButton","pathname","dataSourceIdx","configUrl","URLSearchParams","searchQuery","append","decodeURIComponent","toString","WhiteLabeling","whiteLabeling","ErrorBoundary","context","style","height","LoadingIndicatorProgress","SidePanel","side","activeTabIndex","tabs","propTypes","PropTypes","isRequired","CommandsManager","ServicesManager","children","sortStudyInstances","PanelStudyBrowser","getImageSrc","getStudiesForPatientByMRN","requestDisplaySetCreationForStudy","dataSource","displaySetService","uiNotificationService","useImageViewer","activeViewportIndex","viewportGridService","useViewportGrid","activeTabName","setActiveTabName","expandedStudyInstanceUIDs","setExpandedStudyInstanceUIDs","studyDisplayList","setStudyDisplayList","displaySets","setDisplaySets","thumbnailImageSrcMap","setThumbnailImageSrcMap","isMounted","useRef","sid","qidoForStudyUID","qidoStudiesForPatient","error","actuallyMappedStudies","prevArray","it","fetchStudiesForPatient","activeDisplaySets","newImageSrcEntry","getDisplaySetByUID","dSet","displaySetInstanceUID","Math","floor","current","prevState","mappedDisplaySets","_mapDisplaySets","SubscriptionDisplaySetsAdded","DISPLAY_SETS_ADDED","displaySetsAdded","initialViewport","SubscriptionDisplaySetsChanged","DISPLAY_SETS_CHANGED","changedDisplaySets","primaryStudyInstanceUIDs","primaryStudies","recentStudies","allStudies","displaySetsForStudy","ds","tabStudy","includes","_createStudyBrowserTabs","activeDisplaySetInstanceUIDs","displaySetInstanceUIDs","StudyBrowser","onDoubleClickThumbnail","updatedViewports","viewportIndex","getViewportsRequireUpdate","message","duration","setDisplaySetsForViewports","onClickStudy","shouldCollapseStudy","updatedExpandedStudyInstanceUIDs","stdyUid","onClickTab","clickedTabName","thumbnailDisplaySets","thumbnailNoImageDisplaySets","excludeFromThumbnailBrowser","imageSrc","componentType","thumbnailNoImageModalities","_getComponentType","seriesTime","numImageFrames","countIcon","dragData","cornerstone","canvas","createElement","utilities","loadImageToCanvas","toDataURL","catch","some","WrappedPanelStudyBrowser","getDataSources","_getStudiesForPatientByMRN","_getImageSrcFromImageId","exports","getCornerstoneLibraries","getImageSrcFromImageId","ex","_createGetImageSrcFromImageIdFn","_requestDisplaySetCreationForStudy","ActionButtons","onExportClick","onCreateReportClick","ButtonGroup","color","size","Button","defaultProps","alert","CREATE_REPORT_DIALOG_RESPONSE","CANCEL","CREATE_REPORT","Loading","measurements","uiDialogService","loadingDialogId","showOverlay","isDraggable","centralize","runCommand","measurementData","additionalFindingTypes","getMostRecentDisplaySet","dismiss","MIN_SR_SERIES_NUMBER","findSRWithSameSeriesDescription","sameSeries","getActiveDisplaySets","InstanceNumber","srSeriesNumbers","max","getNextSRSeriesNumber","downloadCSVReport","PanelMeasurementTable","viewportGrid","measurementService","displayMeasurements","setDisplayMeasurements","debouncedSetDisplayMeasurements","debounce","_getMappedMeasurements","added","MEASUREMENT_ADDED","addedRaw","RAW_MEASUREMENT_ADDED","updated","MEASUREMENT_UPDATED","removed","MEASUREMENT_REMOVED","cleared","MEASUREMENTS_CLEARED","subscriptions","evt","unsub","cancel","onMeasurementItemClickHandler","_ref6","uid","measurement","m","MeasurementTable","jumpToMeasurement","onEdit","getMeasurement","onSubmitHandler","_ref4","action","update","Dialog","noCloseButton","_ref5","setValue","Input","labelClassName","autoFocus","onChange","event","persist","target","onKeyPress","actions","text","getMeasurements","onClearMeasurementsClick","clearMeasurements","activeViewport","trackedMeasurements","referenceStudyUID","promptResult","dialogId","dataSourcesOpts","dataSourceMap","configuration","dataSourceDefs","supportsStow","placeHolder","useLastPosition","dataSourceName","activeDataSource","onClose","_handleClose","Select","closeMenuOnSelect","placeholder","option","v","isClearable","required","createReportDialogPrompt","createReportAsync","types","displayText","baseDisplayText","baseLabel","selected","findingSites","finding","firstSite","siteText","site","measurementType","_mapMeasurementToDisplay","VALUE_TYPES","secondaryLabel","wrappedMeasurementPanel","packageJson","sopClassHandlerName","isMultiFrame","makeDisplaySet","imageSet","ImageSet","isReconstructable","averageSpacingBetweenFrames","isDisplaySetReconstructable","setAttributes","FrameRate","FrameTime","SOPClassHandlerId","sortBy","a","b","parseInt","isSingleImageModality","getDisplaySetsFromSeries","sopClassUids","uniqueSopClassUidsInSeries","getSopClassUids","stackableInstances","isImage","Rows","isClip","instanceNumber","acquisitionDatetime","AcquisitionDateTime","setAttribute","sopClassDictionary","ComputedRadiographyImageStorage","DigitalXRayImageStorageForPresentation","DigitalXRayImageStorageForProcessing","DigitalMammographyXRayImageStorageForPresentation","DigitalMammographyXRayImageStorageForProcessing","DigitalIntraOralXRayImageStorageForPresentation","DigitalIntraOralXRayImageStorageForProcessing","CTImageStorage","EnhancedCTImageStorage","LegacyConvertedEnhancedCTImageStorage","UltrasoundMultiframeImageStorage","MRImageStorage","EnhancedMRImageStorage","EnhancedMRColorImageStorage","LegacyConvertedEnhancedMRImageStorage","UltrasoundImageStorage","UltrasoundImageStorageRET","SecondaryCaptureImageStorage","MultiframeSingleBitSecondaryCaptureImageStorage","MultiframeGrayscaleByteSecondaryCaptureImageStorage","MultiframeGrayscaleWordSecondaryCaptureImageStorage","MultiframeTrueColorSecondaryCaptureImageStorage","XRayAngiographicImageStorage","EnhancedXAImageStorage","XRayRadiofluoroscopicImageStorage","EnhancedXRFImageStorage","XRay3DAngiographicImageStorage","XRay3DCraniofacialImageStorage","BreastTomosynthesisImageStorage","BreastProjectionXRayImageStorageForPresentation","BreastProjectionXRayImageStorageForProcessing","IntravascularOpticalCoherenceTomographyImageStorageForPresentation","IntravascularOpticalCoherenceTomographyImageStorageForProcessing","NuclearMedicineImageStorage","VLEndoscopicImageStorage","VideoEndoscopicImageStorage","VLMicroscopicImageStorage","VideoMicroscopicImageStorage","VLSlideCoordinatesMicroscopicImageStorage","VLPhotographicImageStorage","VideoPhotographicImageStorage","OphthalmicPhotography8BitImageStorage","OphthalmicPhotography16BitImageStorage","OphthalmicTomographyImageStorage","VLWholeSlideMicroscopyImageStorage","PositronEmissionTomographyImageStorage","EnhancedPETImageStorage","LegacyConvertedEnhancedPETImageStorage","RTImageStorage","EnhancedUSVolumeStorage","ToolbarDivider","LayoutSelector","rows","columns","rest","isOpen","setIsOpen","closeOnOutsideClick","protocol","addEventListener","removeEventListener","DropdownContent","OHIFLayoutSelector","ToolbarButton","onInteractionHandler","rounded","dropdownContent","onSelection","props","interactionType","commands","commandName","commandOptions","onLayoutChange","SplitButton","getMenuItems","selectorProps","menus","menuIdFilter","subProps","menu","subMenu","findIt","menuId","findMenuById","selector","findMenuDefault","findMenuIterator","return","findMenu","items","menuItems","delegating","toAdd","newItem","actionType","iconRight","itemRef","detail","element","adaptItem","ContextMenuController","closeContextMenu","showContextMenu","contextMenuProps","viewportElement","defaultPointsPosition","ContextMenuItemsBuilder","preservePosition","preventCutOf","defaultPosition","_getDefaultPosition","ContextMenu","onClickOutside","eventData","onShowSubMenu","onDefault","run","getDefaultPosition","x","y","_getEventDefaultPosition","eventDetail","currentPoints","_getElementDefaultPosition","boundingClientRect","getBoundingClientRect","_getCanvasPointsPosition","points","viewerPos","pointIndex","point","_isValidPosition","source","canvasPoints","viewerElement","positionIterator","getPositionIterator","position","customizationType","nearbyToolData","rowVerticalPaddingStyle","padding","rowStyle","borderBottomWidth","ColumnHeaders","tagRef","vrRef","keywordRef","valueRef","classNames","ref","listRef","canvasRef","tagHeaderElem","setTagHeaderElem","vrHeaderElem","setVrHeaderElem","keywordHeaderElem","setKeywordHeaderElem","valueHeaderElem","setValueHeaderElem","scrollTo","resetAfterIndex","debouncedResize","Row","useCallback","row","isHeaderRendered","getItemSize","headerWidths","offsetWidth","getContext","font","getComputedStyle","colText","colOneLineWidth","measureText","width","ceil","reduce","maxHeight","colHeight","visibility","elem","List","itemCount","itemSize","nameMap","getFormattedRowsFromTags","tags","tagInfo","tagIndent","keyword","formatedRowsFromTags","Tag","fromPString","toCleanString","originalTagInfo","getRows","depth","keywords","sequenceAsArray","objectOrArray","sequence","sequenceRows","_sortTagList","regex","match","tagList","excludedColumnIndicesForFilter","selectedDisplaySetInstanceUID","setSelectedDisplaySetInstanceUID","setInstanceNumber","filterValue","setFilterValue","searchInputRef","activeDisplaySet","isImageStack","showInstanceList","displaySetList","useMemo","dateStr","moment","format","getSortedTags","filteredRows","filterValueLowerCase","keepRow","col","colIndex","debouncedSetFilterValue","Typography","variant","InputRange","minValue","maxValue","step","inputClassName","labelPosition","trackColor","Icon","autoComplete","DicomTagTable","reuseCachedLayout","syncService","layout","hpInfo","getState","protocolId","stageIndex","activeStudyUID","getActiveProtocol","stage","stages","storeId","syncState","cacheId","viewportGridStore","hangingProtocolStageIndexMap","displaySetSelectorMap","viewportStructure","properties","custom","numRows","numCols","idx","viewport","displaySetOptions","displaySetUID","matchedDisplaySetsIndex","findOrCreateViewport","viewportsByPosition","positionId","byPositionViewport","inDisplay","initialInDisplay","missing","getMissingViewport","displaySetsInfo","viewportOptions","findViewportsByPosition","storedViewport","viewportId","pos","subscribeToNextViewportGridChange","isHangingProtocolCommand","command","customizationService","stateSyncService","contextMenuController","menuCustomizationId","optionsToUse","defaultContextMenu","displayNotification","clear","toggleHpTools","toggleStageIndex","enableListener","button","hpCommand","stageId","setActive","getButtons","setHangingProtocol","reset","oldProtocol","stateSyncReduce","reuseCachedLayouts","hangingId","useStageIdx","getStageIndex","setActiveStudyUID","storedHanging","restoreProtocol","setProtocol","callbacks","onProtocolExit","onProtocolEnter","toggleHangingProtocol","desiredStageIndex","activeStudy","previousState","deltaStage","direction","oldStageIndex","setViewportGridLayout","setTimeout","completeLayout","stateReduce","layoutFindOrCreate","setLayout","toggleOneUp","viewportGridState","toggleOneUpViewportGridStore","viewportIndexToUpdate","flat","layoutOptions","getLayoutOptionsFromState","clearToggleOneUpViewportGridStore","navigateHistory","historyArgs","history","to","openDICOMTagViewer","activeViewportSpecificData","UIModalService","DicomTagBrowser","toggleOverlays","overlays","getElementsByClassName","toggle","scrollActiveThumbnailIntoView","activeDisplaySetInstanceUID","thumbnailList","querySelector","thumbnailListBounds","thumbnailBounds","top","bottom","scrollIntoView","behavior","updateViewportDisplaySet","_ref7","excludeNonImageModalities","nonImageModalities","dsSortFn","getDisplaySetSortFunction","currentDisplaySets","displaySetIndexToShow","findIndex","definitions","commandFn","storeContexts","nextStage","previousStage","defaultContext","hasUpdatedPriorsInformation","protocolMatchingRules","weight","attribute","constraint","greaterThan","toolGroupIds","displaySetSelectors","defaultDisplaySetId","seriesMatchingRules","equals","defaultViewport","viewportType","toolGroupId","allowUnmatchedView","stageActivation","minViewportsMatched","layoutType","requiredViewports","preferredViewports","numberOfPriorsReferenced","defaultProtocol","locked","createdDate","modifiedDate","availableTo","editableBy","initialImageOptions","hpMNGrid","dsConfigs","dataSources","src","alt","sourceName","friendlyName","handlePETImageMetadata","getSeries","instanceMetadataArray","instanceMetadata","dicomMetaData","PatientWeight","CorrectedImage","Units","RadiopharmaceuticalInformationSequence","RadionuclideHalfLife","RadionuclideTotalDose","DecayCorrection","AcquisitionDate","AcquisitionTime","RadiopharmaceuticalStartDateTime","RadiopharmaceuticalStartTime","philipsPETPrivateGroup","SUVScaleFactor","ActivityConcentrationScaleFactor","PhilipsPETPrivateGroup","GEPrivatePostInjectionDateTime","FrameReferenceTime","ActualFrameDuration","PatientSex","PatientSize","getPTImageIdInstanceMetadata","suvScalingFactors","calculateSUVScalingFactors","addCustomMetadata","preRegistration","SERIES_UPDATED","register","clearOnModeExit","getDataSourcesModule","getLayoutTemplateModule","getPanelModule","getHangingProtocolModule","getSopClassHandlerModule","getToolbarModule","defaultComponent","clickHandler","ToolbarSplitButton","ToolbarLayoutSelector","clickedBtn","btnSectionName","getCommandsModule","getUtilityModule","getCustomizationModule","routes","path","DataSourceSelector","condition","contentF","transform","clonedObject","originalItems"],"sourceRoot":""}